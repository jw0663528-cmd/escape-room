<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#000000">
    <title>×¤×¨×•×˜×•×§×•×œ ×”×¢×•×§×¥ | ×’×¨×¡×ª ×”×‘×××™ (V9.0)</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700;900&family=Heebo:wght@100;300;400;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">

    <style>
        /* * ==========================================================================
         * CORE SYSTEM STYLES (150+ Lines of CSS Variables & Reset)
         * ==========================================================================
         */
        :root {
            --bg-void: #010101;
            --bg-panel: #0a0b0e;
            --bg-glass: rgba(10, 11, 14, 0.95);
            
            --border-dim: #1f2833;
            --border-bright: #45a29e;
            
            /* ×¢×¨×›×ª × ×•×©×: ×”× ×“×¡×” ×§×¨×‘×™×ª (×–×”×‘/×©×—×•×¨) */
            --c-gold: #ffb700; 
            --c-gold-dim: rgba(255, 183, 0, 0.15);
            --c-cyan: #66fcf1;
            --c-cyan-dim: rgba(102, 252, 241, 0.1);
            
            /* ×¡×˜×˜×•×¡×™× */
            --status-ok: #00ff9d;
            --status-warn: #ffae00;
            --status-crit: #ff2a2a;

            /* ××™×“×•×ª */
            --sidebar-w: 380px;
            --header-h: 70px;
            
            /* ×’×•×¤× ×™× */
            --font-ui: 'Heebo', sans-serif;
            --font-display: 'Rubik', sans-serif;
            --font-code: 'Share Tech Mono', monospace;
        }

        *, *::before, *::after {
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }

        body, html {
            width: 100%; height: 100%; margin: 0; padding: 0;
            background-color: var(--bg-void); color: #e0e0e0;
            font-family: var(--font-ui); overflow: hidden;
            overscroll-behavior: none;
        }

        /* ××¤×§×˜ CRT Scanlines */
        .scanlines {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.1));
            background-size: 100% 4px; z-index: 9999; pointer-events: none; opacity: 0.7;
        }

        /* ×¡×¨×’×œ ×’×œ×™×œ×” */
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: var(--c-gold); border-radius: 2px; }

        /* ×›×¤×ª×•×¨×™× ×’× ×¨×™×™× */
        .btn-base {
            background: transparent; border: 1px solid var(--c-gold); color: var(--c-gold);
            padding: 10px 20px; font-family: var(--font-display); font-weight: bold;
            cursor: pointer; transition: all 0.2s ease; text-transform: uppercase;
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
        }
        .btn-base:hover { background: var(--c-gold); color: #000; box-shadow: 0 0 15px var(--c-gold); }
        .btn-base:active { transform: scale(0.98); }
        .btn-base:disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(1); }

        /* * ==========================================================================
         * LAYERS & SCREENS (Boot, Intro, Game, Credits)
         * ==========================================================================
         */
        .screen-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 1000; display: none;
            flex-direction: column; justify-content: center; align-items: center;
        }
        .screen-layer.active { display: flex; animation: fadeIn 0.5s ease-out; }

        /* BOOT SCREEN */
        #boot-screen { font-family: var(--font-code); direction: ltr; align-items: flex-start; padding: 40px; }
        .boot-line { color: var(--c-cyan); margin-bottom: 5px; font-size: 14px; text-shadow: 0 0 5px var(--c-cyan-dim); }
        .boot-cursor { display: inline-block; width: 8px; height: 14px; background: var(--c-cyan); animation: blink 1s infinite; }

        /* INFO CARDS (Intro / Credits) */
        .info-card {
            width: 90%; max-width: 700px; max-height: 85vh;
            background: rgba(10, 12, 15, 0.95); border: 1px solid var(--c-gold);
            padding: 40px; border-radius: 4px; text-align: center;
            box-shadow: 0 0 50px rgba(255, 183, 0, 0.1);
            overflow-y: auto; position: relative;
        }
        .info-card::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 4px;
            background: linear-gradient(90deg, transparent, var(--c-gold), transparent);
        }
        
        .title-large { 
            font-family: var(--font-display); font-size: 36px; color: var(--c-gold); margin-bottom: 20px; 
            text-transform: uppercase; letter-spacing: 2px;
        }
        .text-content { 
            font-size: 18px; line-height: 1.7; color: #ccc; margin-bottom: 40px; text-align: right; 
        }
        .text-content strong { color: #fff; text-decoration: underline; text-decoration-color: var(--c-cyan); }

        /* CREDITS LIST */
        .credits-ul { list-style: none; padding: 0; margin: 0 0 30px 0; }
        .credits-ul li { margin-bottom: 15px; border-bottom: 1px solid #222; padding-bottom: 10px; }
        .role { display: block; font-size: 12px; color: var(--c-cyan); font-family: var(--font-code); margin-bottom: 2px; }
        .name { font-size: 20px; font-weight: 700; color: #fff; }

        /* * ==========================================================================
         * MAIN INTERFACE (Grid Layout)
         * ==========================================================================
         */
        #game-ui {
            display: grid;
            grid-template-columns: 1fr var(--sidebar-w);
            grid-template-rows: var(--header-h) 1fr;
            width: 100%; height: 100%;
            opacity: 0; transition: opacity 1s;
        }
        #game-ui.visible { opacity: 1; }

        /* HEADER */
        header {
            grid-column: 1 / -1; background: var(--bg-panel); border-bottom: 1px solid var(--border-dim);
            display: flex; justify-content: space-between; align-items: center; padding: 0 30px;
            z-index: 100;
        }
        .logo h1 { font-family: var(--font-display); font-size: 22px; color: var(--c-gold); margin: 0; letter-spacing: 1px; }
        .logo span { font-size: 10px; color: #666; letter-spacing: 2px; text-transform: uppercase; }

        .health-mon { display: flex; align-items: center; gap: 15px; font-family: var(--font-code); font-size: 14px; }
        .bar-wrap { width: 200px; height: 10px; background: #222; border: 1px solid #444; position: relative; }
        .bar-fill { height: 100%; width: 0%; background: var(--c-cyan); box-shadow: 0 0 10px var(--c-cyan); transition: width 0.5s; }
        .bar-fill.crit { background: var(--status-crit); box-shadow: 0 0 10px var(--status-crit); }

        /* VIEWPORT */
        #viewport { position: relative; background: #000; overflow: hidden; cursor: crosshair; border-left: 1px solid var(--border-dim); }
        
        .scene-layer { 
            position: absolute; top:0; left:0; width:100%; height:100%; 
            background-size: cover; background-position: center; 
            transition: opacity 1.5s ease-in-out; opacity: 0; z-index: 1; 
        }
        #layer-train { background-image: url('https://i.ibb.co/7tQt5S0h/Gemini-Generated-Image-prcu4rprcu4rprcu.png'); opacity: 1; }
        #layer-hall { background-image: url('https://i.ibb.co/svJJmvYr/Gemini-Generated-Image-l4kaehl4kaehl4ka.png'); filter: brightness(0.3) sepia(1) hue-rotate(180deg); }
        #layer-lab { background-image: url('https://i.ibb.co/d04yrgRx/Gemini-Generated-Image-j02tg6j02tg6j02t.png'); filter: contrast(1.2); }

        /* EFFECTS */
        #fx-canvas { position: absolute; top:0; left:0; width:100%; height:100%; z-index: 5; pointer-events: none; }
        .overlay-fx { position: absolute; top:0; left:0; width:100%; height:100%; pointer-events: none; opacity: 0; transition: 1s; z-index: 6; }
        #ov-gas { background: radial-gradient(circle, rgba(0,255,100,0.1), transparent 80%); mix-blend-mode: color-dodge; }
        #ov-thermal { background: linear-gradient(180deg, rgba(0,50,0,0.2), transparent), repeating-linear-gradient(0deg, transparent, transparent 2px, #0f0 3px); mix-blend-mode: hard-light; filter: contrast(2) invert(1); z-index: 7; }
        #ov-dark { background: radial-gradient(circle at 50% 50%, transparent 100px, #000 500px); z-index: 8; }

        /* HOTSPOTS */
        #hotspots { position: absolute; top:0; left:0; width:100%; height:100%; z-index: 20; }
        .hotspot {
            position: absolute; width: 60px; height: 60px;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; opacity: 0; transition: 0.3s;
        }
        .hs-ring {
            position: absolute; width: 100%; height: 100%;
            border: 1px dashed rgba(255, 183, 0, 0.5); border-radius: 50%;
            animation: spin 8s linear infinite;
        }
        .hs-core {
            width: 8px; height: 8px; background: var(--c-gold); border-radius: 50%;
            box-shadow: 0 0 10px var(--c-gold); transition: 0.3s;
        }
        
        .scanner-on .hotspot { opacity: 0.6; }
        .hotspot:hover { opacity: 1 !important; transform: scale(1.1); }
        .hotspot:hover .hs-core { transform: scale(1.5); background: #fff; }
        
        .hs-tag {
            position: absolute; bottom: -30px; 
            background: rgba(0,0,0,0.8); border: 1px solid var(--c-gold);
            color: var(--c-gold); font-family: var(--font-code); font-size: 12px;
            padding: 2px 6px; white-space: nowrap; opacity: 0; transition: 0.3s; pointer-events: none;
        }
        .hotspot:hover .hs-tag { opacity: 1; bottom: -35px; }

        /* COORDINATES */
        /* Phase 1 */
        #hs-case { top: 68%; left: 75%; }
        #hs-seat { top: 62%; left: 22%; }
        #hs-vent { top: 8%; left: 50%; width: 140px; height: 80px; }
        /* Phase 2 */
        #hs-junk { top: 75%; left: 35%; display: none; }
        #hs-panel { top: 45%; left: 12%; display: none; }
        #hs-door { top: 35%; left: 50%; width: 90px; height: 150px; display: none; }
        /* Phase 3 */
        #hs-closet { top: 55%; left: 15%; display: none; }
        #hs-enemy { top: 40%; left: 65%; width: 100px; height: 220px; display: none; opacity: 0; cursor: default; pointer-events: none; }

        /* SIDEBAR */
        aside {
            background: var(--bg-panel); border-left: 1px solid var(--border-dim);
            display: flex; flex-direction: column; padding: 20px; gap: 20px; z-index: 50;
        }

        .panel { background: rgba(255,255,255,0.02); border: 1px solid var(--border-dim); padding: 15px; border-radius: 4px; }
        .panel-h { color: var(--c-gold); font-size: 12px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; border-bottom: 1px solid #333; padding-bottom: 5px; font-weight: bold; }

        #log-container { height: 150px; overflow-y: auto; font-family: var(--font-ui); font-size: 14px; line-height: 1.5; color: #bbb; }
        .log-msg { margin-bottom: 8px; border-bottom: 1px dashed #222; padding-bottom: 4px; animation: slideIn 0.3s; }
        .highlight { color: var(--c-gold); font-weight: bold; }

        /* CRAFTING */
        .craft-grid { display: flex; gap: 5px; margin-bottom: 10px; }
        .c-slot { flex: 1; aspect-ratio: 1; background: #000; border: 1px dashed #444; display: flex; justify-content: center; align-items: center; font-size: 24px; color: #555; transition: 0.3s; }
        .c-slot.filled { border-color: var(--c-gold); color: #fff; box-shadow: inset 0 0 10px var(--c-gold-dim); }

        /* INVENTORY */
        #inv-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .inv-slot { aspect-ratio: 1; background: #050505; border: 1px solid #333; border-radius: 4px; display: flex; justify-content: center; align-items: center; font-size: 20px; cursor: pointer; transition: 0.2s; position: relative; }
        .inv-slot.selected { border-color: var(--status-ok); box-shadow: inset 0 0 10px rgba(0,255,157,0.2); }

        /* SCANNER TOGGLE */
        #btn-scan {
            width: 100%; padding: 15px; background: transparent; border: 1px solid var(--c-cyan); color: var(--c-cyan);
            font-family: var(--font-display); font-weight: 700; cursor: pointer; transition: 0.3s;
            display: flex; justify-content: center; align-items: center; gap: 10px;
        }
        #btn-scan.active { background: rgba(102, 252, 241, 0.1); box-shadow: 0 0 15px rgba(102, 252, 241, 0.2); color: #fff; border-color: #fff; }

        /* * ==========================================================================
         * MODALS (DIALOGS & MINIGAMES)
         * ==========================================================================
         */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(5px); z-index: 5000;
            display: none; justify-content: center; align-items: center; padding: 20px;
        }
        .modal.open { display: flex; }

        .dialog-box {
            background: #0b0c10; border: 2px solid var(--c-cyan);
            box-shadow: 0 0 40px rgba(0, 242, 255, 0.15);
            width: 100%; max-width: 500px; border-radius: 8px; overflow: hidden;
        }
        .dialog-head { background: rgba(102, 252, 241, 0.1); padding: 15px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .dialog-title { color: var(--c-cyan); font-family: var(--font-display); font-weight: bold; text-transform: uppercase; }
        .dialog-close { cursor: pointer; font-size: 24px; color: #666; }
        .dialog-body { padding: 20px; text-align: center; }

        /* Minigame: Wave */
        #wave-cvs { width: 100%; height: 150px; background: #000; border: 1px solid #333; margin-bottom: 15px; }
        input[type=range] { width: 100%; height: 40px; cursor: pointer; }
        
        /* Minigame: Sonar */
        #sonar-wrap { width: 260px; height: 260px; border-radius: 50%; border: 2px solid var(--status-ok); background: radial-gradient(#002200, #000); margin: 0 auto; position: relative; overflow: hidden; }
        #sonar-beam { position: absolute; top:0; left:0; width:100%; height:100%; background: conic-gradient(transparent 0deg, rgba(0,255,0,0.5) 30deg, transparent 30deg); border-radius: 50%; animation: spin 2s linear infinite; }
        #sonar-point { position: absolute; width: 15px; height: 15px; background: #fff; border-radius: 50%; box-shadow: 0 0 10px #fff; opacity: 0; cursor: pointer; }

        /* Minigame: Keypad */
        #keypad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; width: 200px; margin: 0 auto; }
        .key { background: #222; border: 1px solid #444; padding: 15px; color: #fff; cursor: pointer; font-family: var(--font-code); }
        .key:hover { border-color: var(--c-cyan); color: var(--c-cyan); }
        #key-screen { background: #000; color: var(--c-cyan); font-family: var(--font-code); padding: 10px; margin-bottom: 10px; font-size: 24px; letter-spacing: 5px; border: 1px solid #444; }

        /* * ==========================================================================
         * MOBILE RESPONSIVE
         * ==========================================================================
         */
        @media (max-width: 900px) {
            #game-ui { grid-template-columns: 1fr; grid-template-rows: 60px 1fr auto; }
            header { padding: 0 15px; }
            .logo h1 { font-size: 18px; } .logo span { display: none; }
            .health-mon { font-size: 12px; } .bar-wrap { width: 100px; }
            
            aside { border-left: none; border-top: 2px solid #222; padding: 10px; gap: 10px; }
            #log-container { height: 80px; font-size: 13px; }
            
            #inventory-grid { grid-template-columns: repeat(6, 1fr); overflow-x: auto; padding-bottom: 5px; }
            .inv-slot { font-size: 22px; min-width: 50px; }
            
            .hotspot { width: 80px; height: 80px; }
            .hs-tag { bottom: -25px; font-size: 11px; background: rgba(0,0,0,0.95); }
        }

        @keyframes scan { 0% { top: 0%; } 100% { top: 100%; } }
        @keyframes blink { 50% { opacity: 0.3; } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes slideIn { from { opacity: 0; margin-left: -10px; } to { opacity: 1; margin-left: 0; } }

    </style>
</head>
<body>

    <div class="scanlines"></div>

    <div id="boot-layer" class="screen-layer active">
        <div style="font-size:14px; margin-bottom:10px;">BSF-OS v9.4 // INITIALIZING...</div>
        <div id="boot-logs" style="text-align:left; width:300px; color:var(--c-cyan); font-family:var(--font-code); height:150px; overflow:hidden;"></div>
    </div>

    <div id="intro-layer" class="screen-layer">
        <div class="info-card">
            <h1 class="title-large">×¤×¨×•×˜×•×§×•×œ ×”×¢×•×§×¥</h1>
            <div class="text-content">
                <p>×”×“×××” ×‘×§×¨×•×Ÿ ××¡×¤×¨ 5 ×”×•×¤×¨×”. ××“×™× ×™×¨×§×¨×§×™× ×©×œ ×’×– ×¨×¢×™×œ ×–×•×œ×’×™× ××”×ª×§×¨×”. ×”×“×œ×ª×•×ª × ×¢×•×œ×•×ª.</p>
                <p><strong>×”××©×™××”:</strong> ×‘×ª×•×¨ ××”× ×“×¡ ××›×•× ×•×ª, ×¢×œ×™×š ×œ×”×©×ª××© ×‘×¨×›×™×‘×™× ××œ×§×˜×¨×•× ×™×™× ×•×‘×¢×§×¨×•× ×•×ª ××¢×•×œ× ×”×˜×‘×¢ (×”×™×ª×•×©) ×›×“×™ ×œ× ×˜×¨×œ ××ª ×”××™×•×, ×œ×¤×¨×•×¥ ×œ×§×˜×¨ ×•×œ×”×¦×™×œ ××ª ×”× ×•×¡×¢×™×.</p>
                <p><strong>×”×•×¨××•×ª:</strong><br>
                1. ×”×©×ª××© ×‘<strong>×¡×•×¨×§ ×”×ª×¨××™</strong> ×›×“×™ ×œ××¦×•× ×—×¤×¦×™× × ×¡×ª×¨×™×.<br>
                2. ××¡×•×£ ×¨×›×™×‘×™× ×œ<strong>×ª×™×§ ×”×¦×™×•×“</strong>.<br>
                3. ×©×œ×‘ 3 ×¨×›×™×‘×™× ×‘<strong>×©×•×œ×—×Ÿ ×”×¢×‘×•×“×”</strong> ×›×“×™ ×œ×™×¦×•×¨ ×›×œ×™× ×‘×™×•××™××˜×™×™×.</p>
            </div>
            <button class="btn-base" onclick="Game.start()" style="width:100%; font-size:20px;">×”×ª×—×œ ××©×™××”</button>
        </div>
    </div>

    <div id="credits-layer" class="screen-layer">
        <div class="info-card">
            <h1 class="title-large" style="color:var(--status-ok)">××©×™××” ×”×•×©×œ××”</h1>
            <div style="margin-bottom:30px; font-size:18px;">
                ×”× ×•×’×“×Ÿ ×”×•×©×’. ×”× ×—×™×œ × ×•×˜×¨×œ.<br>×§×•×¨ ×”×¨×•×— ×•×”×”×‘× ×” ×”×”× ×“×¡×™×ª ×©×œ×š ×”×¦×™×œ×• ××ª ×›×•×œ×.
            </div>
            
            <ul class="credits-ul">
                <li>
                    <span class="role">×¤×™×ª×•×— ×•×§×•×“</span>
                    <span class="name">×¢×™×“×Ÿ ××‘×¨×‘×•×š (×¢× Gemini)</span>
                </li>
                <li>
                    <span class="role">×¡×™×¤×•×¨ ×•×ª×•×›×Ÿ</span>
                    <span class="name">×™×•××‘ ×¤×œ×“××Ÿ</span>
                </li>
                <li>
                    <span class="role">×¦×•×•×ª ×”×¤×¨×•×™×§×˜</span>
                    <span class="name">×¢×™×“×Ÿ ××‘×¨×‘×•×š, ×™×•××‘ ×¤×œ×“××Ÿ, ×¡×”×¨ ×—×“×“</span>
                </li>
            </ul>
            <button class="btn-base" onclick="location.reload()">××ª×—×•×œ ××¢×¨×›×ª</button>
        </div>
    </div>

    <div id="game-ui">
        
        <header>
            <div class="logo">
                <h1>MIVTZA CULEX</h1>
                <span>BIOMIMETIC INTERFACE</span>
            </div>
            <div class="health-mon">
                <span>×¨×¢×™×œ×•×ª:</span>
                <div class="bar-wrap"><div class="bar-fill" id="tox-bar"></div></div>
            </div>
        </header>

        <main id="viewport">
            <canvas id="fx-canvas"></canvas>
            
            <div id="ov-gas" class="overlay-fx" style="opacity:1;"></div>
            <div id="ov-thermal" class="overlay-fx"></div>
            <div id="ov-dark" class="overlay-fx"></div>

            <div class="scene-layer" id="layer-lab"></div>
            <div class="scene-layer" id="layer-hall"></div>
            <div class="scene-layer" id="layer-train"></div>

            <div id="hotspots">
                <div class="hotspot" id="hs-case" data-id="case" style="top:70%; left:75%;"><div class="hs-ring"></div><div class="hs-core"></div><div class="hs-tag">××–×•×•×“×”</div></div>
                <div class="hotspot" id="hs-seat" data-id="seat" style="top:60%; left:20%;"><div class="hs-ring"></div><div class="hs-core"></div><div class="hs-tag">××•×©×‘</div></div>
                <div class="hotspot" id="hs-vent" data-id="vent" style="top:5%; left:50%; width:150px; height:80px;"><div class="hs-ring" style="border-radius:10px;"></div><div class="hs-tag">×“×™×–×”</div></div>

                <div class="hotspot" id="hs-debris" data-id="debris" style="top:80%; left:30%; display:none;"><div class="hs-ring"></div><div class="hs-core"></div><div class="hs-tag">×’×¨×•×˜××•×ª</div></div>
                <div class="hotspot" id="hs-panel" data-id="panel" style="top:50%; left:12%; display:none;"><div class="hs-ring"></div><div class="hs-core"></div><div class="hs-tag">×¤×× ×œ</div></div>
                <div class="hotspot" id="hs-door" data-id="door" style="top:35%; left:50%; width:100px; height:200px; display:none;"><div class="hs-ring" style="border-radius:5px;"></div><div class="hs-tag">×“×œ×ª</div></div>

                <div class="hotspot" id="hs-closet" data-id="closet" style="top:60%; left:15%; display:none;"><div class="hs-ring"></div><div class="hs-core"></div><div class="hs-tag">××¨×•×Ÿ</div></div>
                <div class="hotspot" id="hs-enemy" data-id="enemy" style="top:35%; left:65%; width:120px; height:250px; display:none; opacity:0; pointer-events:none;"></div>
            </div>
        </main>

        <aside>
            <div class="panel" style="flex:1; display:flex; flex-direction:column;">
                <div class="panel-h">×™×•××Ÿ ××‘×¦×¢×™</div>
                <div id="log-container"></div>
            </div>

            <button id="btn-scan" class="btn-base" onclick="Game.toggleScanner()">ğŸ‘ï¸ ×¡×•×¨×§ ×ª×¨××™</button>

            <div class="panel">
                <div class="panel-h">×©×•×œ×—×Ÿ ×¢×‘×•×“×” (×‘×—×¨ 3)</div>
                <div class="craft-grid">
                    <div class="c-slot" id="slot-0"></div>
                    <div class="c-slot" id="slot-1"></div>
                    <div class="c-slot" id="slot-2"></div>
                </div>
                <button class="btn-base" id="btn-craft" style="width:100%; margin-top:10px;" onclick="Crafting.craft()" disabled>×‘×¦×¢ ××™× ×˜×’×¨×¦×™×”</button>
            </div>

            <div class="panel">
                <div class="panel-h">×¦×™×•×“</div>
                <div id="inv-grid"></div>
            </div>
        </aside>

    </div>

    <div id="mdl-msg" class="modal">
        <div class="dialog-box">
            <div class="dialog-head"><span class="dialog-title">×”×•×“×¢×”</span><span class="dialog-close" onclick="Modal.close('mdl-msg')">Ã—</span></div>
            <div class="dialog-body">
                <p id="msg-text" style="color:#ccc; font-size:18px; margin-bottom:20px;"></p>
                <button class="btn-base" onclick="Modal.close('mdl-msg')">××™×©×•×¨</button>
            </div>
        </div>
    </div>

    <div id="mdl-wave" class="modal">
        <div class="dialog-box">
            <div class="dialog-head"><span class="dialog-title">×›×™×•×œ ×ª×“×¨ ×¨×˜×˜</span></div>
            <div class="dialog-body">
                <p style="color:#aaa;">×”×–×– ××ª ×”××—×•×•×Ÿ ×›×“×™ ×œ×¡× ×›×¨×Ÿ ××ª ×”×’×œ×™× ×•×œ×—×“×•×¨ ××ª ×”×“×™×–×”.</p>
                <canvas id="wave-cvs"></canvas>
                <input type="range" id="wave-slider" min="0" max="100" value="50" style="width:100%">
                <div id="wave-stat" style="margin-top:10px; color:var(--status-crit); font-weight:bold;">×œ× ××¡×•× ×›×¨×Ÿ</div>
            </div>
        </div>
    </div>

    <div id="mdl-keypad" class="modal">
        <div class="dialog-box">
            <div class="dialog-head"><span class="dialog-title">×§×•×“ ×›× ×™×¡×”</span></div>
            <div class="dialog-body">
                <div id="key-screen">_ _ _ _</div>
                <div id="keypad"></div>
                <p style="font-size:12px; color:#666; margin-top:10px;">×¨××–: ×©× ×” × ×•×›×—×™×ª (2024)</p>
            </div>
        </div>
    </div>

    <div id="mdl-sonar" class="modal">
        <div class="dialog-box">
            <div class="dialog-head"><span class="dialog-title">××™×ª×•×¨ ×©××¢</span></div>
            <div class="dialog-body">
                <p style="color:#aaa;">×”×§×©×‘ ×œ×¤×¢×™××•×ª. ×œ×—×¥ ×¢×œ ×”× ×§×•×“×” ×”×œ×‘× ×” ×›×©×”×™× ××•×¤×™×¢×”.</p>
                <div id="sonar-wrap">
                    <div id="sonar-beam"></div>
                    <div id="sonar-point"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        /**
         * ------------------------------------------------------------------
         * DATA & CONFIG
         * ------------------------------------------------------------------
         */
        const DB = {
            Items: {
                MOTOR: { id: 'MOTOR', icon: 'âš™ï¸', name: '×× ×•×¢ ×¨×˜×˜' },
                NEEDLE: { id: 'NEEDLE', icon: 'ğŸ“', name: '××—×˜' },
                BATTERY: { id: 'BATTERY', icon: 'ğŸ”‹', name: '×¡×•×œ×œ×”' },
                DRILL: { id: 'DRILL', icon: 'ğŸ¦Ÿ', name: '××§×“×— ×¨×˜×˜', tool: true },
                LENS: { id: 'LENS', icon: 'ğŸ‘“', name: '×¢×“×©×•×ª' },
                SENSOR: { id: 'SENSOR', icon: 'ğŸŒ¡ï¸', name: '×—×™×™×©×Ÿ' },
                PARTS: { id: 'PARTS', icon: 'ğŸš', name: '×—×œ×§×™×' },
                GOGGLES: { id: 'GOGGLES', icon: 'ğŸ•¶ï¸', name: '××©×§×¤×™ ×ª×¨××™', tool: true },
                MIC: { id: 'MIC', icon: 'ğŸ™ï¸', name: '××™×§×¨×•×¤×•×Ÿ' },
                HEADSET: { id: 'HEADSET', icon: 'ğŸ§', name: '××•×–× ×™×™×”' },
                WIRE: { id: 'WIRE', icon: 'ğŸ”Œ', name: '×—×•×˜' },
                SONAR: { id: 'SONAR', icon: 'ğŸ“¡', name: '×¡×•×¨×§ ×§×•×œ×™', tool: true }
            },
            Story: {
                start: "×”×“×××” ×‘×§×¨×•×Ÿ 5 ×”×•×¤×¨×”. ×’×– ×¨×¢×™×œ ×××œ× ××ª ×”×—×œ×œ. ×”×“×™×–×” ××•×’× ×ª ×‘×œ×—×¥. ×¢×œ×™×š ×œ×‘× ×•×ª ×›×œ×™ ×—×“×™×¨×” ×¢×“×™×Ÿ.",
                p1_done: "×”×“×™×–×” × ×•×˜×¨×œ×”! ×”×’×– ×¤×¡×§. ×”×“×œ×ª × ×¤×ª×—×” ×œ××¡×“×¨×•×Ÿ ×—×©×•×š ××œ× ×‘××œ×›×•×“×•×ª.",
                p2_done: "×”××©×§×¤×™×™× ×—×•×©×¤×™× ××ª ×”×¡×›× ×•×ª. ×”×’×¢×ª ×œ×§×˜×¨. ×”××“×¢×Ÿ ×‘×—×•×©×š. ×”×©×ª××© ×‘×©××™×¢×”.",
            },
            Config: {
                toxRate: 0.05,
                doorCode: "2024"
            }
        };

        const State = {
            phase: 1, inventory: [], craft: [], solved: [], 
            scanner: false, toxicity: 0, dead: false
        };

        /**
         * ------------------------------------------------------------------
         * GAME ENGINE
         * ------------------------------------------------------------------
         */
        const Game = {
            init() {
                Inventory.render();
                Story.log(DB.Story.start);
                Fx.init();
                setInterval(this.tick, 100); // Game Loop

                // Hotspot Listeners
                document.querySelectorAll('.hotspot').forEach(el => {
                    el.addEventListener('click', (e) => this.handleSpot(el.dataset.id));
                });
            },

            start() {
                document.getElementById('intro-layer').style.display = 'none';
                document.getElementById('game-ui').classList.add('visible');
                this.init();
            },

            tick() {
                if(State.dead || State.phase > 3) return;
                
                // Toxicity Logic
                if(State.phase === 1) {
                    State.toxicity += DB.Config.toxRate;
                    const bar = document.getElementById('tox-bar');
                    bar.style.width = State.toxicity + "%";
                    if(State.toxicity > 70) bar.classList.add('crit');
                    
                    if(State.toxicity >= 100) {
                        State.dead = true;
                        Modal.msg("××•×•×ª", "×¨××ª ×”×¨×¢×™×œ×•×ª ×”×’×™×¢×” ×œ××§×¡×™××•×. × ×›×©×œ×ª.");
                        setTimeout(() => location.reload(), 3000);
                    }
                }
            },

            handleSpot(id) {
                // Scanner Check
                if (!State.scanner && !['vent', 'door', 'enemy'].includes(id)) {
                    Modal.msg("×©×’×™××”", "×œ× × ×™×ª×Ÿ ×œ×–×”×•×ª ××•×‘×™×™×§×˜. × ×“×¨×©×ª ×¡×¨×™×§×” ×ª×¨××™×ª.");
                    return;
                }
                if (State.solved.includes(id)) return;

                // Phase 1
                if (id === 'case') this.collect(['MOTOR', 'BATTERY'], id, "×× ×•×¢ ×•×¡×•×œ×œ×”");
                if (id === 'seat') this.collect(['NEEDLE'], id, "××—×˜");
                if (id === 'vent') {
                    if (Inventory.has('DRILL')) Minigames.wave();
                    else Modal.msg("×¡×›× ×”", "× ×’×™×¢×” ×ª×¤×¢×™×œ ××œ×›×•×“. × ×“×¨×© ××§×“×— ×¨×˜×˜.");
                }

                // Phase 2
                if (id === 'debris') this.collect(['LENS', 'PARTS'], id, "×¢×“×©×•×ª ×•×—×œ×§×™×");
                if (id === 'panel') this.collect(['SENSOR'], id, "×—×™×™×©×Ÿ ×ª×¨××™");
                if (id === 'door') {
                    if (Inventory.has('GOGGLES')) Minigames.keypad();
                    else Modal.msg("×¡×›× ×”", "×—×•×©×š ×•××œ×›×•×“×•×ª. ××™ ××¤×©×¨ ×œ×¢×‘×•×¨ ×‘×œ×™ ×œ×¨××•×ª.");
                }

                // Phase 3
                if (id === 'closet') this.collect(['MIC', 'HEADSET', 'WIRE'], id, "×¦×™×•×“ ×©××¢");
                if (id === 'enemy') {
                    if(Inventory.has('SONAR')) Minigames.sonar();
                    else Modal.msg("?", "××©×”×• ×–×– ×‘×—×•×©×š. ×× ×™ ×¦×¨×™×š ×œ×©××•×¢ ××•×ª×•.");
                }
            },

            collect(keys, id, name) {
                keys.forEach(k => Inventory.add(DB.Items[k]));
                State.solved.push(id);
                document.querySelector(`[data-id="${id}"]`).style.display = 'none';
                Story.log(`××¦××ª: ${name}`);
            },

            toggleScanner() {
                State.scanner = !State.scanner;
                const btn = document.getElementById('btn-scan');
                if (State.scanner) {
                    btn.classList.add('active');
                    document.body.classList.add('scanner-on');
                    if (State.phase===2) document.getElementById('ov-thermal').style.opacity = 1;
                } else {
                    btn.classList.remove('active');
                    document.body.classList.remove('scanner-on');
                    document.getElementById('ov-thermal').style.opacity = 0;
                }
            },

            phase2() {
                State.phase = 2;
                Story.log(DB.Story.p1_done);
                document.getElementById('ov-gas').style.opacity = 0;
                document.getElementById('layer-train').style.opacity = 0;
                document.getElementById('layer-hall').style.opacity = 1;
                
                ['vent','case','seat'].forEach(id => document.querySelector(`[data-id="${id}"]`).style.display = 'none');
                ['debris','panel','door'].forEach(id => document.querySelector(`[data-id="${id}"]`).style.display = 'flex');
            },

            phase3() {
                State.phase = 3;
                Story.log(DB.Story.p2_done);
                document.getElementById('ov-thermal').style.opacity = 0;
                document.getElementById('ov-dark').style.opacity = 1;
                document.getElementById('layer-hall').style.opacity = 0;
                document.getElementById('layer-engine').style.opacity = 1;

                ['debris','panel','door'].forEach(id => document.querySelector(`[data-id="${id}"]`).style.display = 'none');
                document.querySelector(`[data-id="closet"]`).style.display = 'flex';
                // ××•×™×‘ ××•×¡×ª×¨ ×¢×“ ×©×™×© ×¡×•× ××¨
                document.querySelector(`[data-id="enemy"]`).style.display = 'block';
            },

            win() {
                document.getElementById('credits-layer').classList.add('active');
            }
        };

        /** INVENTORY & CRAFTING */
        const Inventory = {
            add(item) {
                if(this.has(item.id)) return;
                State.inventory.push(item);
                this.render();
            },
            has(id) { return State.inventory.some(i => i.id === id); },
            render() {
                const grid = document.getElementById('inv-grid');
                grid.innerHTML = '';
                for(let i=0; i<8; i++) {
                    const div = document.createElement('div');
                    div.className = 'inv-slot';
                    if (State.inventory[i]) {
                        div.innerText = State.inventory[i].icon;
                        if(State.craft.includes(i)) div.classList.add('selected');
                        div.onclick = () => this.toggle(i);
                    }
                    grid.appendChild(div);
                }
            },
            toggle(i) {
                if(State.craft.includes(i)) State.craft = State.craft.filter(x => x !== i);
                else if(State.craft.length < 3) State.craft.push(i);
                this.render(); Crafting.update();
            },
            consume() {
                State.craft.sort((a,b)=>b-a).forEach(i => State.inventory.splice(i,1));
                State.craft = []; this.render(); Crafting.update();
            }
        };

        const Crafting = {
            update() {
                [0,1,2].forEach(i => {
                    const el = document.getElementById(`slot-${i}`);
                    el.innerHTML = ''; el.classList.remove('filled');
                    if(State.craft[i] !== undefined) {
                        el.innerHTML = State.inventory[State.craft[i]].icon;
                        el.classList.add('filled');
                    }
                });
                document.getElementById('btn-craft').disabled = (State.craft.length !== 3);
            },
            craft() {
                if(State.craft.length !== 3) return;
                const ids = State.craft.map(i => State.inventory[i].id);
                
                if(this.check(ids, ['MOTOR','NEEDLE','BATTERY'])) {
                    Inventory.consume(); Inventory.add(DB.Items.DRILL); Story.log("×‘× ×™×ª ××§×“×— ×¨×˜×˜.");
                } else if(this.check(ids, ['LENS','SENSOR','PARTS'])) {
                    Inventory.consume(); Inventory.add(DB.Items.GOGGLES); Story.log("×‘× ×™×ª ××©×§×¤×™ ×ª×¨××™.");
                } else if(this.check(ids, ['MIC','HEADSET','WIRE'])) {
                    Inventory.consume(); Inventory.add(DB.Items.SONAR); Story.log("×‘× ×™×ª ×¡×•×¨×§ ×©××¢.");
                } else {
                    Modal.msg("×©×’×™××”", "×©×™×œ×•×‘ ×œ× ×ª×§×™×Ÿ.");
                }
            },
            check(sel, req) { return req.every(r => sel.includes(r)); }
        };

        /** MINIGAMES */
        const Minigames = {
            wave() {
                Modal.open('mdl-wave');
                setTimeout(() => {
                    const c = document.getElementById('wave-cvs'); const ctx = c.getContext('2d');
                    c.width = c.offsetWidth; c.height = c.offsetHeight;
                    const rng = document.getElementById('wave-slider');
                    let val = 50, t = 0; rng.oninput = e => val = parseInt(e.target.value);
                    
                    function loop() {
                        if(!document.getElementById('mdl-wave').classList.contains('open')) return;
                        ctx.fillStyle = '#000'; ctx.fillRect(0,0,c.width,c.height);
                        t += 0.2;
                        
                        // Target Green
                        ctx.strokeStyle = '#0f0'; ctx.beginPath();
                        for(let x=0; x<c.width; x++) ctx.lineTo(x, 75 + Math.sin((x+t*5)*0.1)*40);
                        ctx.stroke();
                        
                        // User Blue
                        const diff = Math.abs(val - 72);
                        ctx.strokeStyle = diff < 5 ? '#ffb700' : '#00f2ff'; ctx.beginPath();
                        const f = val/500;
                        for(let x=0; x<c.width; x++) ctx.lineTo(x, 75 + Math.sin((x+t*5)*f)*40);
                        ctx.stroke();

                        const st = document.getElementById('wave-stat');
                        if(diff < 5) { st.innerText = "× ×¢×•×œ!"; st.style.color = "#0f0"; setTimeout(()=>{Modal.close('mdl-wave'); Game.phase2();}, 1000); }
                        else { st.innerText = "×œ× ××¡×•× ×›×¨×Ÿ"; st.style.color = "red"; }
                        
                        requestAnimationFrame(loop);
                    }
                    loop();
                }, 100);
            },
            keypad() {
                Modal.open('mdl-keypad');
                const p = document.getElementById('keypad'); p.innerHTML = '';
                const s = document.getElementById('key-screen');
                let code = "";
                [1,2,3,4,5,6,7,8,9].forEach(n => {
                    let b = document.createElement('div'); b.className = 'key'; b.innerText = n;
                    b.onclick = () => {
                        code += n; s.innerText = code;
                        if(code.length === 4) {
                            if(code === DB.Config.doorCode) { Modal.close('mdl-keypad'); Game.startPhase3(); }
                            else { s.innerText = "ERR"; code=""; setTimeout(()=>s.innerText="_ _ _ _", 500); }
                        }
                    };
                    p.appendChild(b);
                });
            },
            sonar() {
                Modal.open('mdl-sonar');
                const pt = document.getElementById('sonar-point');
                setInterval(() => {
                    const x = 130 + 80 * Math.cos(Date.now()/1000);
                    const y = 130 + 80 * Math.sin(Date.now()/1000);
                    pt.style.left = (x-7)+'px'; pt.style.top = (y-7)+'px';
                    pt.style.opacity = (Math.sin(Date.now()/100)>0.8) ? 1 : 0;
                }, 50);
                pt.onclick = () => { Modal.close('mdl-sonar'); Game.win(); };
            }
        };

        /** UTILS */
        const Story = { log(t) { const d=document.createElement('div'); d.className='log-msg'; d.innerHTML = `> ${t}`; document.getElementById('log-container').prepend(d); } };
        const Modal = { open(id) { document.getElementById(id).classList.add('open'); }, close(id) { document.getElementById(id).classList.remove('open'); }, msg(t,x) { document.getElementById('msg-text').innerText=x; this.open('mdl-msg'); } };
        const Fx = { init() { const c=document.getElementById('fx-canvas'); const x=c.getContext('2d'); c.width=window.innerWidth; c.height=window.innerHeight; const p=Array(50).fill().map(()=>({x:Math.random()*c.width,y:Math.random()*c.height,v:Math.random()})); function l(){x.clearRect(0,0,c.width,c.height);x.fillStyle='rgba(255,255,255,0.1)';p.forEach(d=>{d.y-=d.v;if(d.y<0)d.y=c.height;x.beginPath();x.arc(d.x,d.y,1,0,Math.PI*2);x.fill();});requestAnimationFrame(l);}l(); } };

        // BOOT SEQUENCE
        window.onload = () => {
            const l = document.getElementById('boot-logs');
            const txt = ["Initializing...", "Loading drivers...", "Connecting...", "Secure."];
            let i = 0;
            const t = setInterval(() => {
                if(i<txt.length) { l.innerHTML += `> ${txt[i]}<br>`; i++; }
                else {
                    clearInterval(t); document.querySelector('.loading-fill').style.width = "100%";
                    setTimeout(() => {
                        document.getElementById('boot-screen').style.display = 'none';
                        document.getElementById('intro-layer').classList.add('active');
                    }, 800);
                }
            }, 600);
        };
    </script>
</body>
</html>
