<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>פרויקט CULEX | סימולציית הישרדות</title>
    <style>
        /* --- CORE STYLES --- */
        :root {
            --bg-color: #050a0f;
            --terminal-bg: #0d1117;
            --text-color: #c9d1d9;
            --accent-cyan: #58a6ff;
            --accent-green: #2ea043;
            --accent-red: #da3633;
            --glass: rgba(22, 27, 34, 0.95);
            --font-mono: 'Courier New', Courier, monospace;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-mono);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-image: radial-gradient(circle at 50% 50%, #161b22 0%, #000000 100%);
        }

        /* --- GAME CONTAINER --- */
        #terminal {
            width: 100%;
            max-width: 900px;
            background: var(--terminal-bg);
            border: 1px solid #30363d;
            border-radius: 12px;
            box-shadow: 0 0 30px rgba(88, 166, 255, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 90vh;
        }

        /* --- HEADER & HUD --- */
        .hud {
            background: #161b22;
            padding: 15px;
            border-bottom: 1px solid #30363d;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .hud-stat {
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-bar-container {
            width: 200px;
            height: 10px;
            background: #30363d;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: var(--accent-cyan);
            width: 0%;
            transition: width 0.5s ease;
        }

        .antidote-counter {
            color: var(--accent-green);
            font-weight: bold;
            font-size: 1.2rem;
            text-shadow: 0 0 10px rgba(46, 160, 67, 0.5);
        }

        /* --- MAIN SCREEN AREA --- */
        .screen-content {
            flex-grow: 1;
            padding: 30px;
            overflow-y: auto;
            position: relative;
        }

        .story-section {
            display: none;
            animation: fadeIn 0.6s ease;
        }

        .story-section.active {
            display: block;
        }

        h2 { color: var(--accent-cyan); border-bottom: 1px dashed #30363d; padding-bottom: 10px; }
        .narrative { line-height: 1.6; margin-bottom: 20px; font-size: 1.1rem; }
        .highlight { color: var(--accent-cyan); font-weight: bold; }
        
        /* --- INTERACTIVE ELEMENTS --- */
        .puzzle-box {
            background: rgba(48, 54, 61, 0.3);
            border: 1px solid var(--accent-cyan);
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        button {
            background: transparent;
            border: 1px solid var(--accent-green);
            color: var(--accent-green);
            padding: 10px 20px;
            font-family: var(--font-mono);
            cursor: pointer;
            margin: 5px;
            transition: all 0.2s;
            border-radius: 4px;
        }

        button:hover { background: rgba(46, 160, 67, 0.1); }
        button.danger { border-color: var(--accent-red); color: var(--accent-red); }
        button.danger:hover { background: rgba(218, 54, 51, 0.1); }

        /* --- VISUALS (CSS ART) --- */
        
        /* 1. Radar / Thermal View */
        .radar-view {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 2px solid var(--accent-red);
            background: radial-gradient(circle, transparent 20%, rgba(218, 54, 51, 0.1) 20%);
            position: relative;
            margin: 20px auto;
            overflow: hidden;
        }
        .radar-line {
            width: 50%;
            height: 2px;
            background: var(--accent-red);
            position: absolute;
            top: 50%;
            left: 50%;
            transform-origin: 0 0;
            animation: scan 2s infinite linear;
        }
        .heat-spot {
            width: 10px;
            height: 10px;
            background: red;
            border-radius: 50%;
            position: absolute;
            top: 30%;
            left: 70%;
            box-shadow: 0 0 10px red;
            cursor: pointer;
        }

        /* 2. Frequency Waves */
        .wave-container {
            display: flex;
            justify-content: center;
            gap: 5px;
            height: 60px;
            align-items: center;
            margin: 20px 0;
        }
        .bar {
            width: 6px;
            background: var(--accent-cyan);
            animation: sound 1s infinite ease-in-out;
        }
        
        /* 3. Fog Effect */
        .fog-overlay {
            position: relative;
            height: 100px;
            background: #222;
            border: 1px solid #555;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            overflow: hidden;
        }
        .fog-cloud {
            position: absolute;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(8px);
            transition: opacity 1s;
        }
        .hidden-code { font-size: 2rem; letter-spacing: 5px; font-weight: bold; color: white; }

        /* 4. Microscope View (Needle) */
        .microscope {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            border: 5px solid #444;
            margin: 0 auto;
            background: #fff;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
        }
        .needle-smooth {
            width: 100%;
            height: 10px;
            background: #333;
            position: absolute;
            top: 60%;
            transform: rotate(-15deg);
        }
        .needle-serrated {
            width: 100%;
            height: 10px;
            background: repeating-linear-gradient(45deg, #333, #333 5px, #fff 5px, #fff 7px);
            position: absolute;
            top: 40%;
            transform: rotate(-15deg);
        }

        /* --- ANIMATIONS --- */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes scan { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes sound { 0%, 100% { height: 10px; } 50% { height: 50px; } }
        
        .shake { animation: shake 0.5s; }
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } 100% { transform: translateX(0); } }

    </style>
</head>
<body>

<div id="terminal">
    <div class="hud">
        <div class="hud-stat">
            <span>התקדמות:</span>
            <div class="progress-bar-container">
                <div id="progress-fill" class="progress-bar-fill"></div>
            </div>
            <span id="car-number">מעבדה</span>
        </div>
        <div class="hud-stat">
            מזרקי נוגדן: <span id="antidote-count" class="antidote-counter">6</span>
        </div>
    </div>

    <div class="screen-content">
        
        <div id="intro" class="story-section active">
            <h2>יומן ניסוי: שלב 0 - המעבדה</h2>
            <div class="narrative">
                <p>לפני שאתה מתעורר ברכבת, אתה זוכר את המעבדה הלבנה. ד"ר ארקדיוס עומד מעליך.</p>
                <p>"בני האדם מגושמים," הוא ממלמל, מכוון אליך מיקרוסקופ ענק. "תראה את היתוש. תראה את החדק שלו. זה לא סתם צינור, זו יצירת מופת."</p>
                <p>הוא מזריק לך נוזל ירוק זוהר.</p>
                <p>"זהו סרום סימון. החיישנים ברכבת מכויילים לזהות אותך כמו שהיתוש מזהה קורבן. אבל אם תחשוב כמו יתוש... אולי תצליח לשרוד. יש לך 6 נוגדנים. אל תבזבז אותם על טעויות."</p>
            </div>
            <button onclick="nextLevel(1)">התעורר ברכבת</button>
        </div>

        <div id="car-1" class="story-section">
            <h2>קרון 1: הדקירה הבלתי מורגשת</h2>
            <div class="narrative">
                <p>אתה מתעורר. ילדה קטנה חוסמת את הדלת. היא צריכה חיסון כדי לזוז, אבל היא בבעתה מהמחט.</p>
                <p>בארגז הכלים שלך יש שני סוגי מחטים. המיקרוסקופ מראה את המבנה שלהן:</p>
            </div>
            <div class="microscope">
                <div class="needle-smooth" title="מחט חלקה רגילה"></div>
                <div class="needle-serrated" title="מחט ביומימטית"></div>
            </div>
            <div class="puzzle-box">
                <p>באיזו מחט תבחר כדי שהילדה לא תרגיש את הדקירה?</p>
                <button class="danger" onclick="wrongAnswer('בחרת במחט החלקה הרגילה. זה כאב לה. היא זזה והמחט נשברה. איבדת מנה.')">מחט חלקה וישרה</button>
                <button onclick="correctAnswer(2, 'בחרת במחט המשוננת (Micro-serrated). השינון מפחית את המגע עם העצבים. הילדה לא הרגישה כלום.')">מחט משוננת רוטטת</button>
            </div>
        </div>

        <div id="car-2" class="story-section">
            <h2>קרון 2: ראיית חום (Thermal)</h2>
            <div class="narrative">
                <p>הקרון חשוך לחלוטין. יש כאן דליפת גז רותח בלתי נראה. אם תעבור דרכה - תמות.</p>
                <p>יתושים משתמשים בחיישני חום כדי למצוא כלי דם. אתה מפעיל את משקפי ה-IR שלך.</p>
            </div>
            <div class="radar-view">
                <div class="radar-line"></div>
                <div class="heat-spot" onclick="correctAnswer(3, 'זיהית את מקור החום ועקפת אותו בבטחה.')"></div>
            </div>
            <div class="puzzle-box">
                <p>המשקפיים מראים נקודה אדומה לוהטת בצד ימין. לחץ עליה כדי לסמן למערכת לעקוף אותה.</p>
            </div>
        </div>

        <div id="car-3" class="story-section">
            <h2>קרון 3: משטח המים</h2>
            <div class="narrative">
                <p>הקרון הזה מוצף במים חומציים בגובה הקרסול. אי אפשר לדרוך על הרצפה.</p>
                <p>יש כאן רפסודות זעירות הפועלות על עקרון <strong>מתח הפנים</strong>, כמו רגלי היתוש העומדות על המים.</p>
            </div>
            <div class="puzzle-box">
                <p>איך עליך להניח את הרגליים/רפסודות כדי לא לשקוע?</p>
                <button class="danger" onclick="wrongAnswer('הפעלת כוח ממוקד מדי. מתח הפנים נשבר. שקעת למים החומציים.')">דריכה חזקה ונקודתית</button>
                <button onclick="correctAnswer(4, 'פיזרת את המשקל על שטח פנים רחב תוך ניצול קשרי המימן במים. אתה צף.')">פיזור משקל אופקי (Hydrophobic legs)</button>
            </div>
        </div>

        <div id="car-4" class="story-section">
            <h2>קרון 4: ייצוב טיסה</h2>
            <div class="narrative">
                <p>מאווררי ענק יוצרים רוח הוריקן. אתה חייב לשגר רחפן זעיר לצד השני כדי ללחוץ על הכפתור.</p>
                <p>רחפנים רגילים מתרסקים. עליך להפעיל את מצב "Halteres" (בוכניות האיזון של היתוש).</p>
            </div>
            <div class="wave-container">
                <div class="bar" style="animation-duration: 0.2s"></div>
                <div class="bar" style="animation-duration: 0.5s"></div>
                <div class="bar" style="animation-duration: 0.3s"></div>
                <div class="bar" style="animation-duration: 0.2s"></div>
            </div>
            <div class="puzzle-box">
                <p>הכנס את תדר הרטט הנכון (בין 500 ל-600 הרץ) לייצוב:</p>
                <input type="number" id="freq-input" placeholder="Hz" style="background:#000; color:#fff; border:1px solid #555; padding:5px;">
                <button onclick="checkFreq()">שגר רחפן</button>
            </div>
        </div>

        <div id="car-5" class="story-section">
            <h2>קרון 5: חדר השינה</h2>
            <div class="narrative">
                <p>שומרים רובוטיים ישנים בקרון. הם רגישים לתנועה.</p>
                <p>היתוש ממריא בצורה ייחודית: הוא קודם כל מנופף בכנפיים ורק אז דוחף עם הרגליים, כדי למנוע "בעיטה" מורגשת בעור.</p>
            </div>
            <div class="puzzle-box">
                <p>איך תתגנב מעל הלוחיות הרגישות ברצפה?</p>
                <button class="danger" onclick="wrongAnswer('דחיפה חזקה הפעילה את החיישנים. השומרים התעוררו.')">קפיצה מהירה (דחיפת רגליים)</button>
                <button onclick="correctAnswer(6, 'המראה רכה. קודם יצרת עילוי, ורק אז ניתקת מגע. החיישנים לא זיהו לחץ.')">המראה מבוססת כנפיים (Wing-first)</button>
            </div>
        </div>

        <div id="car-6" class="story-section">
            <h2>קרון 6: גנטיקה ומיון</h2>
            <div class="narrative">
                <p>אתה בחדר מלא במיכלי יתושים משוכפלים. הדלת תיפתח רק אם תזהה את היתוש ש<strong>לא</strong> עוקץ.</p>
                <p>ידע כללי ביומימטי: רק הנקבות עוקצות (זקוקות לחלבון לביצים). הזכרים ניזונים מצוף.</p>
            </div>
            <div class="puzzle-box">
                <p>איזה מיכל תשחרר כדי שיהיה בטוח לעבור?</p>
                <button class="danger" onclick="wrongAnswer('שחררת נקבות! הן רעבות לדם. היית צריך להזריק נוגדן.')">מיכל יתושים עם בטן אדומה (נקבות)</button>
                <button onclick="correctAnswer(7, 'נכון! הזכרים אינם עוקצים. המעבר בטוח.')">מיכל יתושים עם מחושים נוצתיים (זכרים)</button>
            </div>
        </div>

        <div id="car-7" class="story-section">
            <h2>קרון 7: הערפל</h2>
            <div class="narrative">
                <p>הקוד לדלת כתוב על הזכוכית, אבל הכל מכוסה אדים. ניגוב רגיל רק מורח את המים.</p>
                <p>השתמש בתרסיס ננו-מטרי (השראת עיני יתוש) הדוחה מים באופן מוחלט.</p>
            </div>
            <div class="fog-overlay" onclick="clearFog(this)">
                <div class="fog-cloud"></div>
                <div class="hidden-code">8841</div>
            </div>
            <div class="puzzle-box">
                <p>לחץ על הערפל כדי להפעיל את הציפוי ההידרופובי.</p>
                <p>מה הקוד?</p>
                <input type="text" id="code-input" style="background:#000; color:#fff; border:1px solid #555; padding:5px;">
                <button onclick="checkCode()">פתח דלת</button>
            </div>
        </div>

        <div id="car-8" class="story-section">
            <h2>קרון 8: התנגשות</h2>
            <div class="narrative">
                <p>מסדרון צר מלא בקרני לייזר נעים במהירות. קשה לחשב את המסלול.</p>
                <p>יתושים משתמשים במחושים כדי לחוש שינויים בלחץ האוויר סביב חפצים מתקרבים, עוד לפני שהם נוגעים בהם.</p>
            </div>
            <div class="puzzle-box">
                <p>המערכת מזהה "דחיסת אוויר" משמאל. לאן תזוז?</p>
                <button class="danger" onclick="wrongAnswer('זזת שמאלה ישר לתוך הלייזר.')">שמאלה</button>
                <button onclick="correctAnswer(9, 'הרגשת את לחץ האוויר וזזת ימינה בזמן.')">ימינה</button>
            </div>
        </div>

        <div id="car-9" class="story-section">
            <h2>קרון 9: המלכודת הכימית</h2>
            <div class="narrative">
                <p>שני פתחי אוורור. אחד מוביל החוצה, השני מוביל למיכל גז. אין שילוט.</p>
                <p>היתוש מזהה CO2 (פחמן דו-חמצני) ממרחקים כדי למצוא חיים. כאן, אתה מחפש אוויר צח (פחות CO2).</p>
            </div>
            <div class="puzzle-box">
                <div style="display:flex; justify-content:space-around;">
                    <div style="text-align:center">
                        <div>פתח א'</div>
                        <div style="color:red">CO2: 4500ppm</div>
                    </div>
                    <div style="text-align:center">
                        <div>פתח ב'</div>
                        <div style="color:green">CO2: 400ppm</div>
                    </div>
                </div>
                <p>לאן תלך?</p>
                <button class="danger" onclick="wrongAnswer('הלכת למקור ה-CO2 הגבוה. זה היה אגזוז המנוע. נחנקת.')">פתח א'</button>
                <button onclick="correctAnswer(10, 'זיהית את ריכוז ה-CO2 הנמוך של האוויר הצח.')">פתח ב'</button>
            </div>
        </div>

        <div id="car-10" class="story-section">
            <h2>קרון 10: ד"ר ארקדיוס</h2>
            <div class="narrative">
                <p>הגעת לקטר. ארקדיוס יושב בחושך. "אתה שומע את זה?" הוא לוחש.</p>
                <p>יתושים שומעים באמצעות איבר ג'ונסטון במחושים, המכויל לתדרים ספציפיים.</p>
                <p>יש כאן שלושה מפסקים. רק אחד משמיע זמזום בתדר 400Hz (תדר הנקבה). השאר הם מלכודות.</p>
            </div>
            <div class="wave-container">
                <button onclick="playAudio(1)">מתג 1 (200Hz)</button>
                <button onclick="playAudio(2)">מתג 2 (400Hz)</button>
                <button onclick="playAudio(3)">מתג 3 (800Hz)</button>
            </div>
            <div class="puzzle-box">
                <p>איזה מתג תשבור?</p>
                <button class="danger" onclick="wrongAnswer('תדר נמוך מדי. זה היה מלכודת.')">מתג 1</button>
                <button onclick="finishGame()">מתג 2</button>
                <button class="danger" onclick="wrongAnswer('תדר גבוה מדי. התחשמלת.')">מתג 3</button>
            </div>
        </div>

        <div id="screen-win" class="story-section">
            <h1 style="color:var(--accent-green)">ניצחון ביומימטי!</h1>
            <p>שברת את המתג הנכון. הרכבת עוצרת. הדלתות נפתחות.</p>
            <p>הבנת את המכונה של הטבע, והשתמשת בה כדי להביס את המכונה של האדם.</p>
            <p>נוגדנים שנותרו: <span id="final-score"></span>/6</p>
            <button onclick="location.reload()">שחק שוב</button>
        </div>

        <div id="screen-lose" class="story-section">
            <h1 style="color:var(--accent-red)">כישלון מערכתי</h1>
            <p>אזלו הנוגדנים. הרעל הכריע אותך.</p>
            <p>ד"ר ארקדיוס רושם ביומן: "נסיין 894 נכשל בהסתגלות."</p>
            <button onclick="location.reload()">נסה שוב</button>
        </div>

    </div>
</div>

<script>
    // Game State
    let state = {
        antidotes: 6,
        currentLevel: 0
    };

    // DOM Elements
    const elAntidotes = document.getElementById('antidote-count');
    const elProgressBar = document.getElementById('progress-fill');
    const elCarNum = document.getElementById('car-number');

    function updateHUD() {
        elAntidotes.innerText = state.antidotes;
        const progress = (state.currentLevel / 10) * 100;
        elProgressBar.style.width = `${progress}%`;
        
        if (state.antidotes <= 0) {
            showScreen('screen-lose');
        }
    }

    function showScreen(id) {
        document.querySelectorAll('.story-section').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function nextLevel(levelNum) {
        state.currentLevel = levelNum;
        elCarNum.innerText = `קרון ${levelNum}`;
        updateHUD();
        showScreen(`car-${levelNum}`);
    }

    function correctAnswer(nextLevelNum, msg) {
        alert("הצלחה: " + msg);
        if (nextLevelNum > 10) {
            finishGame();
        } else {
            nextLevel(nextLevelNum);
        }
    }

    function wrongAnswer(msg) {
        alert("שגיאה: " + msg + " (איבדת נוגדן)");
        state.antidotes--;
        updateHUD();
        document.getElementById('terminal').classList.add('shake');
        setTimeout(() => document.getElementById('terminal').classList.remove('shake'), 500);
    }

    // Specific Puzzle Logic
    
    // Car 4: Freq
    function checkFreq() {
        const val = parseInt(document.getElementById('freq-input').value);
        if (val >= 500 && val <= 600) {
            correctAnswer(5, "התדר התייצב. הרחפן חצה את הרוח.");
        } else {
            wrongAnswer("תדר לא יציב. הרחפן התרסק.");
        }
    }

    // Car 7: Fog
    function clearFog(el) {
        el.querySelector('.fog-cloud').style.opacity = '0';
    }

    function checkCode() {
        if (document.getElementById('code-input').value === '8841') {
            correctAnswer(8, "הדלת נפתחה.");
        } else {
            wrongAnswer("קוד שגוי.");
        }
    }

    // Car 10: Audio simulation
    function playAudio(type) {
        // Just visual simulation via alert for simplicity in this file
        if (type === 2) alert("*זמזום יתוש מדויק בתדר 400Hz*");
        else alert("*רעש סטטי צורם*");
    }

    function finishGame() {
        document.getElementById('final-score').innerText = state.antidotes;
        showScreen('screen-win');
    }

</script>

</body>
</html>
