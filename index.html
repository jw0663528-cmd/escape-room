<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROJECT CULEX | CLASSIFIED</title>
    <style>
        :root {
            --bg: #0a0a0a;
            --term-bg: #111;
            --text-main: #33ff00; /* Classic Terminal Green */
            --text-dim: #1a8000;
            --accent: #d4ff00;
            --danger: #ff3300;
            --font-stack: 'Courier New', Courier, monospace;
        }

        * { box-sizing: border-box; user-select: none; }

        body {
            margin: 0;
            padding: 0;
            background: var(--bg);
            color: var(--text-main);
            font-family: var(--font-stack);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        /* --- LAYOUT --- */
        #game-wrapper {
            display: grid;
            grid-template-columns: 3fr 1fr; /* Main Screen | System Log */
            width: 95vw;
            height: 90vh;
            border: 2px solid var(--text-dim);
            box-shadow: 0 0 20px rgba(51, 255, 0, 0.1);
            background: var(--term-bg);
        }

        /* --- MAIN SCREEN --- */
        #main-interface {
            padding: 20px;
            border-left: 2px solid var(--text-dim);
            display: flex;
            flex-direction: column;
            position: relative;
        }

        #header {
            display: flex;
            justify-content: space-between;
            border-bottom: 1px dashed var(--text-dim);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        #narrative-box {
            margin-bottom: 30px;
            font-size: 1.1rem;
            line-height: 1.5;
            color: #ddd;
        }

        #interaction-area {
            flex-grow: 1;
            border: 1px solid var(--text-dim);
            background: rgba(0, 20, 0, 0.5);
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        /* --- SYSTEM LOG --- */
        #system-log {
            padding: 10px;
            background: #000;
            font-size: 0.8rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column-reverse; /* Newest at bottom visually */
            border-right: 2px solid var(--text-dim);
        }

        .log-entry { margin-bottom: 5px; border-bottom: 1px solid #222; padding: 2px 0; }
        .log-entry.error { color: var(--danger); }
        .log-entry.success { color: var(--accent); }
        .log-entry.info { color: #888; }

        /* --- GENERIC UI ELEMENTS --- */
        button.term-btn {
            background: transparent;
            border: 1px solid var(--text-main);
            color: var(--text-main);
            padding: 10px 20px;
            font-family: var(--font-stack);
            cursor: pointer;
            transition: 0.2s;
            margin: 5px;
        }
        button.term-btn:hover { background: var(--text-main); color: #000; }
        
        /* --- PUZZLE SPECIFIC CSS --- */
        
        /* Level 1: Needles */
        .needle-container { display: flex; gap: 50px; }
        .needle-option { 
            width: 100px; height: 200px; border: 1px solid #333; position: relative; cursor: pointer; 
            transition: border 0.3s;
        }
        .needle-option:hover { border-color: var(--text-main); }
        .n-straight { width: 4px; height: 150px; background: #888; margin: 25px auto; }
        .n-serrated { 
            width: 6px; height: 150px; margin: 25px auto;
            background: repeating-linear-gradient(180deg, #888, #888 5px, transparent 5px, transparent 8px);
        }

        /* Level 2: Thermal */
        .thermal-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 2px; width: 300px; height: 300px; }
        .thermal-cell { background: #111; cursor: crosshair; transition: background 0.5s; }
        .thermal-cell:hover { background: #222; } /* Default hover */

        /* Level 3: Drone Slider */
        .slider-container { width: 80%; text-align: center; }
        input[type=range] { width: 100%; accent-color: var(--text-main); }
        .wave-visual { height: 50px; border-bottom: 2px solid var(--text-dim); margin-bottom: 10px; display: flex; align-items: flex-end; gap: 2px;}
        .wave-bar { width: 5px; background: var(--text-main); animation: wave 0.5s infinite; }
        
        /* Level 6: Mosquitoes */
        .mosq-container { display: flex; gap: 40px; }
        .mosq-card { border: 1px solid #444; padding: 20px; cursor: pointer; text-align: center; }
        .mosq-card:hover { border-color: #fff; }
        .ascii-art { white-space: pre; font-size: 10px; line-height: 8px; }

        /* Level 7: Fog */
        .fog-canvas { position: absolute; top:0; left:0; width:100%; height:100%; cursor: none; }
        .code-reveal { font-size: 3rem; color: #fff; letter-spacing: 10px; opacity: 0.3; }

        /* Animations */
        @keyframes wave { 0% { height: 10%; } 50% { height: 100%; } 100% { height: 10%; } }
        .glitch { animation: glitch 0.2s linear infinite; }
        @keyframes glitch { 0% { transform: translate(0); } 20% { transform: translate(-2px, 2px); } 40% { transform: translate(-2px, -2px); } 60% { transform: translate(2px, 2px); } 80% { transform: translate(2px, -2px); } 100% { transform: translate(0); } }

    </style>
</head>
<body>

<div id="game-wrapper">
    <div id="system-log">
        <div class="log-entry info">> מערכת מאותחלת...</div>
        <div class="log-entry info">> גרסה 0.9.4 בטא</div>
        <div class="log-entry info">> מחכה לקלט משתמש</div>
    </div>

    <div id="main-interface">
        <div id="header">
            <div>LOCATION: <span id="loc-display">INIT</span></div>
            <div>ANTIDOTES: <span id="antidote-display">//////</span> (6)</div>
        </div>

        <div id="narrative-box">
            </div>

        <div id="interaction-area">
            </div>
        
        <div style="margin-top: 10px; text-align: left;">
            <button id="action-btn" class="term-btn" style="display:none;">EXECUTE</button>
        </div>
    </div>
</div>

<script>
    // --- GAME STATE ---
    let gameState = {
        level: 0,
        antidotes: 6,
        isGameOver: false
    };

    // --- DOM UTILS ---
    const logEl = document.getElementById('system-log');
    const narrativeEl = document.getElementById('narrative-box');
    const interactionEl = document.getElementById('interaction-area');
    const locDisplay = document.getElementById('loc-display');
    const antiDisplay = document.getElementById('antidote-display');
    const actionBtn = document.getElementById('action-btn');

    // --- LOGGING SYSTEM ---
    function log(msg, type = 'info') {
        const div = document.createElement('div');
        div.className = `log-entry ${type}`;
        div.innerText = `> ${msg}`;
        logEl.prepend(div); // Newest on top inside the container logic (flex-reverse handles visuals)
    }

    function updateHUD() {
        antiDisplay.innerText = '/'.repeat(gameState.antidotes);
        if (gameState.antidotes <= 2) antiDisplay.style.color = 'var(--danger)';
        if (gameState.antidotes <= 0) gameOver();
    }

    function fail(reason) {
        log(`שגיאה קריטית: ${reason}`, 'error');
        log('מערכת הזריקה נוגדן חירום...', 'info');
        gameState.antidotes--;
        updateHUD();
        document.body.classList.add('glitch');
        setTimeout(() => document.body.classList.remove('glitch'), 300);
    }

    function success(msg) {
        log(`הצלחה: ${msg}`, 'success');
        setTimeout(() => {
            gameState.level++;
            renderLevel();
        }, 1500);
    }

    function gameOver() {
        gameState.isGameOver = true;
        interactionEl.innerHTML = `<h1 style="color:red">SYSTEM FAILURE</h1><p>Patient Zero Terminated.</p>`;
        actionBtn.style.display = 'none';
    }

    // --- LEVEL DATA & LOGIC ---
    
    function renderLevel() {
        if (gameState.isGameOver) return;
        
        interactionEl.innerHTML = ''; // Clear previous puzzle
        actionBtn.style.display = 'none'; // Hide generic button unless needed
        
        // --- LEVEL 0: INTRO ---
        if (gameState.level === 0) {
            locDisplay.innerText = "LAB_ZERO";
            narrativeEl.innerHTML = `ד"ר ארקדיוס מביט בך. "האנושות נכשלת כי היא מנסה לכבוש את הטבע במקום לחקות אותו."<br>הוא מניח לפניך ערכה. "ברכבת הזו יש 10 קרונות. כדי לשרוד, תצטרך להבין איך יתוש חושב. לא תקבל עזרה."`;
            
            const btn = document.createElement('button');
            btn.className = 'term-btn';
            btn.innerText = "התחל סימולציה";
            btn.onclick = () => success("חיבור עצבי הושלם.");
            interactionEl.appendChild(btn);
        }

        // --- LEVEL 1: THE NEEDLE (VISUAL DEDUCTION) ---
        else if (gameState.level === 1) {
            locDisplay.innerText = "CAR_01";
            narrativeEl.innerHTML = `ילדה חוסמת את המעבר. המערכת מזהה רמות קורטיזול (לחץ) גבוהות. דרושה הזרקה שקטה.<br>נתונים ביומימטיים: <b>"פחות שטח מגע = פחות כאב."</b>`;
            log("סרוק את הכלים ובחר את הכלי המתאים לחדירה חשאית.", 'info');

            const container = document.createElement('div');
            container.className = 'needle-container';
            
            // Option A: Smooth (Trap)
            const optA = document.createElement('div');
            optA.className = 'needle-option';
            optA.innerHTML = '<div class="n-straight"></div><div style="text-align:center; margin-top:10px; font-size:10px;">MODEL A</div>';
            optA.onclick = () => fail("שטח מגע רציף יצר חיכוך גבוה. הנבדק הרגיש את הדקירה.");

            // Option B: Serrated (Correct)
            const optB = document.createElement('div');
            optB.className = 'needle-option';
            optB.innerHTML = '<div class="n-serrated"></div><div style="text-align:center; margin-top:10px; font-size:10px;">MODEL B</div>';
            optB.onclick = () => success("מגע לסירוגין. העצבים לא זיהו חדירה.");

            container.appendChild(optA);
            container.appendChild(optB);
            interactionEl.appendChild(container);
        }

        // --- LEVEL 2: THERMAL (HIDDEN INFORMATION) ---
        else if (gameState.level === 2) {
            locDisplay.innerText = "CAR_02";
            narrativeEl.innerHTML = `החדר חשוך. דליפות קיטור בטמפרטורה גבוהה חוסמות את הדרך.<br>השתמש בחיישן התרמי כדי לאתר את המעבר הקר (בטוח).`;
            log("זהירות: אין חיווי ויזואלי ישיר. עקוב אחר נתוני הטלמטריה בלוג.", 'info');

            const grid = document.createElement('div');
            grid.className = 'thermal-grid';
            
            // Create 25 cells
            let safeIndex = Math.floor(Math.random() * 25);
            
            for (let i = 0; i < 25; i++) {
                const cell = document.createElement('div');
                cell.className = 'thermal-cell';
                
                // Hover Logic - The only way to know is reading the LOG
                cell.onmouseover = () => {
                    if (i === safeIndex) {
                        log(`TEMP: 24°C [SAFE]`, 'success');
                        cell.style.border = "1px solid #0f0"; // Subtle hint after discovery
                    } else {
                        let temp = Math.floor(Math.random() * 50) + 90;
                        log(`TEMP: ${temp}°C [CRITICAL]`, 'error');
                        cell.style.background = "#1a0000"; // Subtle hint
                    }
                };

                cell.onclick = () => {
                    if (i === safeIndex) success("נתיב בטוח זוהה.");
                    else fail("כוויה מדרגה 3. נכנסת לתוך סילון קיטור.");
                };
                
                grid.appendChild(cell);
            }
            interactionEl.appendChild(grid);
        }

        // --- LEVEL 3: FREQUENCY (SLIDER & PATTERN) ---
        else if (gameState.level === 3) {
            locDisplay.innerText = "CAR_04"; // Skip a car for pacing
            narrativeEl.innerHTML = `רחפן תקוע ברוח. נדרש כיול תדר כנפיים.<br>נתון ידוע: יתושי קולקס (Culex) מרחפים בתדר ~600Hz.`;
            
            const wrapper = document.createElement('div');
            wrapper.className = 'slider-container';
            
            const feedback = document.createElement('div');
            feedback.id = 'freq-val';
            feedback.innerText = 'CURRENT FREQ: 100Hz';
            feedback.style.marginBottom = '20px';

            const slider = document.createElement('input');
            slider.type = 'range';
            slider.min = '100';
            slider.max = '1000';
            slider.value = '100';
            
            slider.oninput = (e) => {
                feedback.innerText = `CURRENT FREQ: ${e.target.value}Hz`;
                // Visual feedback only via Log if close
                if (e.target.value > 580 && e.target.value < 620) {
                    log("SYSTEM: הרמוניה אווירודינמית זוהתה.", 'success');
                }
            };

            const confirmBtn = document.createElement('button');
            confirmBtn.className = 'term-btn';
            confirmBtn.innerText = "CALIBRATE";
            confirmBtn.onclick = () => {
                if (slider.value >= 580 && slider.value <= 620) success("הרחפן התייצב.");
                else fail(`התדר ${slider.value}Hz גרם לקריסת רוטורים.`);
            };

            wrapper.appendChild(feedback);
            wrapper.appendChild(slider);
            wrapper.appendChild(document.createElement('br'));
            wrapper.appendChild(confirmBtn);
            interactionEl.appendChild(wrapper);
        }

        // --- LEVEL 4: MOSQUITO SORTING (KNOWLEDGE CHECK) ---
        else if (gameState.level === 4) {
            locDisplay.innerText = "CAR_06";
            narrativeEl.innerHTML = `בנק הדם נעול. הדלת נפתחת רק למי שאינו מוגדר כאיום.<br>בחר את הדגימה ש<b>אינה</b> צורכת דם כדי להתקיים.`;
            log("רמז: חפש מאפיינים מורפולוגיים של יתוש זכר (ניזון מצוף).", 'info');

            const container = document.createElement('div');
            container.className = 'mosq-container';

            // Female (Trap)
            const cardF = document.createElement('div');
            cardF.className = 'mosq-card';
            cardF.innerHTML = `<div class="ascii-art">
   \\  /
  (O__O)
    ||    <span style="color:red">V</span>
   /--\\
  //  \\\\
</div>`; // Simplified ASCII with a sharp proboscis
            cardF.onclick = () => fail("זוהתה נקבה. היא מחפשת חלבון (דם) לביצים. הותקפת.");

            // Male (Correct)
            const cardM = document.createElement('div');
            cardM.className = 'mosq-card';
            cardM.innerHTML = `<div class="ascii-art">
  \\ // /
  (O__O)
    || 
   /--\\
  //  \\\\
</div>`; // Feathery antennae
            cardM.onclick = () => success("זוהה זכר. הוא ניזון מצוף פרחים בלבד. אינו עוקץ.");

            container.appendChild(cardF);
            container.appendChild(cardM);
            interactionEl.appendChild(container);
        }

        // --- LEVEL 5: FOG (INTERACTIVE REVEAL) ---
        else if (gameState.level === 5) {
            locDisplay.innerText = "CAR_07";
            narrativeEl.innerHTML = `הקוד כתוב על הקיר, אך החדר מלא אדים. אין ראות.<br>השתמש בחומר הננו-הידרופובי (דוחה מים) כדי לנקות זמנית את המשטח.`;
            
            // Hidden code in background
            const reveal = document.createElement('div');
            reveal.className = 'code-reveal';
            reveal.innerText = "84X9";
            reveal.style.position = 'absolute';
            reveal.style.zIndex = '1';
            interactionEl.appendChild(reveal);

            // Fog overlay (Canvas)
            const canvas = document.createElement('canvas');
            canvas.className = 'fog-canvas';
            canvas.style.zIndex = '2';
            interactionEl.appendChild(canvas);
            
            // Canvas logic
            const ctx = canvas.getContext('2d');
            canvas.width = interactionEl.clientWidth;
            canvas.height = interactionEl.clientHeight;
            
            // Fill with fog
            ctx.fillStyle = '#111';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Eraser effect
            let isDrawing = false;
            canvas.onmousemove = (e) => {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                ctx.globalCompositeOperation = 'destination-out';
                ctx.beginPath();
                ctx.arc(x, y, 30, 0, Math.PI * 2);
                ctx.fill();
                
                // Fog comes back slowly (Game loop logic simulated)
                setTimeout(() => {
                    ctx.globalCompositeOperation = 'source-over';
                    ctx.fillStyle = 'rgba(17, 17, 17, 0.1)';
                    ctx.beginPath();
                    ctx.arc(x, y, 32, 0, Math.PI * 2);
                    ctx.fill();
                }, 800);
            };

            // Input field
            const inputDiv = document.createElement('div');
            inputDiv.style.position = 'absolute';
            inputDiv.style.bottom = '10px';
            inputDiv.style.zIndex = '10';
            
            const input = document.createElement('input');
            input.type = 'text';
            input.placeholder = 'ENTER CODE';
            input.style.background = '#000';
            input.style.color = '#0f0';
            input.style.border = '1px solid #0f0';
            
            const btn = document.createElement('button');
            btn.innerText = "OK";
            btn.className = 'term-btn';
            btn.onclick = () => {
                if (input.value === '84X9' || input.value === '84x9') success("קוד אומת.");
                else fail("קוד שגוי. הדלת ננעלה מחדש.");
            };

            inputDiv.appendChild(input);
            inputDiv.appendChild(btn);
            interactionEl.appendChild(inputDiv);
        }

        // --- LEVEL 6: CO2 SENSORS (DATA ANALYSIS) ---
        else if (gameState.level === 6) {
            locDisplay.innerText = "CAR_09";
            narrativeEl.innerHTML = `צומת דרכים. צינור אחד מוביל לאוויר צח, השני ללב המנוע.<br>יתושים נמשכים ל-CO2 גבוה (נשימה). אתה צריך לברוח מהיתושים, כלומר: חפש את ה-CO2 הנמוך.`;
            log("מפעיל סנסורים כימיים...", 'info');

            const sensorDiv = document.createElement('div');
            sensorDiv.style.display = 'flex';
            sensorDiv.style.gap = '50px';
            sensorDiv.style.width = '100%';
            sensorDiv.style.justifyContent = 'center';

            // Sensor A (Trap - High CO2)
            const sA = document.createElement('div');
            sA.style.border = '1px solid #333';
            sA.style.padding = '20px';
            sA.style.cursor = 'pointer';
            sA.innerHTML = '<h3>TUNNEL ALPHA</h3><div id="val-a">READING...</div>';
            sA.onclick = () => fail("רמות CO2 גבוהות מושכות יתושים. נכנסת לקן שלהם.");

            // Sensor B (Safe - Low CO2)
            const sB = document.createElement('div');
            sB.style.border = '1px solid #333';
            sB.style.padding = '20px';
            sB.style.cursor = 'pointer';
            sB.innerHTML = '<h3>TUNNEL BETA</h3><div id="val-b">READING...</div>';
            sB.onclick = () => success("רמות CO2 אטמוספריות (רגילות). אוויר נקי.");

            sensorDiv.appendChild(sA);
            sensorDiv.appendChild(sB);
            interactionEl.appendChild(sensorDiv);

            // Simulation Interval
            const interval = setInterval(() => {
                if (gameState.level !== 6) clearInterval(interval);
                
                // High CO2 (fluctuating around 40,000)
                const valA = 38000 + Math.floor(Math.random() * 4000);
                document.getElementById('val-a').innerText = `${valA} ppm`;
                
                // Low CO2 (fluctuating around 400 - Earth atmosphere)
                const valB = 380 + Math.floor(Math.random() * 50);
                document.getElementById('val-b').innerText = `${valB} ppm`;
            }, 500);
        }

        // --- LEVEL 7: FINAL BOSS (AUDIO SPECTRUM) ---
        else if (gameState.level === 7) {
            locDisplay.innerText = "LOCOMOTIVE";
            narrativeEl.innerHTML = `ארקדיוס נעול בתא הנהג. יש 3 מתגי ניתוק.<br>מצא את האות היציב המדמה את כנפי הנקבה (משיכת הזכר). כל השאר הם רעש לבן.`;
            
            const btnContainer = document.createElement('div');
            btnContainer.style.display = 'flex';
            btnContainer.style.gap = '20px';

            [1, 2, 3].forEach(num => {
                const btn = document.createElement('button');
                btn.className = 'term-btn';
                btn.innerText = `SIGNAL_0${num}`;
                
                // Hover effect simulates listening/analyzing
                btn.onmouseover = () => {
                    if (num === 2) {
                        log(`SIGNAL_02: Pattern Harmonic [STABLE]`, 'success');
                        interactionEl.style.background = 'repeating-linear-gradient(90deg, #001100, #001100 10px, #002200 10px, #002200 20px)';
                    } else {
                        log(`SIGNAL_0${num}: Stochastic Chaos [NOISE]`, 'error');
                        interactionEl.style.background = `url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MCIgaGVpZ2h0PSI1MCI+PHJlY3Qgd2lkdGg9IjUwIiBoZWlnaHQ9IjUwIiBmaWxsPSJibGFjayIvPjxjaXJjbGUgY3g9IjI1IiBjeT0iMjUiIHI9IjIwIiBmaWxsPSIjMTEzMzExIiBvcGFjaXR5PSIwLjUiLz48L3N2Zz4=')`;
                    }
                };
                
                btn.onmouseout = () => {
                    interactionEl.style.background = 'rgba(0, 20, 0, 0.5)';
                };

                btn.onclick = () => {
                    if (num === 2) {
                        narrativeEl.innerHTML = "<h1 style='color:var(--accent)'>MISSION ACCOMPLISHED</h1>";
                        interactionEl.innerHTML = "<p>הרכבת נעצרה. ארקדיוס נכשל.</p>";
                        actionBtn.style.display = 'none';
                    } else {
                        fail("אות שגוי פוצץ את הפיוזים.");
                    }
                };
                btnContainer.appendChild(btn);
            });

            interactionEl.appendChild(btnContainer);
        }
    }

    // Start
    renderLevel();

</script>
</body>
</html>
