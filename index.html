<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×¤×¨×•×˜×•×§×•×œ ×”×¢×•×§×¥ | ×¡×™××•×œ×¦×™×™×ª ×‘×™×•××™××™×§×¨×™ ××ª×§×“××ª</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@100;300;400;700;900&family=Rubik:wght@300;400;500;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">

    <style>
        /* * ==========================================================================
         * 1. ×”×’×“×¨×•×ª ×œ×™×‘×” ×•××©×ª× ×™× (CORE VARIABLES)
         * ==========================================================================
         */
        :root {
            /* ×¤×œ×˜×ª ×¦×‘×¢×™× - Amber/Gold Engineering Theme */
            --bg-deep: #050505;
            --bg-panel: #0f1012;
            --bg-panel-trans: rgba(15, 16, 18, 0.95);
            
            --border-dim: #2a2a2a;
            --border-active: #ffb700;

            /* ×˜×§×¡×˜ */
            --text-main: #d0d0d0;
            --text-muted: #6e6e6e;
            --text-highlight: #ffb700; /* ×”×–×”×‘ ×©×œ ×”××”× ×“×¡ */
            --text-alert: #ff3333;

            /* ×¡×˜×˜×•×¡×™× */
            --status-ok: #00ff9d;   
            --status-warn: #ffae00; 
            --status-crit: #ff2a2a; 
            --status-tech: #00d9ff; 

            /* ××™×“×•×ª */
            --sidebar-width: 400px;
            --header-height: 80px;
            
            /* ××¤×§×˜×™× */
            --glow-gold: 0 0 15px rgba(255, 183, 0, 0.3);
            --scanline: rgba(0,0,0,0.5);
        }

        * {
            box-sizing: border-box;
            user-select: none;
            outline: none;
            scrollbar-width: thin;
            scrollbar-color: var(--border-active) var(--bg-deep);
        }

        /* ×’×œ×™×œ×” ××•×ª×××ª ××™×©×™×ª */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-deep); }
        ::-webkit-scrollbar-thumb { background: var(--border-active); border-radius: 3px; }

        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            background-color: var(--bg-deep);
            color: var(--text-main);
            font-family: 'Heebo', sans-serif;
            overflow: hidden;
        }

        /* * ==========================================================================
         * 2. ××¡×š ××ª×—×•×œ (BOOT SEQUENCE)
         * ==========================================================================
         */
        #boot-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            font-family: 'Share Tech Mono', monospace; direction: ltr;
        }

        .terminal-window {
            width: 700px; height: 400px;
            border: 1px solid #333;
            padding: 20px;
            background: #020202;
            box-shadow: 0 0 50px rgba(255, 183, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .terminal-text {
            color: var(--text-highlight);
            font-size: 14px; line-height: 1.6;
            white-space: pre-wrap;
        }

        .scanline {
            position: absolute; top: 0; left: 0; width: 100%; height: 2px;
            background: rgba(255,255,255,0.1);
            animation: scan 3s linear infinite;
            pointer-events: none;
        }

        .loading-bar-container {
            width: 700px; height: 4px; background: #222;
            margin-top: 10px; position: relative;
        }
        .loading-bar {
            height: 100%; width: 0%; background: var(--text-highlight);
            box-shadow: 0 0 10px var(--text-highlight);
            transition: width 0.1s;
        }

        @keyframes scan { 0% { top: 0%; } 100% { top: 100%; } }

        /* * ==========================================================================
         * 3. ××‘× ×” ×¨××©×™ (MAIN LAYOUT)
         * ==========================================================================
         */
        #app-wrapper {
            display: grid;
            grid-template-columns: 1fr var(--sidebar-width);
            grid-template-rows: var(--header-height) 1fr;
            width: 100vw; height: 100vh;
            opacity: 0; transition: opacity 2s ease;
        }

        /* --- ×›×•×ª×¨×ª ×¢×œ×™×•× ×” --- */
        #header-bar {
            grid-column: 1 / -1;
            background: var(--bg-panel);
            border-bottom: 2px solid var(--border-dim);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            z-index: 100;
        }

        .project-title {
            font-family: 'Rubik', sans-serif; font-size: 28px; font-weight: 900;
            letter-spacing: 2px; text-transform: uppercase;
            color: var(--text-highlight);
            text-shadow: 0 0 15px rgba(255, 183, 0, 0.4);
            display: flex; align-items: center; gap: 15px;
        }
        .project-subtitle { font-size: 12px; color: #666; font-weight: 400; letter-spacing: 1px; margin-top: 5px;}

        .sys-indicators { display: flex; gap: 30px; font-family: 'Share Tech Mono'; font-size: 14px; }
        .indicator { display: flex; align-items: center; gap: 10px; color: #888; }
        .indicator.active { color: var(--text-highlight); text-shadow: 0 0 5px var(--text-highlight); }
        .led { width: 8px; height: 8px; background: #333; border-radius: 50%; }
        .active .led { background: var(--text-highlight); box-shadow: 0 0 8px var(--text-highlight); }
        .active.danger .led { background: var(--status-crit); box-shadow: 0 0 8px var(--status-crit); }
        .active.danger { color: var(--status-crit); animation: blink-text 1s infinite; }

        @keyframes blink-text { 50% { opacity: 0.5; } }

        /* --- ××–×•×¨ ×ª×¦×•×’×” (VIEWPORT) --- */
        #viewport {
            position: relative;
            background: #000;
            overflow: hidden;
            border-left: 1px solid var(--border-dim);
            cursor: crosshair;
        }

        /* ×©×›×‘×•×ª ×¨×§×¢ */
        .layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center;
            transition: opacity 1.5s, transform 5s ease;
            z-index: 1; opacity: 0;
        }
        
        #layer-train { background-image: url('https://i.ibb.co/7tQt5S0h/Gemini-Generated-Image-prcu4rprcu4rprcu.png'); }
        #layer-hallway { background-image: url('https://i.ibb.co/svJJmvYr/Gemini-Generated-Image-l4kaehl4kaehl4ka.png'); filter: brightness(0.4) sepia(1) hue-rotate(180deg); } /* ××¡×“×¨×•×Ÿ ×—×©×•×š */
        #layer-engine { background-image: url('https://i.ibb.co/d04yrgRx/Gemini-Generated-Image-j02tg6j02tg6j02t.png'); filter: brightness(0.2) contrast(1.2); }

        /* ×§× ×‘×¡ ×—×œ×§×™×§×™× ×•××¤×§×˜×™× */
        #particle-canvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 5; pointer-events: none; mix-blend-mode: screen;
        }

        /* ×©×›×‘×•×ª ××¤×§×˜ (×’×–/×ª×¨××™/×—×•×©×š) */
        #overlay-gas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, transparent 30%, rgba(0, 255, 100, 0.15));
            z-index: 6; pointer-events: none; opacity: 0; transition: opacity 2s;
        }
        #overlay-thermal {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(180deg, rgba(0,50,0,0.2) 50%, rgba(0,50,0,0.2) 50%), repeating-linear-gradient(0deg, transparent, transparent 2px, #00ff00 3px);
            background-size: 100% 4px;
            filter: contrast(2) brightness(1.5) grayscale(1) invert(1); 
            mix-blend-mode: hard-light;
            z-index: 7; pointer-events: none; opacity: 0; display: none;
        }
        #overlay-darkness {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 50% 50%, transparent 100px, #000 300px);
            z-index: 8; pointer-events: none; opacity: 0; transition: opacity 2s;
        }

        /* --- ×”×•×˜×¡×¤×•×˜×™× (×¢×™×¦×•×‘ ××©×•×¤×¨) --- */
        #hotspots-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 20; }

        .hotspot {
            position: absolute; width: 60px; height: 60px;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; opacity: 0.8; transition: all 0.3s;
        }

        /* ×¢×™×¦×•×‘ "×›×•×•× ×ª" ×”× ×“×¡×™×ª */
        .reticle {
            position: absolute; width: 100%; height: 100%;
            border: 1px solid rgba(255, 183, 0, 0.3);
            box-shadow: 0 0 10px rgba(255, 183, 0, 0.1);
            animation: breathe 3s infinite;
        }
        .reticle::before, .reticle::after {
            content: ''; position: absolute; width: 10px; height: 10px;
            border-color: var(--text-highlight); border-style: solid;
            transition: all 0.3s;
        }
        .reticle::before { top: 0; left: 0; border-width: 2px 0 0 2px; }
        .reticle::after { bottom: 0; right: 0; border-width: 0 2px 2px 0; }

        .hotspot:hover .reticle { border-color: var(--text-highlight); box-shadow: 0 0 20px var(--text-highlight); transform: scale(1.1); }
        .hotspot:hover .reticle::before { top: -5px; left: -5px; }
        .hotspot:hover .reticle::after { bottom: -5px; right: -5px; }

        .hs-label {
            position: absolute; bottom: -25px; 
            font-family: 'Share Tech Mono'; font-size: 12px; color: var(--text-highlight);
            background: rgba(0,0,0,0.8); padding: 2px 6px; border: 1px solid var(--text-highlight);
            opacity: 0; transition: 0.3s; white-space: nowrap; pointer-events: none;
        }
        .hotspot:hover .hs-label { opacity: 1; bottom: -30px; }

        /* ××™×§×•××™× (×œ×¤×™ ×”×¡×™×¤×•×¨) */
        /* ×©×œ×‘ 1 - ×¨×›×‘×ª */
        #hs-suitcase { top: 70%; left: 75%; } /* ××–×•×•×“×” ×¢× ×¨×›×™×‘×™× */
        #hs-seat { top: 60%; left: 20%; } /* ×¨×›×™×‘ ××•×¡×ª×¨ */
        #hs-vent { top: 10%; left: 50%; width: 120px; height: 80px; } /* ×¤×ª×— ××•×•×¨×•×¨ */
        
        /* ×©×œ×‘ 2 - ××¡×“×¨×•×Ÿ */
        #hs-debris { top: 80%; left: 30%; } /* ×—×œ×§×™ ×¨×—×¤×Ÿ */
        #hs-panel { top: 50%; left: 10%; } /* ×—×™×™×©×Ÿ */
        #hs-door-lock { top: 40%; left: 50%; width: 80px; height: 120px; } /* ×“×œ×ª ×”×§×˜×¨ */

        /* ×©×œ×‘ 3 - ×—×“×¨ ×—×©×•×š */
        #hs-cabinet { top: 60%; left: 15%; } /* ××™×§×¨×•×¤×•×Ÿ */
        #hs-arcadius { top: 40%; left: 60%; width: 100px; height: 200px; opacity: 0; } /* ×”××“×¢×Ÿ (×‘×œ×ª×™ × ×¨××” ×‘×”×ª×—×œ×”) */

        @keyframes breathe { 0% { opacity: 0.5; transform: scale(1); } 50% { opacity: 1; transform: scale(1.05); } 100% { opacity: 0.5; transform: scale(1); } }

        /* --- ×¡×¨×’×œ ×¦×“ (SIDEBAR) --- */
        #sidebar {
            background: var(--bg-panel);
            border-left: 2px solid var(--border-dim);
            display: flex; flex-direction: column;
            padding: 25px; box-shadow: -10px 0 40px rgba(0,0,0,0.8);
            z-index: 50; gap: 25px;
        }

        .panel-box {
            background: rgba(255,255,255,0.02);
            border: 1px solid var(--border-dim);
            padding: 15px; border-radius: 4px;
            position: relative;
        }
        .panel-box::before {
            content: ''; position: absolute; top: -1px; left: -1px; width: 20px; height: 20px;
            border-top: 2px solid var(--text-highlight); border-left: 2px solid var(--text-highlight);
        }

        .panel-title {
            font-family: 'Rubik'; font-weight: 700; font-size: 14px;
            color: var(--text-highlight); text-transform: uppercase; letter-spacing: 1px;
            margin-bottom: 15px; display: block; border-bottom: 1px solid #333; padding-bottom: 5px;
        }

        /* ××–×•×¨ ×¢×œ×™×œ×” */
        #story-display {
            font-size: 15px; line-height: 1.6; color: #ddd;
            height: 150px; overflow-y: auto; padding-right: 5px;
        }
        .story-update { margin-bottom: 10px; animation: fadeIn 0.5s; }
        .highlight { color: var(--text-highlight); font-weight: bold; }

        /* ××–×•×¨ ×™×¦×™×¨×” (Crafting) */
        #crafting-area {
            display: flex; flex-direction: column; gap: 10px;
        }
        #craft-slots {
            display: flex; justify-content: space-between; gap: 5px;
            margin-bottom: 10px;
        }
        .craft-slot {
            width: 60px; height: 60px; border: 1px dashed #555; background: #000;
            display: flex; justify-content: center; align-items: center; font-size: 24px;
            color: #333; transition: 0.3s;
        }
        .craft-slot.filled { border-color: var(--text-highlight); color: #fff; box-shadow: inset 0 0 10px rgba(255,183,0,0.2); }

        #btn-craft {
            width: 100%; padding: 12px; background: #222; color: #555;
            border: 1px solid #333; font-weight: bold; font-family: 'Rubik';
            cursor: not-allowed; transition: 0.3s; text-transform: uppercase;
        }
        #btn-craft.ready {
            background: var(--text-highlight); color: #000; cursor: pointer;
            box-shadow: 0 0 15px rgba(255,183,0,0.4); border: none;
        }
        #btn-craft.ready:hover { background: #fff; transform: translateY(-2px); }

        /* ×ª×™×§ ×¦×™×•×“ */
        #inventory-grid {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;
        }
        .inv-item {
            aspect-ratio: 1; background: #080808; border: 1px solid #333;
            display: flex; justify-content: center; align-items: center;
            font-size: 24px; cursor: pointer; transition: 0.2s; position: relative;
        }
        .inv-item:hover { border-color: var(--text-highlight); background: #111; }
        .inv-item.selected { border-color: var(--status-ok); box-shadow: 0 0 10px var(--status-ok); }
        .inv-tooltip {
            position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%);
            background: #000; border: 1px solid var(--text-highlight); color: var(--text-highlight);
            font-size: 10px; padding: 4px; white-space: nowrap; pointer-events: none;
            opacity: 0; z-index: 100; transition: 0.2s;
        }
        .inv-item:hover .inv-tooltip { opacity: 1; bottom: 110%; }

        /* * ==========================================================================
         * 4. ××•×“××œ×™× ×•××™× ×™-××©×—×§×™× (MODALS)
         * ==========================================================================
         */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 200;
            display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: 0.3s;
            backdrop-filter: blur(5px);
        }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }

        .modal-box {
            background: #0a0a0a; border: 2px solid var(--text-highlight);
            box-shadow: 0 0 50px rgba(255, 183, 0, 0.2);
            padding: 30px; width: 700px; max-width: 90%;
            position: relative; text-align: center;
        }
        
        .modal-header { font-family: 'Rubik'; font-size: 24px; color: var(--text-highlight); margin-bottom: 20px; text-transform: uppercase; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .modal-close { position: absolute; top: 15px; left: 20px; font-size: 24px; color: #666; cursor: pointer; }
        .modal-close:hover { color: #fff; }

        /* --- ××™× ×™-××©×—×§: ××§×“×— ×¨×˜×˜ (Canvas Wave) --- */
        #game-wave-container { width: 100%; display: flex; flex-direction: column; align-items: center; }
        #wave-canvas { width: 100%; height: 200px; background: #000; border: 1px solid #333; margin-bottom: 15px; }
        .slider-control { width: 80%; cursor: pointer; }
        #wave-status { font-family: 'Share Tech Mono'; font-size: 18px; margin-top: 10px; color: var(--status-crit); }

        /* --- ××™× ×™-××©×—×§: ×¡×•× ××¨ (Radar) --- */
        #sonar-container { position: relative; width: 300px; height: 300px; border-radius: 50%; border: 2px solid var(--status-ok); background: radial-gradient(circle, #002200 0%, #000 100%); margin: 0 auto; overflow: hidden; }
        #sonar-sweep {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: conic-gradient(from 0deg, transparent 0deg, rgba(0,255,157,0.5) 20deg, transparent 20deg);
            border-radius: 50%; animation: sweep 3s linear infinite;
        }
        #sonar-dot {
            position: absolute; width: 10px; height: 10px; background: #fff; border-radius: 50%;
            box-shadow: 0 0 10px #fff; opacity: 0; transition: opacity 0.2s; cursor: pointer;
        }
                /* --- MOBILE / RESPONSIVE FIXES (append to end of current <style>) --- */
        
        /* allow scrolling on mobile */
        html, body {
          height: auto !important;
          overflow: auto !important;
          -webkit-overflow-scrolling: touch;
        }
        
        /* make boot/terminal responsive */
        #boot-layer .terminal-window,
        .loading-bar-container {
          width: 90% !important;
          max-width: 720px;
          box-sizing: border-box;
        }
        
        /* responsive grid: stack sidebar under viewport on narrow screens */
        @media (max-width: 900px) {
          :root { --sidebar-width: 100%; --header-height: 64px; }
        
          #app-wrapper {
            display: grid;
            grid-template-columns: 1fr;
            grid-template-rows: var(--header-height) 1fr auto;
            width: 100vw; height: auto;
          }
        
          #header-bar {
            padding: 0 14px;
            height: var(--header-height);
            align-items: center;
          }
        
          #viewport {
            grid-row: 2;
            min-height: calc(100vh - var(--header-height) - 300px);
            border-left: none;
            cursor: default;
            touch-action: manipulation;
          }
        
          #sidebar {
            grid-row: 3;
            width: 100%;
            padding: 14px;
            border-left: none;
            border-top: 2px solid var(--border-dim);
            box-shadow: none;
            gap: 12px;
            max-height: 50vh;
            overflow-y: auto;
          }
        
          .project-title { font-size: 18px; gap: 10px; }
          .project-subtitle { display: none; }
        
          /* make modals full width on small screens */
          .modal-box { width: calc(100% - 32px); max-width: 700px; padding: 18px; }
        
          /* inventory & crafting: fewer columns */
          #inventory-grid { grid-template-columns: repeat(3, 1fr); gap: 8px; }
          .inv-item { font-size: 20px; padding: 6px; }
        
          /* hotspots bigger touch targets */
          .hotspot { width: 56px; height: 56px; }
          .hs-label { font-size: 11px; }
        
          /* make game canvases smaller */
          #wave-canvas { width: 100% !important; height: 140px !important; }
          #sonar-container { width: 220px; height: 220px; }
        
          /* make panels more compact */
          .panel-box { padding: 10px; }
          .panel-title { font-size: 12px; }
        
          /* reduce heavy shadows / glows on mobile for perf */
          body * { transition: none !important; box-shadow: none !important; text-shadow: none !important; }
        
          /* particle canvas stays but pointer-events none and won't cover taps */
          #particle-canvas { pointer-events: none; }
        }
        
        /* extra squeeze for very small phones */
        @media (max-width: 420px) {
          :root { --header-height: 56px; }
          #header-bar { padding: 0 10px; }
          .project-title { font-size: 16px; }
          .hotspot { width: 50px; height: 50px; }
          #inventory-grid { grid-template-columns: repeat(2, 1fr); }
          #story-display { height: 120px; font-size: 14px; }
          .terminal-window { height: auto; padding: 12px; font-size: 13px; }
        }

        @keyframes sweep { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    </style>
</head>
<body>

    <div id="boot-layer">
        <div class="terminal-window">
            <div id="boot-text" class="terminal-text"></div>
            <div class="scanline"></div>
        </div>
        <div class="loading-bar-container">
            <div id="boot-bar" class="loading-bar"></div>
        </div>
    </div>

    <div id="app-wrapper">
        
        <header id="header-bar">
            <div class="project-title">
                <span style="font-size:32px;">âš ï¸</span> ×¤×¨×•×˜×•×§×•×œ ×”×¢×•×§×¥
                <div class="project-subtitle">×××©×§ ×”×™×©×¨×“×•×ª ×‘×™×•××™××˜×™ // ×’×¨×¡×” 1.0</div>
            </div>
            
            <div class="sys-indicators">
                <div id="ind-gas" class="indicator active danger"><div class="led"></div> ×–×™×”×•×™ ×¨×¢×œ× ×™×</div>
                <div id="ind-temp" class="indicator"><div class="led"></div> ×˜××¤×¨×˜×•×¨×”</div>
                <div id="ind-audio" class="indicator"><div class="led"></div> ×©××¢ ×›×™×•×•× ×™</div>
            </div>
        </header>

        <main id="viewport">
            <canvas id="particle-canvas"></canvas>
            
            <div id="overlay-gas"></div>
            <div id="overlay-darkness"></div>
            <div id="overlay-thermal"></div>

            <div id="layer-engine" class="layer"></div>
            <div id="layer-hallway" class="layer"></div>
            <div id="layer-train" class="layer"></div>

            <div id="hotspots-layer">
                <div id="hs-suitcase" class="hotspot" data-ref="suitcase" title="××–×•×•×“×ª ×¨×›×™×‘×™×">
                    <div class="reticle"></div><div class="hs-label">××–×•×•×“×ª ×¨×›×™×‘×™×</div>
                </div>
                <div id="hs-seat" class="hotspot" data-ref="seat" title="××ª×—×ª ×œ××•×©×‘">
                    <div class="reticle"></div><div class="hs-label">××•×‘×™×™×§×˜ ×—×©×•×“</div>
                </div>
                <div id="hs-vent" class="hotspot" data-ref="vent" title="×“×™×–×” ××©×•×¨×™×™× ×ª">
                    <div class="reticle"></div><div class="hs-label">××§×•×¨ ×“×œ×™×¤×”</div>
                </div>

                <div id="hs-debris" class="hotspot hidden" data-ref="debris" title="×¢×¨×™××ª ×’×¨×•×˜××•×ª">
                    <div class="reticle"></div><div class="hs-label">×©××¨×™×•×ª ××œ×§×˜×¨×•× ×™×§×”</div>
                </div>
                <div id="hs-panel" class="hotspot hidden" data-ref="panel" title="×¤×× ×œ ×‘×§×¨×” ×©×‘×•×¨">
                    <div class="reticle"></div><div class="hs-label">×—×™×™×©× ×™×</div>
                </div>
                <div id="hs-door-lock" class="hotspot hidden" data-ref="door" title="×“×œ×ª ×§×¨×•×Ÿ ×× ×•×¢">
                    <div class="reticle"></div><div class="hs-label">××¢×‘×¨ ×œ×§×˜×¨</div>
                </div>

                <div id="hs-cabinet" class="hotspot hidden" data-ref="cabinet" title="××¨×•×Ÿ ×¦×™×•×“">
                    <div class="reticle"></div><div class="hs-label">×¦×™×•×“ ×©××¢</div>
                </div>
                <div id="hs-arcadius" class="hotspot hidden" data-ref="arcadius">
                    </div>
            </div>
        </main>

        <aside id="sidebar">
            <div class="panel-box" style="flex-grow: 1; display:flex; flex-direction:column;">
                <span class="panel-title">×™×•××Ÿ ××™×¨×•×¢×™×</span>
                <div id="story-display">
                    </div>
            </div>

            <div class="panel-box">
                <span class="panel-title">×©×•×œ×—×Ÿ ×¢×‘×•×“×” (×©×™×œ×•×‘ ×¨×›×™×‘×™×)</span>
                <div id="crafting-area">
                    <div id="craft-slots">
                        <div class="craft-slot" id="craft-1">1</div>
                        <div class="craft-slot" id="craft-2">2</div>
                        <div class="craft-slot" id="craft-3">3</div>
                    </div>
                    <button id="btn-craft" onclick="Crafting.execute()">×‘×¦×¢ ××™× ×˜×’×¨×¦×™×”</button>
                </div>
            </div>

            <div class="panel-box">
                <span class="panel-title">×ª×™×§ ×¨×›×™×‘×™×</span>
                <div id="inventory-grid">
                    </div>
            </div>
        </aside>
    </div>

    <div id="modal-game" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-close" onclick="Modal.close()">Ã—</div>
            <div class="modal-header" id="modal-title">××ª×’×¨ ×”× ×“×¡×™</div>
            <div id="modal-content">
                </div>
        </div>
    </div>

    <div id="modal-msg" class="modal-overlay">
        <div class="modal-box" style="width: 400px; border-color: #fff;">
            <div class="modal-header" id="msg-title" style="color:#fff;">×”×•×“×¢×”</div>
            <p id="msg-text" style="color:#ccc; font-size:16px; margin-bottom:20px;"></p>
            <button onclick="Modal.closeMsg()" style="background:#333; color:#fff; border:1px solid #666; padding:10px 30px; cursor:pointer;">××™×©×•×¨</button>
        </div>
    </div>

    <script>
        /**
         * ==========================================================================
         * 1. ××¢×¨×›×ª × ×ª×•× ×™× (DATA)
         * ==========================================================================
         */
        const Items = {
            // ×©×œ×‘ 1
            MOTOR: { id: 'motor', icon: 'âš™ï¸', name: '×× ×•×¢ ×¨×˜×˜ ×–×¢×™×¨' },
            NEEDLE: { id: 'needle', icon: 'ğŸ“', name: '××—×˜ ××™×§×¨×•× ×™×ª' },
            BATTERY: { id: 'battery', icon: 'ğŸ”‹', name: '×¡×•×œ×œ×ª ×œ×™×ª×™×•×' },
            DRILL: { id: 'drill', icon: 'ğŸ¦Ÿ', name: '××§×“×— ×¨×˜×˜ ×‘×™×•××™××˜×™', isTool: true },
            
            // ×©×œ×‘ 2
            LENS: { id: 'lens', icon: 'ğŸ‘“', name: '×¢×“×©×•×ª ××¤×•×§×¡×œ×•×ª' },
            SENSOR: { id: 'sensor', icon: 'ğŸŒ¡ï¸', name: '×—×™×™×©×Ÿ ×ª×¨××™' },
            DRONE_PARTS: { id: 'drone_parts', icon: 'ğŸš', name: '×—×œ×§×™ ×¨×—×¤×Ÿ' },
            GLASSES: { id: 'glasses', icon: 'ğŸ•¶ï¸', name: '××©×§×¤×™×™× ×ª×¨××™×™×', isTool: true },

            // ×©×œ×‘ 3
            MIC: { id: 'mic', icon: 'ğŸ™ï¸', name: '××™×§×¨×•×¤×•×Ÿ × ×•×¦×”' },
            HEADSET: { id: 'headset', icon: 'ğŸ§', name: '××•×–× ×™×™×”' }, // × ×™×ª×Ÿ ×œ××¦×•× ××• ×œ×”×ª×—×™×œ ××™×ª×•
            SONAR: { id: 'sonar', icon: 'ğŸ“¡', name: '×¡×•×¨×§ ×©××¢ ×›×™×•×•× ×™', isTool: true },
            
            ANTIDOTE: { id: 'antidote', icon: 'ğŸ§ª', name: '× ×•×’×“×Ÿ', isTool: true }
        };

        const Story = {
            intro: "<b>×”×“×××” ×”×•×¤×¨×”.</b> ××“×™× ×™×¨×§×¨×§×™× ×–×•×œ×’×™× ××”×ª×§×¨×”. ×”×“×œ×ª×•×ª × ×¢×•×œ×•×ª.<br>×“\"×¨ ××¨×§×“×™×•×¡ ×”×•×“×™×¢: \"×ª×‘× ×• ××• ×©×ª××•×ª×•\".<br><br>××ª×” ××‘×™×˜ ×‘×“×™×–×”. ×”×™× ××•×’× ×ª ×‘×—×™×™×©× ×™ ×œ×—×¥. <span class='highlight'>×”×™×ª×•×© ×§×•×“×—, ×œ× ×“×•×§×¨.</span> ×¢×œ×™×š ×œ×‘× ×•×ª ×›×œ×™ ×©×™×—×“×•×¨ ×œ×œ× ×œ×—×¥.",
            phase1_done: "×”×œ×—×™×©×” ×¤×¡×§×”. ×–×¨×™××ª ×”×’×– × ×¢×¦×¨×”. ××š ×–×” ×¨×§ ×¢×™×›×•×‘.<br>×”×“×œ×ª ×œ×§×¨×•×Ÿ ×”×‘× × ×¤×ª×—×” ××œ ×—×•×©×š ××•×—×œ×˜. ×¢×œ×™×š ×œ×¨××•×ª ××ª ×”×‘×œ×ª×™ × ×¨××”.",
            phase2_done: "×”××©×§×¤×™×™× ×—×•×©×¤×™× ××ª ×§×¨× ×™ ×”×œ×™×™×–×¨ ×”×œ×•×”×˜×•×ª. ×¢×‘×¨×ª ××ª ×”××¡×“×¨×•×Ÿ ×‘×‘×˜×—×”.<br>×”×’×¢×ª ×œ×§×˜×¨. ××¨×§×“×™×•×¡ ××¡×ª×ª×¨ ×‘×¦×œ×œ×™×. ×›×œ ×ª× ×•×¢×” ×©×’×•×™×” ×ª×©×‘×•×¨ ××ª ×”××›×œ.",
            win: "×ª×¤×¡×ª ××•×ª×•! ×”× ×•×’×“×Ÿ ×‘×™×“×š. ×”×©×™×œ×•×‘ ×©×œ ×§×•×¨ ×¨×•×— ×•×”×‘× ×ª ×”×˜×‘×¢ ×”×¦×™×œ ××ª ×›×•×œ×."
        };

        const State = {
            phase: 1,
            inventory: [],
            craftingSlots: [],
            solved: []
        };

        /**
         * ==========================================================================
         * 2. ×× ×”×œ ×”××©×—×§ (GAME MANAGER)
         * ==========================================================================
         */
        const Game = {
            init() {
                // ××ª×—×•×œ UI
                Inventory.initGrid();
                this.log(Story.intro);
                
                // ××¤×§×˜×™×
                Fx.initParticles();
                document.getElementById('overlay-gas').style.opacity = 1;

                // ××™×¨×•×¢×™×
                document.querySelectorAll('.hotspot').forEach(el => {
                    el.addEventListener('click', () => this.handleInteraction(el.dataset.ref));
                });
            },

            log(html) {
                const display = document.getElementById('story-display');
                const div = document.createElement('div');
                div.className = 'story-update';
                div.innerHTML = html + "<br><br>";
                display.prepend(div);
            },

            handleInteraction(ref) {
                // ×©×œ×‘ 1: ××™×¡×•×£
                if(['suitcase', 'seat'].includes(ref)) {
                    // ×‘××–×•×•×“×” ×™×© ×× ×•×¢, ××—×˜, ×¡×•×œ×œ×”
                    if(ref === 'suitcase' && !State.solved.includes('suitcase')) {
                        Inventory.add(Items.MOTOR);
                        Inventory.add(Items.BATTERY);
                        this.log("××¦××ª ×× ×•×¢ ×•×¡×•×œ×œ×” ×‘××–×•×•×“×”.");
                        State.solved.push('suitcase');
                        document.getElementById('hs-suitcase').style.display = 'none';
                    }
                    if(ref === 'seat' && !State.solved.includes('seat')) {
                        Inventory.add(Items.NEEDLE);
                        this.log("××¦××ª ××—×˜ ××™×§×¨×•× ×™×ª ×—×‘×•×™×”.");
                        State.solved.push('seat');
                        document.getElementById('hs-seat').style.display = 'none';
                    }
                }
                
                // ××™× ×˜×¨××§×¦×™×” ×¢× ××˜×¨×•×ª
                if(ref === 'vent') {
                    if(Inventory.has(Items.DRILL.id)) {
                        Minigames.startDrill();
                    } else {
                        Modal.msg("×©×’×™××”", "× ×™×¡×™×•×Ÿ ×œ×—×¡×•× ×‘×™×“ ×™×’×¨×•× ×œ×¤×™×¦×•×¥. × ×“×¨×© ×›×œ×™ ×—×“×™×¨×” ×¢×“×™×Ÿ (×¨×˜×˜).");
                    }
                }

                // ×©×œ×‘ 2 ××™×¡×•×£
                if(['debris', 'panel'].includes(ref)) {
                    if(ref === 'debris' && !State.solved.includes('debris')) {
                        Inventory.add(Items.LENS);
                        Inventory.add(Items.DRONE_PARTS);
                        this.log("×¤×™×¨×§×ª ××ª ×”×’×¨×•×˜××•×ª. ××¦××ª ×¢×“×©×•×ª ×•×—×œ×§×™×.");
                        State.solved.push('debris');
                        document.getElementById('hs-debris').style.display = 'none';
                    }
                    if(ref === 'panel' && !State.solved.includes('panel')) {
                        Inventory.add(Items.SENSOR);
                        this.log("×¢×§×¨×ª ×—×™×™×©×Ÿ ×ª×¨××™ ××”×¤×× ×œ.");
                        State.solved.push('panel');
                        document.getElementById('hs-panel').style.display = 'none';
                    }
                }

                if(ref === 'door') {
                    if(Inventory.has(Items.GLASSES.id)) {
                        this.startPhase3Transition();
                    } else {
                        Modal.msg("×¡×›× ×”", "×”××¡×“×¨×•×Ÿ ×—×©×•×š ×•×××•×œ×›×“. ××™ ××¤×©×¨ ×œ×¢×‘×•×¨ ×‘×œ×™ ×œ×¨××•×ª ××ª ×”××›×©×•×œ×™×.");
                    }
                }

                // ×©×œ×‘ 3
                if(ref === 'cabinet' && !State.solved.includes('cabinet')) {
                    Inventory.add(Items.MIC);
                    // × × ×™×— ×©×™×© ×œ×• ××•×–× ×™×” ×›×‘×¨ ××• ×©×”×•× ×××œ×ª×¨
                    Inventory.add(Items.HEADSET); 
                    this.log("××¦××ª ×¦×™×•×“ ×©××¢ ×¨×’×™×©.");
                    State.solved.push('cabinet');
                    document.getElementById('hs-cabinet').style.display = 'none';
                }

                if(ref === 'arcadius') {
                    // ×–×” ×‘×œ×ª×™ × ×¨××”, ×œ×—×™×¦×” ×¢×•×‘×“×ª ×¨×§ ×“×¨×š ×”××™× ×™ ××©×—×§
                }
            },

            completePhase1() {
                State.phase = 2;
                this.log("<span class='highlight'>×”×“×™×–×” × ×•×˜×¨×œ×”!</span> " + Story.phase1_done);
                document.getElementById('overlay-gas').style.opacity = 0;
                
                // ××¢×‘×¨ ×•×™×–×•××œ×™
                setTimeout(() => {
                    document.getElementById('layer-train').style.opacity = 0;
                    document.getElementById('layer-hallway').style.opacity = 1;
                    
                    // ×”×—×œ×¤×ª ××™× ×“×™×§×˜×•×¨×™×
                    document.getElementById('ind-gas').classList.remove('active', 'danger');
                    document.getElementById('ind-temp').classList.add('active');

                    // ×—×©×™×¤×ª ×”×•×˜×¡×¤×•×˜×™× ×—×“×©×™×
                    document.getElementById('hs-vent').style.display = 'none';
                    document.getElementById('hs-debris').classList.remove('hidden');
                    document.getElementById('hs-panel').classList.remove('hidden');
                    document.getElementById('hs-door-lock').classList.remove('hidden');
                }, 2000);
            },

            startPhase3Transition() {
                // ××¤×§×˜ ×¨××™×™×” ×ª×¨××™×ª
                document.getElementById('overlay-thermal').style.display = 'block';
                document.getElementById('overlay-thermal').style.opacity = 1;
                
                setTimeout(() => {
                    this.completePhase2();
                }, 3000);
            },

            completePhase2() {
                State.phase = 3;
                this.log(Story.phase2_done);
                
                document.getElementById('overlay-thermal').style.display = 'none';
                document.getElementById('layer-hallway').style.opacity = 0;
                document.getElementById('layer-engine').style.opacity = 1;
                document.getElementById('overlay-darkness').style.opacity = 1; // ×—×•×©×š ××•×—×œ×˜

                document.getElementById('ind-temp').classList.remove('active');
                document.getElementById('ind-audio').classList.add('active');

                document.getElementById('hs-debris').style.display = 'none';
                document.getElementById('hs-panel').style.display = 'none';
                document.getElementById('hs-door-lock').style.display = 'none';
                
                document.getElementById('hs-cabinet').classList.remove('hidden');
                
                // ×‘×“×™×§×” ×× ×™×© ×¡×•×¨×§ ××•×›×Ÿ (××•×œ×™ ×”×•× ×›×‘×¨ ×”×›×™×Ÿ)
                if(Inventory.has(Items.SONAR.id)) {
                    Minigames.startSonar();
                } else {
                    this.log("×”×—×“×¨ ×—×©×•×š. ×¢×œ×™×š ×œ××¦×•× ×“×¨×š ×œ×©××•×¢ ××•×ª×•.");
                }
            }
        };

        /**
         * ==========================================================================
         * 3. ××¢×¨×›×ª ××œ××™ ×•×”×¨×›×‘×” (INVENTORY & CRAFTING)
         * ==========================================================================
         */
        const Inventory = {
            items: [],
            
            initGrid() {
                const grid = document.getElementById('inventory-grid');
                grid.innerHTML = '';
                for(let i=0; i<12; i++) {
                    const div = document.createElement('div');
                    div.className = 'inv-item';
                    div.id = `inv-${i}`;
                    div.onclick = () => this.selectItem(i);
                    grid.appendChild(div);
                }
            },

            add(itemObj) {
                this.items.push(itemObj);
                this.render();
            },

            has(id) {
                return this.items.some(i => i.id === id);
            },

            render() {
                // × ×§×” ×”×›×œ
                document.querySelectorAll('.inv-item').forEach(el => {
                    el.innerHTML = '';
                    el.classList.remove('selected');
                });

                this.items.forEach((item, idx) => {
                    const el = document.getElementById(`inv-${idx}`);
                    el.innerHTML = `${item.icon}<div class="inv-tooltip">${item.name}</div>`;
                });
            },

            selectItem(idx) {
                if(!this.items[idx]) return;
                
                const item = this.items[idx];
                const slot = document.getElementById(`inv-${idx}`);

                // ×× ×›×‘×¨ × ×‘×—×¨, ×‘×˜×œ ×‘×—×™×¨×”
                if(State.craftingSlots.includes(idx)) {
                    State.craftingSlots = State.craftingSlots.filter(i => i !== idx);
                    slot.classList.remove('selected');
                } else {
                    // ×”×’×‘×œ×” ×œ-3 ×¤×¨×™×˜×™×
                    if(State.craftingSlots.length < 3) {
                        State.craftingSlots.push(idx);
                        slot.classList.add('selected');
                    }
                }
                Crafting.updateUI();
            },

            removeUsedItems() {
                // ××¡×™×¨ ××ª ×”×¤×¨×™×˜×™× ×©× ×‘×—×¨×• ×œ×”×¨×›×‘×”
                // ××™×•×Ÿ ×”×¤×•×š ×›×“×™ ×œ× ×œ×©×‘×•×¨ ××™× ×“×§×¡×™×
                State.craftingSlots.sort((a,b) => b-a);
                State.craftingSlots.forEach(idx => {
                    this.items.splice(idx, 1);
                });
                State.craftingSlots = [];
                this.render();
                Crafting.updateUI();
            }
        };

        const Crafting = {
            updateUI() {
                // ×¢×“×›×•×Ÿ ×”×¡×œ×•×˜×™× ×”×¢×œ×™×•× ×™×
                [1,2,3].forEach(i => {
                    const el = document.getElementById(`craft-${i}`);
                    el.innerHTML = i;
                    el.classList.remove('filled');
                });

                State.craftingSlots.forEach((invIdx, i) => {
                    const el = document.getElementById(`craft-${i+1}`);
                    const item = Inventory.items[invIdx];
                    el.innerHTML = item.icon;
                    el.classList.add('filled');
                });

                const btn = document.getElementById('btn-craft');
                if(State.craftingSlots.length > 1) { // ×¦×¨×™×š ×œ×¤×—×•×ª 2
                    btn.classList.add('ready');
                } else {
                    btn.classList.remove('ready');
                }
            },

            execute() {
                const selected = State.craftingSlots.map(i => Inventory.items[i].id);
                
                // ××ª×›×•× ×™×
                // ×©×œ×‘ 1: ×× ×•×¢ + ××—×˜ + ×¡×•×œ×œ×” = ××§×“×—
                if(this.checkRecipe(selected, ['motor', 'needle', 'battery'])) {
                    Inventory.removeUsedItems();
                    Inventory.add(Items.DRILL);
                    Game.log("<span class='highlight'>×”×¦×œ×—×”:</span> ×‘× ×™×ª ××§×“×— ×¨×˜×˜ ×‘×™×•××™××˜×™.");
                    return;
                }

                // ×©×œ×‘ 2: ×¢×“×©×•×ª + ×—×™×™×©×Ÿ + ×—×œ×§×™ ×¨×—×¤×Ÿ = ××©×§×¤×™×™×
                if(this.checkRecipe(selected, ['lens', 'sensor', 'drone_parts'])) {
                    Inventory.removeUsedItems();
                    Inventory.add(Items.GLASSES);
                    Game.log("<span class='highlight'>×”×¦×œ×—×”:</span> ×‘× ×™×ª ××©×§×¤×™ ×¨××™×™×” ×ª×¨××™×™×.");
                    return;
                }

                // ×©×œ×‘ 3: ××™×§×¨×•×¤×•×Ÿ + ××•×–× ×™×” = ×¡×•× ××¨
                if(this.checkRecipe(selected, ['mic', 'headset'])) {
                    Inventory.removeUsedItems();
                    Inventory.add(Items.SONAR);
                    Game.log("<span class='highlight'>×”×¦×œ×—×”:</span> ×”×¨×›×‘×ª ×¡×•×¨×§ ×©××¢ ×›×™×•×•× ×™.");
                    
                    // ×× ×× ×—× ×• ×›×‘×¨ ×‘×©×œ×‘ 3, ×”×¤×¢×œ ××ª ×”××™× ×™ ××©×—×§ ××™×“
                    if(State.phase === 3) Minigames.startSonar();
                    return;
                }

                Modal.msg("×©×’×™××”", "×©×™×œ×•×‘ ×¨×›×™×‘×™× ×œ× ×ª×§×™×Ÿ. × ×¡×” ×©×™×œ×•×‘ ××—×¨ ×”××‘×•×¡×¡ ×¢×œ ×”×™×’×™×•×Ÿ ×‘×™×•××™××˜×™.");
            },

            checkRecipe(selectedIds, recipeIds) {
                if(selectedIds.length !== recipeIds.length) return false;
                return recipeIds.every(id => selectedIds.includes(id));
            }
        };

        /**
         * ==========================================================================
         * 4. ××™× ×™-××©×—×§×™× (MINIGAMES)
         * ==========================================================================
         */
        const Minigames = {
            // ××©×—×§ 1: ×™×™×¦×•×‘ ×ª×“×¨ (×œ×“×™×–×”)
            startDrill() {
                const html = `
                    <p style="color:#ddd">×›×•×•×Ÿ ××ª ×ª×“×¨ ×”×¨×˜×˜ (×›×—×•×œ) ×©×™×ª××™× ×œ×ª×“×¨ ×”××˜× (×™×¨×•×§) ×›×“×™ ×œ×—×“×•×¨ ×œ×œ× ×—×™×›×•×š.</p>
                    <div id="game-wave-container">
                        <canvas id="wave-canvas"></canvas>
                        <input type="range" id="wave-slider" class="slider-control" min="1" max="100" value="50">
                        <div id="wave-status">×¡×˜×˜×•×¡: ×œ× ××¡×•× ×›×¨×Ÿ</div>
                    </div>
                `;
                Modal.show("×›×™×•×œ ××§×“×— ×¨×˜×˜", html);
                
                setTimeout(() => {
                    const cvs = document.getElementById('wave-canvas');
                    const ctx = cvs.getContext('2d');
                    cvs.width = 600; cvs.height = 200;
                    
                    const slider = document.getElementById('wave-slider');
                    const status = document.getElementById('wave-status');
                    
                    let userVal = 50;
                    let targetVal = 72; // ×”××¡×¤×¨ ×”×¡×•×“×™
                    let time = 0;
                    let successTime = 0;

                    slider.oninput = (e) => userVal = parseInt(e.target.value);

                    const loop = () => {
                        if(!document.getElementById('wave-canvas')) return; // ×™×¦×™××”
                        
                        ctx.fillStyle = '#000'; ctx.fillRect(0,0,600,200);
                        ctx.lineWidth = 2;
                        time += 0.2;

                        // ×’×œ ××˜×¨×” (×™×¨×•×§)
                        ctx.strokeStyle = 'rgba(0, 255, 157, 0.3)'; 
                        ctx.beginPath();
                        for(let x=0; x<600; x++) {
                            const y = 100 + Math.sin((x + time*5) * (targetVal/500)) * 50;
                            if(x==0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
                        }
                        ctx.stroke();

                        // ×’×œ ××©×ª××© (×›×—×•×œ/×–×”×‘)
                        const diff = Math.abs(userVal - targetVal);
                        const isSynced = diff < 5;
                        
                        ctx.strokeStyle = isSynced ? '#ffb700' : '#00d9ff';
                        ctx.beginPath();
                        for(let x=0; x<600; x++) {
                            // ×›×›×œ ×©××ª×§×¨×‘×™× ×œ×¢×¨×š, ×”×ª×“×¨ × ×”×™×” ×“×•××”
                            const freq = (userVal / 500); 
                            const y = 100 + Math.sin((x + time*5) * freq) * 50;
                            if(x==0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
                        }
                        ctx.stroke();

                        if(isSynced) {
                            status.innerText = "×¡×˜×˜×•×¡: × ×¢×•×œ (×—×•×“×¨...)";
                            status.style.color = "var(--status-ok)";
                            successTime++;
                            if(successTime > 100) { // ×›-2 ×©× ×™×•×ª ×©×œ ×”×—×–×§×”
                                Modal.close();
                                Game.completePhase1();
                                return;
                            }
                        } else {
                            status.innerText = "×¡×˜×˜×•×¡: ×œ× ××¡×•× ×›×¨×Ÿ";
                            status.style.color = "var(--status-crit)";
                            successTime = 0;
                        }
                        requestAnimationFrame(loop);
                    };
                    loop();
                }, 100);
            },

            // ××©×—×§ 3: ×¡×•× ××¨ (×œ××¦×™××ª ×”××“×¢×Ÿ)
            startSonar() {
                const html = `
                    <p>×”×—×“×¨ ×—×©×•×š. ×¢×§×•×‘ ××—×¨×™ ×”× ×§×•×“×” ×‘×¨×“××¨ (×¤×¢×™××•×ª ×”×œ×‘). ×œ×—×¥ ×›×©×”×¡××Ÿ ×¢×•×‘×¨ ×¢×œ×™×”.</p>
                    <div id="sonar-container">
                        <div id="sonar-sweep"></div>
                        <div id="sonar-dot"></div>
                    </div>
                    <p style="margin-top:10px; color:#888;">×œ×—×¥ ×¢×œ ×”× ×§×•×“×” ×”×œ×‘× ×” ×›×“×™ ×œ×ª×¤×•×¡ ××•×ª×•</p>
                `;
                Modal.show("×¡×•×¨×§ ×©××¢ ×›×™×•×•× ×™", html);

                setTimeout(() => {
                    const dot = document.getElementById('sonar-dot');
                    // ××™×§×•× ×¨× ×“×•××œ×™ ×‘×ª×•×š ×”××¢×’×œ
                    // ×›×“×™ ×œ×¤×©×˜, × ×©×™× ××•×ª×• ×‘××™×§×•× ×§×‘×•×¢ ×©×–×– ×§×¦×ª
                    
                    let angle = 0;
                    
                    // ×¢×“×›×•×Ÿ ××™×§×•× ×”× ×§×•×“×” (×›××™×œ×• ×–×–×”)
                    setInterval(() => {
                        const r = 80; 
                        const x = 150 + r * Math.cos(Date.now()/1000);
                        const y = 150 + r * Math.sin(Date.now()/1000);
                        dot.style.left = (x-5) + 'px';
                        dot.style.top = (y-5) + 'px';
                        
                        // ×”×‘×”×•×‘ ×œ×¤×™ ×”×¨×“××¨
                        // ×—×™×©×•×‘ ×–×•×•×™×ª ×”×¨×“××¨
                        const sweep = document.getElementById('sonar-sweep');
                        // ×–×” CSS Animation, ×§×©×” ×œ×¡× ×›×¨×Ÿ ×‘ JS ×˜×”×•×¨ ×‘×œ×™ requestAnimationFrame ××•×¨×›×‘.
                        // × ×¢×©×” ×˜×¨×™×§: ×”× ×§×•×“×” ××”×‘×”×‘×ª ×¡×ª×
                        dot.style.opacity = (Math.sin(Date.now()/100) > 0.8) ? 1 : 0; 

                    }, 50);

                    dot.onclick = () => {
                        Modal.close();
                        Modal.msg("× ×™×¦×—×•×Ÿ!", Story.win);
                        // ×¡×™×•× ×”××©×—×§
                        setTimeout(() => location.reload(), 5000);
                    };

                }, 100);
            }
        };

        /**
         * ==========================================================================
         * 5. ×× ×•×¢ ×’×¨×¤×™ ×•××¤×§×˜×™× (FX)
         * ==========================================================================
         */
        const Fx = {
                    initParticles() {
            const cvs = document.getElementById('particle-canvas');
            const ctx = cvs.getContext('2d');
        
            // handle HiDPI screens
            const resize = () => {
                const dpr = window.devicePixelRatio || 1;
                cvs.style.width = window.innerWidth + 'px';
                cvs.style.height = window.innerHeight + 'px';
                cvs.width = Math.floor(window.innerWidth * dpr);
                cvs.height = Math.floor(window.innerHeight * dpr);
                ctx.scale(dpr, dpr);
            };
            window.addEventListener('resize', resize);
            resize();
        
            // reduce particle count on small screens for performance
            const width = window.innerWidth;
            const count = width < 420 ? 18 : (width < 900 ? 32 : 50);
        
            const particles = Array.from({length: count}, () => ({
                x: Math.random() * window.innerWidth,
                y: Math.random() * window.innerHeight,
                size: Math.random() * (width < 420 ? 1.2 : 2),
                speedY: Math.random() * 0.5 - 0.2
            }));
        
            const loop = () => {
                ctx.clearRect(0,0,cvs.width,cvs.height);
                ctx.fillStyle = "rgba(200, 255, 200, 0.22)";
        
                particles.forEach(p => {
                    p.y -= p.speedY;
                    p.x += (Math.random()-0.5)*0.5;
                    if(p.y < 0) p.y = window.innerHeight;
                    if(p.y > window.innerHeight) p.y = 0;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
                    ctx.fill();
                });
                requestAnimationFrame(loop);
            };
            loop();
        }


        /**
         * ==========================================================================
         * 6. × ×™×”×•×œ ×—×œ×•× ×•×ª (MODAL MANAGER)
         * ==========================================================================
         */
        const Modal = {
            show(title, html) {
                document.getElementById('modal-title').innerText = title;
                document.getElementById('modal-content').innerHTML = html;
                document.getElementById('modal-game').classList.add('active');
            },
            close() {
                document.getElementById('modal-game').classList.remove('active');
            },
            msg(title, text) {
                document.getElementById('msg-title').innerText = title;
                document.getElementById('msg-text').innerText = text;
                document.getElementById('modal-msg').classList.add('active');
            },
            closeMsg() {
                document.getElementById('modal-msg').classList.remove('active');
            }
        };

        /**
         * ==========================================================================
         * 7. ××ª×—×•×œ (BOOT SEQUENCE)
         * ==========================================================================
         */
        window.onload = () => {
            const bootText = document.getElementById('boot-text');
            const lines = [
                "INITIALIZING NEURAL LINK...",
                "LOADING BIOMIMETIC DRIVERS...",
                "CONNECTING TO TRAIN SYSTEM OS...",
                "ACCESS GRANTED.",
                "USER: ADAM (ENGINEER)"
            ];
            
            let i = 0;
            const interval = setInterval(() => {
                if(i < lines.length) {
                    bootText.innerHTML += lines[i] + "\n";
                    i++;
                } else {
                    clearInterval(interval);
                    document.getElementById('boot-bar').style.width = "100%";
                    setTimeout(() => {
                        document.getElementById('boot-layer').style.display = 'none';
                        document.getElementById('app-wrapper').style.opacity = 1;
                        Game.init();
                    }, 1000);
                }
            }, 500);
        };

    </script>
</body>
</html>
