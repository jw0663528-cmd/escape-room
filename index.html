<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#000000">
    <title>×¤×¨×•×˜×•×§×•×œ ×”×¢×•×§×¥ | ××¢×¨×›×ª ×”×¤×¢×œ×” ×‘×™×•××™××˜×™×ª V4.0</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700;900&family=Heebo:wght@100;300;400;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">

    <style>
        /* * ==========================================================================
         * 1. ××¢×¨×›×ª ××©×ª× ×™× ×•×¢×™×¦×•×‘ ×’×œ×•×‘×œ×™ (GLOBAL VARIABLES & RESET)
         * ========================================================================== 
         */
        :root {
            /* ×¦×‘×¢×™× ×¨××©×™× - ×¢×¨×›×ª × ×•×©× Gold/Amber Engineering */
            --color-bg-hard: #020202;
            --color-bg-panel: #0a0b0d;
            --color-bg-panel-trans: rgba(10, 11, 13, 0.95);
            
            --color-border-dim: #1f2229;
            --color-border-bright: #3a3f4b;
            
            --color-primary: #ffb700; /* ×–×”×‘ - ×¦×‘×¢ ×¨××©×™ */
            --color-primary-dim: rgba(255, 183, 0, 0.2);
            --color-secondary: #00f2ff; /* ×¦×™××Ÿ - ×¦×‘×¢ ××©× ×™ ×˜×›× ×•×œ×•×’×™ */
            
            /* ×¦×‘×¢×™ ×¡×˜×˜×•×¡ */
            --status-success: #00ff9d;
            --status-warning: #ffae00;
            --status-danger: #ff2a2a;
            --status-neutral: #888888;

            /* ×˜×™×¤×•×’×¨×¤×™×” */
            --font-main: 'Heebo', sans-serif;
            --font-tech: 'Rubik', sans-serif;
            --font-mono: 'Share Tech Mono', monospace;

            /* ××™×“×•×ª */
            --header-height: 70px;
            --sidebar-width: 400px;
            --mobile-nav-height: 60px;

            /* ××¤×§×˜×™× */
            --shadow-glow: 0 0 20px var(--color-primary-dim);
            --text-glow: 0 0 10px rgba(255, 183, 0, 0.5);
            --crt-scanline: rgba(0, 0, 0, 0.1);
        }

        /* ××™×¤×•×¡ ××œ× */
        *, *::before, *::after {
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }

        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            background-color: var(--color-bg-hard);
            color: #e0e0e0;
            font-family: var(--font-main);
            overflow: hidden; /* ×§×¨×™×˜×™ ×œ××©×—×§ ××¡×š ××œ× */
            overscroll-behavior: none; /* ×× ×™×¢×ª ×’×œ×™×œ×ª ×§×¤×™×¥ ×‘××•×‘×™×™×œ */
        }

        /* ××¤×§×˜ ××¡×š ×™×©×Ÿ (CRT Overlay) ×œ×›×œ ×”××ª×¨ */
        body::after {
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
            z-index: 9999;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        /* ×¡×¨×’×œ ×’×œ×™×œ×” ××•×ª×× */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--color-bg-hard); }
        ::-webkit-scrollbar-thumb { background: var(--color-border-bright); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--color-primary); }

        /* * ==========================================================================
         * 2. ××¡×š ××ª×—×•×œ (BOOT SEQUENCE)
         * ========================================================================== 
         */
        #boot-sequence {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            z-index: 10000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-family: var(--font-mono); direction: ltr;
            padding: 20px;
        }

        .terminal-container {
            width: 100%; max-width: 800px; height: 50vh;
            border: 1px solid #333;
            background: #050505;
            padding: 20px;
            overflow-y: auto;
            margin-bottom: 20px;
            box-shadow: 0 0 30px rgba(0, 242, 255, 0.05);
        }

        .terminal-line {
            color: var(--color-secondary);
            font-size: 14px; margin-bottom: 5px; opacity: 0;
            animation: fadeIn 0.1s forwards;
        }
        .terminal-line.error { color: var(--status-danger); }
        .terminal-line.success { color: var(--status-success); }

        .loader-wrapper {
            width: 100%; max-width: 800px;
            height: 4px; background: #222; position: relative;
        }
        .loader-progress {
            height: 100%; width: 0%; background: var(--color-primary);
            box-shadow: 0 0 15px var(--color-primary);
            transition: width 0.1s linear;
        }

        /* * ==========================================================================
         * 3. ×¤×¨×™×¡×ª ×¢××•×“ (MAIN GRID LAYOUT)
         * ========================================================================== 
         */
        #main-interface {
            display: grid;
            grid-template-columns: 1fr var(--sidebar-width);
            grid-template-rows: var(--header-height) 1fr;
            width: 100%; height: 100%;
            opacity: 0; transition: opacity 1.5s ease-in;
        }

        /* ×›×•×ª×¨×ª ×¢×œ×™×•× ×” */
        .top-bar {
            grid-column: 1 / -1;
            background: var(--color-bg-panel);
            border-bottom: 2px solid var(--color-border-dim);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
            z-index: 100;
        }

        .brand {
            display: flex; align-items: center; gap: 15px;
        }
        .brand-logo {
            font-size: 28px;
        }
        .brand-text h1 {
            margin: 0; font-family: var(--font-tech); font-weight: 900;
            font-size: 24px; letter-spacing: 2px; color: var(--color-primary);
            text-transform: uppercase; text-shadow: var(--text-glow);
        }
        .brand-text span {
            font-size: 12px; color: #666; letter-spacing: 1px;
        }

        .status-panel {
            display: flex; gap: 20px; font-family: var(--font-mono); font-size: 13px;
        }
        .status-item {
            display: flex; align-items: center; gap: 8px; color: var(--color-secondary);
            border: 1px solid rgba(0, 242, 255, 0.2); padding: 5px 10px; border-radius: 4px;
        }
        .status-led {
            width: 8px; height: 8px; background: var(--color-secondary); border-radius: 50%;
            box-shadow: 0 0 8px var(--color-secondary);
        }
        .status-item.alert .status-led { background: var(--status-danger); box-shadow: 0 0 8px var(--status-danger); animation: blink 1s infinite; }
        .status-item.alert { color: var(--status-danger); border-color: rgba(255, 42, 42, 0.3); }

        /* ××–×•×¨ ×”××©×—×§ ×”××¨×›×–×™ */
        #viewport {
            position: relative;
            background: #000;
            overflow: hidden;
            border-left: 1px solid var(--color-border-dim);
            cursor: crosshair;
        }

        /* ×©×›×‘×•×ª ×¨×§×¢ ×¢× ××¢×‘×¨×™× ×—×œ×§×™× */
        .layer-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center;
            transition: opacity 2s ease-in-out, transform 10s ease;
            z-index: 1; opacity: 0;
        }
        #bg-layer-train { background-image: url('https://i.ibb.co/7tQt5S0h/Gemini-Generated-Image-prcu4rprcu4rprcu.png'); opacity: 1; }
        #bg-layer-hallway { background-image: url('https://i.ibb.co/svJJmvYr/Gemini-Generated-Image-l4kaehl4kaehl4ka.png'); filter: brightness(0.3) sepia(1) hue-rotate(190deg) contrast(1.2); }
        #bg-layer-lab { background-image: url('https://i.ibb.co/d04yrgRx/Gemini-Generated-Image-j02tg6j02tg6j02t.png'); filter: brightness(0.4) contrast(1.1); }

        /* ×§× ×‘×¡ ×—×œ×§×™×§×™× */
        #particles-canvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 5; pointer-events: none;
        }

        /* ×©×›×‘×•×ª ××¤×§×˜ ××™×•×—×“×•×ª */
        .fx-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; opacity: 0; transition: opacity 1.5s; z-index: 6;
        }
        #fx-gas { 
            background: radial-gradient(circle at 50% 60%, rgba(0, 255, 100, 0.15), transparent 70%);
            animation: gas-pulse 5s infinite alternate;
        }
        #fx-darkness {
            background: radial-gradient(circle at 50% 50%, transparent 150px, #000 450px);
            z-index: 8;
        }
        #fx-thermal {
            background: linear-gradient(180deg, rgba(0,50,0,0.1) 50%, rgba(0,0,0,0) 50%), repeating-linear-gradient(0deg, transparent, transparent 2px, #00ff00 3px);
            background-size: 100% 4px;
            filter: contrast(2) brightness(1.3) grayscale(1) invert(1);
            mix-blend-mode: hard-light; z-index: 7; display: none;
        }

        /* ×”×•×˜×¡×¤×•×˜×™× (××–×•×¨×™ ×œ×—×™×¦×”) */
        #hotspots-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 20;
        }

        .hotspot {
            position: absolute;
            width: 70px; height: 70px; /* ×’×“×•×œ ×œ× ×•×—×•×ª ××’×¢ */
            display: flex; justify-content: center; align-items: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0; /* × ×¡×ª×¨ ×¢×“ ××™× ×˜×¨××§×¦×™×”/×¡×•×¨×§ */
        }

        /* ×¢×™×¦×•×‘ ×”×›×•×•× ×ª (Reticle) */
        .reticle-ring {
            position: absolute; width: 100%; height: 100%;
            border: 1px dashed rgba(255, 183, 0, 0.4);
            border-radius: 50%;
            animation: spin-slow 10s linear infinite;
        }
        .reticle-corners {
            position: absolute; width: 60%; height: 60%;
            border: 1px solid var(--color-primary);
            box-shadow: 0 0 10px var(--color-primary-dim);
            transform: rotate(45deg);
            transition: 0.3s;
        }

        /* ××¦×‘ ×¡×•×¨×§ ×¤×¢×™×œ */
        .scanner-mode .hotspot {
            opacity: 0.6;
        }
        .scanner-mode .hotspot .reticle-ring {
            border-color: var(--color-secondary);
            animation: pulse-fast 1s infinite;
        }

        .hotspot:active, .hotspot:hover {
            opacity: 1 !important;
            transform: scale(1.1);
        }
        .hotspot:active .reticle-corners {
            background: rgba(255, 183, 0, 0.2);
            box-shadow: 0 0 20px var(--color-primary);
        }

        /* ×œ×™×™×‘×œ×™× ×¢×œ ×”×•×˜×¡×¤×•×˜ */
        .hs-tooltip {
            position: absolute; bottom: -30px;
            background: rgba(0,0,0,0.9); border: 1px solid var(--color-primary);
            color: var(--color-primary); font-family: var(--font-mono); font-size: 12px;
            padding: 4px 8px; border-radius: 2px; opacity: 0; pointer-events: none;
            transition: 0.2s; white-space: nowrap; z-index: 100;
        }
        .hotspot:active .hs-tooltip, .hotspot:hover .hs-tooltip { opacity: 1; bottom: -40px; }

        /* ××™×§×•××™ ×”×•×˜×¡×¤×•×˜×™× (×¨×¡×¤×•× ×¡×™×‘×™ ×‘××—×•×–×™×) */
        /* ×©×œ×‘ 1 */
        #hs-case { top: 68%; left: 75%; }
        #hs-seat { top: 62%; left: 22%; }
        #hs-vent { top: 8%; left: 50%; width: 140px; height: 80px; }
        /* ×©×œ×‘ 2 */
        #hs-junk { top: 75%; left: 35%; }
        #hs-panel { top: 45%; left: 12%; }
        #hs-door { top: 35%; left: 50%; width: 90px; height: 150px; }
        /* ×©×œ×‘ 3 */
        #hs-closet { top: 55%; left: 15%; }
        #hs-scientist { top: 40%; left: 65%; width: 100px; height: 220px; display: none;} 

        /* ×¡×¨×’×œ ×¦×“ (SIDEBAR) */
        #sidebar {
            background: var(--color-bg-panel);
            border-left: 2px solid var(--color-border-dim);
            display: flex; flex-direction: column;
            padding: 20px;
            box-shadow: -10px 0 40px rgba(0,0,0,0.8);
            z-index: 50; gap: 15px;
            overflow-y: auto;
        }

        /* ×¨×›×™×‘×™ UI ×‘×¡×¨×’×œ */
        .ui-panel {
            background: rgba(255,255,255,0.02);
            border: 1px solid var(--color-border-dim);
            border-radius: 6px; padding: 15px;
            position: relative;
        }
        .ui-panel::before {
            content: ''; position: absolute; top: -1px; left: -1px;
            width: 15px; height: 15px;
            border-top: 2px solid var(--color-primary); border-left: 2px solid var(--color-primary);
        }
        .ui-title {
            font-family: var(--font-tech); font-weight: 700; font-size: 14px;
            color: var(--color-primary); text-transform: uppercase; letter-spacing: 1px;
            margin-bottom: 10px; border-bottom: 1px solid #333; padding-bottom: 5px;
        }

        /* ×›×¤×ª×•×¨ ×¡×•×¨×§ */
        #btn-scanner {
            width: 100%; padding: 16px;
            background: transparent; border: 1px solid var(--color-secondary); color: var(--color-secondary);
            font-family: var(--font-tech); font-weight: 700; font-size: 16px;
            cursor: pointer; transition: 0.3s;
            display: flex; justify-content: center; align-items: center; gap: 10px;
            text-transform: uppercase;
        }
        #btn-scanner.active {
            background: rgba(0, 242, 255, 0.15); box-shadow: 0 0 20px rgba(0, 242, 255, 0.2);
            border-color: #fff; color: #fff;
        }

        /* ×ª×¦×•×’×ª ×˜×§×¡×˜ ×“×™× ××™×ª (Typewriter) */
        #log-display {
            font-family: var(--font-main); font-size: 14px; line-height: 1.5; color: #ccc;
            height: 120px; overflow-y: auto;
        }
        .log-msg { margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px dashed #333; animation: slideIn 0.3s ease; }
        .highlight-text { color: var(--color-primary); font-weight: bold; }

        /* ××–×•×¨ ×”×¨×›×‘×” (Crafting) */
        .crafting-grid {
            display: flex; justify-content: space-between; gap: 5px; margin-bottom: 10px;
        }
        .craft-slot {
            width: 100%; aspect-ratio: 1;
            background: #000; border: 1px dashed #444;
            display: flex; justify-content: center; align-items: center;
            font-size: 24px; color: #333; transition: 0.3s;
        }
        .craft-slot.filled { border-color: var(--color-primary); color: #fff; box-shadow: inset 0 0 10px var(--color-primary-dim); }

        #btn-craft {
            width: 100%; padding: 12px; background: #1a1a1a; color: #555;
            border: none; font-weight: bold; font-family: var(--font-tech);
            cursor: not-allowed; transition: 0.3s;
        }
        #btn-craft.ready {
            background: var(--color-primary); color: #000; cursor: pointer;
            box-shadow: 0 0 15px var(--color-primary-dim);
        }

        /* ×ª×™×§ ×¦×™×•×“ */
        #inventory-container {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;
        }
        .inv-cell {
            aspect-ratio: 1; background: #080808; border: 1px solid #333; border-radius: 4px;
            display: flex; justify-content: center; align-items: center;
            font-size: 22px; cursor: pointer; position: relative; transition: 0.2s;
        }
        .inv-cell.selected { border-color: var(--status-success); box-shadow: 0 0 10px rgba(0, 255, 157, 0.2); }
        .inv-badge {
            position: absolute; top: 0; right: 0; width: 8px; height: 8px;
            background: var(--color-primary); border-radius: 50%; display: none;
        }
        .inv-cell.new .inv-badge { display: block; }

        /* * ==========================================================================
         * 4. ×—×œ×•× ×•×ª ×§×•×¤×¦×™× (MODALS)
         * ========================================================================== 
         */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 5000;
            display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: 0.4s ease;
            backdrop-filter: blur(8px); padding: 15px;
        }
        .modal-overlay.open { opacity: 1; pointer-events: auto; }

        .modal-card {
            background: #0b0c10; border: 2px solid var(--color-primary);
            box-shadow: 0 0 50px rgba(255, 183, 0, 0.15);
            width: 100%; max-width: 600px; max-height: 90vh;
            border-radius: 8px; padding: 25px;
            position: relative; display: flex; flex-direction: column;
            overflow-y: auto;
        }

        .modal-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px;
        }
        .modal-title { font-family: var(--font-tech); font-size: 20px; color: var(--color-primary); text-transform: uppercase; }
        .modal-close { font-size: 28px; color: #666; cursor: pointer; padding: 5px; }

        /* ×ª×•×›×Ÿ ××•×“××œ×™× ×“×™× ××™ */
        .modal-body { flex: 1; }

        /* ××™× ×™-××©×—×§ ×’×œ×™× */
        #wave-game-ui { display: flex; flex-direction: column; align-items: center; }
        #wave-canvas { width: 100%; height: 180px; background: #000; border: 1px solid #333; margin-bottom: 15px; border-radius: 4px; }
        input[type=range] { width: 100%; height: 40px; cursor: pointer; }
        .wave-status { font-family: var(--font-mono); font-size: 18px; margin-top: 10px; color: var(--status-danger); }

        /* ××™× ×™-××©×—×§ ×¡×•× ××¨ */
        #sonar-ui { position: relative; width: 280px; height: 280px; border-radius: 50%; border: 2px solid var(--status-success); background: radial-gradient(#002200, #000); margin: 0 auto; overflow: hidden; }
        #sonar-radar { position: absolute; width: 100%; height: 100%; background: conic-gradient(transparent 0deg, rgba(0,255,157,0.4) 30deg, transparent 30deg); border-radius: 50%; animation: spin-radar 3s linear infinite; }
        #sonar-target { position: absolute; width: 20px; height: 20px; background: #fff; border-radius: 50%; box-shadow: 0 0 15px #fff; opacity: 0; cursor: pointer; transition: 0.1s; }

        /* ×›×¤×ª×•×¨×™× ×›×œ×œ×™×™× */
        .btn-main {
            width: 100%; padding: 12px; margin-top: 15px;
            background: var(--color-primary); color: #000; border: none;
            font-weight: 700; border-radius: 4px; font-size: 16px; cursor: pointer;
        }

        /* * ==========================================================================
         * 5. ×”×ª×××” ×œ××•×‘×™×™×œ (MOBILE RESPONSIVE OVERRIDES)
         * ========================================================================== 
         */
        @media (max-width: 950px) {
            /* ×©×™× ×•×™ ×’×¨×™×“ ×œ×× ×›×™ */
            #main-interface {
                grid-template-columns: 1fr;
                /* ×©×™××•×© ×‘-dvh ×œ×× ×™×¢×ª ×‘×¢×™×•×ª ×¡×¨×’×œ ×“×¤×“×¤×Ÿ */
                grid-template-rows: 60px 1fr auto; 
            }

            /* ×”×§×˜× ×ª ×›×•×ª×¨×ª */
            .top-bar { padding: 0 15px; height: 60px; }
            .brand-text h1 { font-size: 18px; }
            .brand-text span { display: none; }
            .status-panel { gap: 8px; font-size: 11px; }

            /* ××–×•×¨ ××©×—×§ */
            #viewport {
                border-left: none;
                border-bottom: 2px solid var(--color-border-dim);
            }

            /* ×¡×¨×’×œ ×¦×“ ×”×•×¤×š ×œ×ª×—×ª×•×Ÿ */
            #sidebar {
                border-left: none; border-top: 2px solid var(--color-border-dim);
                width: 100%; 
                height: auto; /* ×’×•×‘×” ××•×˜×•××˜×™ */
                max-height: 45vh; /* ×œ× ×™×•×ª×¨ ××—×¦×™ ××¡×š */
                padding: 10px;
                gap: 10px;
            }

            /* ×¡×™×“×•×¨ ××—×“×© ×©×œ ×”×¤×× ×œ×™× ×‘×¡×¨×’×œ */
            .ui-panel { padding: 10px; margin-bottom: 0; }
            .ui-title { font-size: 12px; margin-bottom: 5px; }
            
            #log-display { height: 60px; font-size: 13px; }
            
            #btn-scanner {
                padding: 10px; font-size: 14px;
                border-width: 1px; 
            }

            /* ×ª×™×§ ×¦×™×•×“ ×‘×©×•×¨×” ××—×ª ×’×œ×™×œ×” ××•×¤×§×™×ª */
            #inventory-container {
                grid-template-columns: repeat(6, 1fr);
                overflow-x: auto;
                padding-bottom: 5px;
            }
            .inv-cell { font-size: 20px; }

            /* ×›×¤×ª×•×¨ ×™×¦×™×¨×” */
            #btn-craft { padding: 10px; font-size: 14px; }

            /* ×”×•×˜×¡×¤×•×˜×™× */
            .hotspot { width: 80px; height: 80px; } /* ×’×“×•×œ ×™×•×ª×¨ ×œ××’×¢ */
            .hs-tooltip { bottom: -25px; font-size: 11px; background: rgba(0,0,0,0.95); }

            /* ××•×“××œ×™× */
            .modal-card { width: 95%; max-height: 95dvh; padding: 15px; }
            .modal-title { font-size: 18px; }
            #wave-canvas { height: 150px; }
            #sonar-ui { width: 220px; height: 220px; }
        }

        /* ×× ×™××¦×™×•×ª */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes blink { 50% { opacity: 0.4; } }
        @keyframes spin-slow { 100% { transform: rotate(360deg); } }
        @keyframes spin-radar { 100% { transform: rotate(360deg); } }
        @keyframes pulse-fast { 0% { opacity: 0.5; transform: scale(0.9); } 50% { opacity: 1; transform: scale(1.0); } 100% { opacity: 0.5; transform: scale(0.9); } }
        @keyframes gas-pulse { 0% { opacity: 0.6; } 100% { opacity: 0.9; } }
        @keyframes slideIn { from { opacity: 0; margin-left: -10px; } to { opacity: 1; margin-left: 0; } }

    </style>
</head>
<body>

    <div id="boot-sequence">
        <div class="terminal-container" id="terminal-out"></div>
        <div class="loader-wrapper">
            <div class="loader-progress" id="boot-bar"></div>
        </div>
    </div>

    <div id="main-interface">
        
        <header class="top-bar">
            <div class="brand">
                <div class="brand-logo">â˜£ï¸</div>
                <div class="brand-text">
                    <h1>PROT-CULEX</h1>
                    <span>BIOMIMETIC ENGINEERING INTERFACE</span>
                </div>
            </div>
            <div class="status-panel">
                <div class="status-item alert" id="st-gas"><div class="status-led"></div> ×–×™×”×•×™ ×¨×¢×œ×Ÿ</div>
                <div class="status-item" id="st-vis"><div class="status-led"></div> ×¨××™×™×”</div>
                <div class="status-item" id="st-aud"><div class="status-led"></div> ×©××¢</div>
            </div>
        </header>

        <main id="viewport">
            <canvas id="particles-canvas"></canvas>
            
            <div class="fx-overlay" id="fx-gas" style="opacity:1;"></div>
            <div class="fx-overlay" id="fx-darkness"></div>
            <div class="fx-overlay" id="fx-thermal"></div>

            <div class="layer-bg" id="bg-layer-lab"></div>
            <div class="layer-bg" id="bg-layer-hallway"></div>
            <div class="layer-bg" id="bg-layer-train"></div>

            <div id="hotspots-layer">
                <div class="hotspot" id="hs-case" data-target="suitcase">
                    <div class="reticle-ring"></div><div class="reticle-corners"></div>
                    <div class="hs-tooltip">××–×•×•×“×ª ×¨×›×™×‘×™×</div>
                </div>
                <div class="hotspot" id="hs-seat" data-target="seat">
                    <div class="reticle-ring"></div><div class="reticle-corners"></div>
                    <div class="hs-tooltip">××•×©×‘ × ×•×¡×¢</div>
                </div>
                <div class="hotspot" id="hs-vent" data-target="vent">
                    <div class="reticle-ring"></div><div class="reticle-corners"></div>
                    <div class="hs-tooltip">××¢×¨×›×ª ×¤×œ×™×˜×”</div>
                </div>

                <div class="hotspot" id="hs-junk" data-target="junk" style="display:none">
                    <div class="reticle-ring"></div><div class="reticle-corners"></div>
                    <div class="hs-tooltip">×’×¨×•×˜××•×ª ××œ×§×˜×¨×•× ×™×§×”</div>
                </div>
                <div class="hotspot" id="hs-panel" data-target="panel" style="display:none">
                    <div class="reticle-ring"></div><div class="reticle-corners"></div>
                    <div class="hs-tooltip">×¤×× ×œ ×‘×§×¨×”</div>
                </div>
                <div class="hotspot" id="hs-door" data-target="door" style="display:none">
                    <div class="reticle-ring"></div><div class="reticle-corners"></div>
                    <div class="hs-tooltip">×“×œ×ª ×× ×•×¢</div>
                </div>

                <div class="hotspot" id="hs-closet" data-target="closet" style="display:none">
                    <div class="reticle-ring"></div><div class="reticle-corners"></div>
                    <div class="hs-tooltip">××¨×•×Ÿ ×¦×™×•×“</div>
                </div>
                <div class="hotspot" id="hs-scientist" data-target="scientist" style="display:none">
                    </div>
            </div>
        </main>

        <aside id="sidebar">
            <div class="ui-panel" style="flex:1;">
                <div class="ui-title">×™×•××Ÿ ××©×™××”</div>
                <div id="log-display">
                    </div>
            </div>

            <button id="btn-scanner" onclick="GameEngine.toggleScanner()">
                <span style="font-size:20px;">ğŸ‘ï¸</span> ×¡×•×¨×§ ×ª×¨××™: ×›×‘×•×™
            </button>

            <div class="ui-panel">
                <div class="ui-title">×¢××“×ª ××™× ×˜×’×¨×¦×™×” (×‘×—×¨ 3)</div>
                <div class="crafting-grid">
                    <div class="craft-slot" id="slot-1"></div>
                    <div class="craft-slot" id="slot-2"></div>
                    <div class="craft-slot" id="slot-3"></div>
                </div>
                <button id="btn-craft" onclick="CraftingSystem.craft()">×‘×¦×¢ ×”×¨×›×‘×”</button>
            </div>

            <div class="ui-panel">
                <div class="ui-title">××—×¡×Ÿ ×¨×›×™×‘×™×</div>
                <div id="inventory-container">
                    </div>
            </div>
        </aside>
    </div>

    <div id="modal-msg" class="modal-overlay">
        <div class="modal-card" style="max-width:400px;">
            <div class="modal-header">
                <div class="modal-title" id="msg-title">×”×•×“×¢×”</div>
                <div class="modal-close" onclick="ModalManager.close('modal-msg')">Ã—</div>
            </div>
            <div class="modal-body" style="text-align:center;">
                <p id="msg-text" style="font-size:16px; margin-bottom:20px; color:#ccc;"></p>
                <button class="btn-main" onclick="ModalManager.close('modal-msg')">××™×©×•×¨</button>
            </div>
        </div>
    </div>

    <div id="modal-wave" class="modal-overlay">
        <div class="modal-card">
            <div class="modal-header">
                <div class="modal-title">×¡× ×›×¨×•×Ÿ ×ª×“×¨ ×¨×˜×˜</div>
            </div>
            <div class="modal-body" id="wave-game-ui">
                <p style="text-align:center; color:#888;">×”×ª×× ××ª ×”×’×œ ×”×›×—×•×œ (×©×œ×š) ×œ×’×œ ×”×™×¨×•×§ (×”××˜×¨×”) ×›×“×™ ×œ×—×“×•×¨ ××ª ×”×“×™×–×”.</p>
                <canvas id="wave-canvas"></canvas>
                <input type="range" id="wave-slider" min="1" max="100" value="50">
                <div class="wave-status" id="wave-status">×œ× ××¡×•× ×›×¨×Ÿ</div>
            </div>
        </div>
    </div>

    <div id="modal-sonar" class="modal-overlay">
        <div class="modal-card">
            <div class="modal-header">
                <div class="modal-title">××™×ª×•×¨ ×©××¢ ×›×™×•×•× ×™</div>
            </div>
            <div class="modal-body" style="text-align:center;">
                <p style="color:#888; margin-bottom:20px;">×”×§×©×‘ ×œ×¤×¢×™××•×ª ×”×œ×‘. ×œ×—×¥ ×¢×œ ×”× ×§×•×“×” ×”×œ×‘× ×” ×›×©×”×™× ××•×¤×™×¢×”.</p>
                <div id="sonar-ui">
                    <div id="sonar-radar"></div>
                    <div id="sonar-target"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        /**
         * ==========================================================================
         * 1. CONFIG & DATA
         * ==========================================================================
         */
        const ItemsDB = {
            MOTOR: { id: 'motor', icon: 'âš™ï¸', name: '×× ×•×¢ ×¨×˜×˜' },
            NEEDLE: { id: 'needle', icon: 'ğŸ“', name: '××—×˜ ××™×§×¨×•× ×™×ª' },
            BATTERY: { id: 'battery', icon: 'ğŸ”‹', name: '×¡×•×œ×œ×ª ×œ×™×ª×™×•×' },
            DRILL: { id: 'drill', icon: 'ğŸ¦Ÿ', name: '××§×“×— ×‘×™×•××™××˜×™', tool: true },
            
            LENS: { id: 'lens', icon: 'ğŸ‘“', name: '×¢×“×©×•×ª' },
            SENSOR: { id: 'sensor', icon: 'ğŸŒ¡ï¸', name: '×—×™×™×©×Ÿ ×ª×¨××™' },
            PARTS: { id: 'parts', icon: 'ğŸš', name: '×—×œ×§×™ ×¨×—×¤×Ÿ' },
            GLASSES: { id: 'glasses', icon: 'ğŸ•¶ï¸', name: '××©×§×¤×™ ×ª×¨××™', tool: true },

            MIC: { id: 'mic', icon: 'ğŸ™ï¸', name: '××™×§×¨×•×¤×•×Ÿ' },
            HEADSET: { id: 'headset', icon: 'ğŸ§', name: '××•×–× ×™×™×”' },
            WIRE: { id: 'wire', icon: 'ğŸ”Œ', name: '×—×•×˜' },
            SONAR: { id: 'sonar', icon: 'ğŸ“¡', name: '×¡×•×¨×§ ×§×•×œ×™', tool: true }
        };

        const StoryDB = {
            start: "×”×ª×¨××ª ×—×™×¨×•×! ×’×– ×¨×¢×™×œ ×–×•×”×” ×‘×§×¨×•×Ÿ. ×”×“×™×–×” ××•×’× ×ª ×‘×œ×—×¥. ×¢×œ×™×š ×œ×‘× ×•×ª ×›×œ×™ ×—×“×™×¨×” ×¢×“×™×Ÿ (×›××• ×™×ª×•×©) ×›×“×™ ×œ× ×˜×¨×œ ××•×ª×”.",
            phase2: "×”×’×– × ×¢×¦×¨. ×”×“×œ×ª × ×¤×ª×—×” ×œ××¡×“×¨×•×Ÿ ×—×©×•×š ×¢× ×œ×™×™×–×¨×™×. ××ª×” ×¦×¨×™×š ×œ×¨××•×ª ××ª ×”×—×•×.",
            phase3: "×”×’×¢×ª ×œ×§×˜×¨. ××¨×§×“×™×•×¡ ×‘×—×•×©×š. ×”×•× ××—×–×™×§ ×‘× ×•×’×“×Ÿ. ××ª×” ×¦×¨×™×š ×œ×©××•×¢ ××ª ×¤×¢×™××•×ª ×”×œ×‘ ×©×œ×•.",
            win: "× ×™×¦×—×•×Ÿ! ×ª×¤×¡×ª ××ª ××¨×§×“×™×•×¡ ×•×œ×§×—×ª ××ª ×”× ×•×’×“×Ÿ. ×”×¦×œ×ª ××ª ×”×¨×›×‘×ª."
        };

        /**
         * ==========================================================================
         * 2. GAME ENGINE
         * ==========================================================================
         */
        class GameEngine {
            constructor() {
                this.phase = 1;
                this.isScannerActive = false;
                this.solved = [];
            }

            init() {
                InventorySystem.init();
                StoryManager.add(StoryDB.start);
                ParticleEngine.init();
                
                // ×”×•×¡×¤×ª ×××–×™× ×™× ×œ×”×•×˜×¡×¤×•×˜×™×
                document.querySelectorAll('.hotspot').forEach(el => {
                    el.addEventListener('click', (e) => this.handleInteraction(e.currentTarget));
                });
            }

            toggleScanner() {
                this.isScannerActive = !this.isScannerActive;
                const btn = document.getElementById('btn-scanner');
                
                if (this.isScannerActive) {
                    document.body.classList.add('scanner-mode');
                    btn.classList.add('active');
                    btn.innerHTML = `<span style="font-size:20px;">ğŸ‘ï¸</span> ×¡×•×¨×§ ×ª×¨××™: ×¤×¢×™×œ`;
                    StoryManager.add("×¡×•×¨×§ ×”×•×¤×¢×œ. ××˜×¨×•×ª ××•×“×’×©×•×ª.", "tech");
                } else {
                    document.body.classList.remove('scanner-mode');
                    btn.classList.remove('active');
                    btn.innerHTML = `<span style="font-size:20px;">ğŸ‘ï¸</span> ×¡×•×¨×§ ×ª×¨××™: ×›×‘×•×™`;
                }
            }

            handleInteraction(element) {
                const target = element.dataset.target;
                
                // ×—×•×§×™×•×ª ×¡×•×¨×§ (×—×•×‘×” ×œ×”×¤×¢×™×œ ×¡×•×¨×§ ×œ××¢×˜ ×“×œ×ª×•×ª ×¨××©×™×•×ª)
                if (!this.isScannerActive && target !== 'vent' && target !== 'door') {
                    ModalManager.showMsg("×©×’×™××”", "×œ× × ×™×ª×Ÿ ×œ×–×”×•×ª ××•×‘×™×™×§×˜. × ×“×¨×©×ª ×¡×¨×™×§×” ×ª×¨××™×ª.");
                    return;
                }

                if (this.solved.includes(target)) return;

                switch(target) {
                    // ×©×œ×‘ 1
                    case 'suitcase':
                        this.collect(['MOTOR', 'BATTERY'], target);
                        StoryManager.add("××¦××ª ×× ×•×¢ ×•×¡×•×œ×œ×” ×‘××–×•×•×“×”.");
                        break;
                    case 'seat':
                        this.collect(['NEEDLE'], target);
                        StoryManager.add("××¦××ª ××—×˜ ××ª×—×ª ×œ××•×©×‘.");
                        break;
                    case 'vent':
                        if (InventorySystem.has('drill')) {
                            MiniGames.startWaveGame();
                        } else {
                            ModalManager.showMsg("×¡×›× ×”", "× ×’×™×¢×” ×‘×™×“ ×ª×¤×•×¦×¥ ××ª ×”×“×™×–×”. × ×“×¨×© ××§×“×— ×¨×˜×˜.");
                        }
                        break;

                    // ×©×œ×‘ 2
                    case 'junk':
                        this.collect(['LENS', 'PARTS'], target);
                        StoryManager.add("×¤×™×¨×§×ª ×’×¨×•×˜××•×ª ×•××¦××ª ×¢×“×©×•×ª.");
                        break;
                    case 'panel':
                        this.collect(['SENSOR'], target);
                        StoryManager.add("×¢×§×¨×ª ×—×™×™×©×Ÿ ×ª×¨××™.");
                        break;
                    case 'door':
                        if (InventorySystem.has('glasses')) {
                            this.transitionToPhase3();
                        } else {
                            ModalManager.showMsg("×¡×›× ×”", "×”××¡×“×¨×•×Ÿ ×—×©×•×š ×•××œ× ×œ×™×™×–×¨×™×. ××™ ××¤×©×¨ ×œ×¢×‘×•×¨.");
                        }
                        break;

                    // ×©×œ×‘ 3
                    case 'closet':
                        this.collect(['MIC', 'HEADSET', 'WIRE'], target);
                        StoryManager.add("××¦××ª ×¦×™×•×“ ×”××–× ×”.");
                        break;
                }
            }

            collect(itemKeys, targetId) {
                itemKeys.forEach(k => InventorySystem.addItem(ItemsDB[k]));
                this.solved.push(targetId);
                document.getElementById('hs-' + targetId).style.display = 'none';
            }

            transitionToPhase2() {
                this.phase = 2;
                StoryManager.add(StoryDB.phase2);
                
                // ×¢×“×›×•×Ÿ ×•×™×–×•××œ×™
                document.getElementById('fx-gas').style.opacity = 0;
                document.getElementById('st-gas').classList.remove('active', 'alert');
                document.getElementById('st-vis').classList.add('active', 'alert');
                
                // ××¢×‘×¨ ×¨×§×¢ (Fade)
                document.getElementById('bg-layer-train').style.opacity = 0;
                document.getElementById('bg-layer-hallway').style.opacity = 1;

                // ×”×—×œ×¤×ª ×”×•×˜×¡×¤×•×˜×™×
                document.getElementById('hs-vent').style.display = 'none';
                document.getElementById('hs-junk').style.display = 'flex';
                document.getElementById('hs-panel').style.display = 'flex';
                document.getElementById('hs-door').style.display = 'flex';
            }

            transitionToPhase3() {
                this.phase = 3;
                StoryManager.add(StoryDB.phase3);

                document.getElementById('fx-thermal').style.display = 'block'; // ××¤×§×˜ ××¢×‘×¨
                setTimeout(() => { document.getElementById('fx-thermal').style.display = 'none'; }, 2000);

                document.getElementById('bg-layer-hallway').style.opacity = 0;
                document.getElementById('bg-layer-lab').style.opacity = 1;
                document.getElementById('fx-darkness').style.opacity = 1; // ×—×•×©×š ××•×—×œ×˜

                document.getElementById('st-vis').classList.remove('active', 'alert');
                document.getElementById('st-aud').classList.add('active', 'alert');

                document.getElementById('hs-junk').style.display = 'none';
                document.getElementById('hs-panel').style.display = 'none';
                document.getElementById('hs-door').style.display = 'none';
                document.getElementById('hs-closet').style.display = 'flex';

                // ×× ×›×‘×¨ ×™×© ×¡×•× ××¨ (××•×œ×™ ×‘× ×” ××¨××©?)
                if(InventorySystem.has('sonar')) MiniGames.startSonar();
            }
        }

        /**
         * ==========================================================================
         * 3. INVENTORY & CRAFTING
         * ==========================================================================
         */
        const InventorySystem = {
            items: [],
            selectedIndices: [],

            init() {
                const container = document.getElementById('inventory-container');
                for(let i=0; i<8; i++) {
                    let div = document.createElement('div');
                    div.className = 'inv-cell';
                    div.id = `inv-${i}`;
                    div.onclick = () => this.toggleSelection(i);
                    container.appendChild(div);
                }
            },

            addItem(item) {
                this.items.push(item);
                this.render();
            },

            has(itemId) {
                return this.items.some(i => i.id === itemId);
            },

            render() {
                // × ×™×§×•×™
                for(let i=0; i<8; i++) {
                    const el = document.getElementById(`inv-${i}`);
                    el.innerHTML = '';
                    el.classList.remove('selected');
                }
                
                // ×¦×™×•×¨
                this.items.forEach((item, idx) => {
                    const el = document.getElementById(`inv-${idx}`);
                    el.innerHTML = item.icon;
                    if(this.selectedIndices.includes(idx)) el.classList.add('selected');
                });
            },

            toggleSelection(idx) {
                if (!this.items[idx]) return;
                
                if (this.selectedIndices.includes(idx)) {
                    this.selectedIndices = this.selectedIndices.filter(i => i !== idx);
                } else {
                    if (this.selectedIndices.length < 3) this.selectedIndices.push(idx);
                }
                this.render();
                CraftingSystem.updateUI();
            },

            consumeSelected() {
                // ×”×¡×¨×” ××”×¡×•×£ ×œ×”×ª×—×œ×” ×›×“×™ ×œ× ×œ×©×‘×•×¨ ××™× ×“×§×¡×™×
                this.selectedIndices.sort((a,b) => b-a).forEach(idx => {
                    this.items.splice(idx, 1);
                });
                this.selectedIndices = [];
                this.render();
                CraftingSystem.updateUI();
            }
        };

        const CraftingSystem = {
            updateUI() {
                // ×¢×“×›×•×Ÿ ×ª×¦×•×’×” ×‘×©×•×œ×—×Ÿ ×”×¢×‘×•×“×”
                [1,2,3].forEach(i => document.getElementById(`slot-${i}`).innerHTML = '');
                
                InventorySystem.selectedIndices.forEach((invIdx, i) => {
                    const item = InventorySystem.items[invIdx];
                    document.getElementById(`slot-${i+1}`).innerHTML = item.icon;
                });

                const btn = document.getElementById('btn-craft');
                if (InventorySystem.selectedIndices.length === 3 || (engine.phase === 3 && InventorySystem.selectedIndices.length >= 2)) {
                    btn.classList.add('ready');
                } else {
                    btn.classList.remove('ready');
                }
            },

            craft() {
                const ids = InventorySystem.selectedIndices.map(i => InventorySystem.items[i].id);
                
                // ××ª×›×•× ×™×
                if (this.check(ids, ['motor', 'needle', 'battery'])) {
                    InventorySystem.consumeSelected();
                    InventorySystem.addItem(ItemsDB.DRILL);
                    StoryManager.add("×”×¦×œ×—×”: ××§×“×— ×¨×˜×˜ × ×‘× ×”.", "success");
                    return;
                }
                if (this.check(ids, ['lens', 'sensor', 'parts'])) {
                    InventorySystem.consumeSelected();
                    InventorySystem.addItem(ItemsDB.GLASSES);
                    StoryManager.add("×”×¦×œ×—×”: ××©×§×¤×™ ×ª×¨××™ × ×‘× ×•.", "success");
                    return;
                }
                if (this.check(ids, ['mic', 'headset', 'wire'])) {
                    InventorySystem.consumeSelected();
                    InventorySystem.addItem(ItemsDB.SONAR);
                    StoryManager.add("×”×¦×œ×—×”: ×¡×•×¨×§ ×©××¢ × ×‘× ×”.", "success");
                    if (engine.phase === 3) MiniGames.startSonar();
                    return;
                }

                ModalManager.showMsg("×©×’×™××”", "×©×™×œ×•×‘ ×¨×›×™×‘×™× ×œ× ×ª×§×™×Ÿ.");
            },

            check(selected, recipe) {
                if (selected.length !== recipe.length) return false;
                return recipe.every(r => selected.includes(r));
            }
        };

        /**
         * ==========================================================================
         * 4. STORY MANAGER (Typewriter Effect)
         * ==========================================================================
         */
        const StoryManager = {
            add(text, type = 'normal') {
                const log = document.getElementById('log-display');
                const p = document.createElement('div');
                p.className = 'log-msg';
                if(type === 'success') p.style.color = 'var(--status-success)';
                if(type === 'tech') p.style.color = 'var(--status-warning)';
                
                log.prepend(p);
                
                // ××¤×§×˜ ×”×§×œ×“×”
                let i = 0;
                const speed = 20;
                function typeWriter() {
                    if (i < text.length) {
                        p.innerHTML += text.charAt(i);
                        i++;
                        setTimeout(typeWriter, speed);
                    }
                }
                typeWriter();
            }
        };

        /**
         * ==========================================================================
         * 5. MINI GAMES
         * ==========================================================================
         */
        const MiniGames = {
            startWaveGame() {
                ModalManager.open('modal-wave');
                
                setTimeout(() => {
                    const canvas = document.getElementById('wave-canvas');
                    // ×ª×™×§×•×Ÿ ×¨×–×•×œ×•×¦×™×” ×œ××•×‘×™×™×œ
                    const dpr = window.devicePixelRatio || 1;
                    const rect = canvas.getBoundingClientRect();
                    canvas.width = rect.width * dpr;
                    canvas.height = rect.height * dpr;
                    
                    const ctx = canvas.getContext('2d');
                    ctx.scale(dpr, dpr);

                    const slider = document.getElementById('wave-slider');
                    const status = document.getElementById('wave-status');
                    
                    let userVal = 50;
                    let targetVal = 72;
                    let time = 0;
                    let successCount = 0;
                    
                    slider.oninput = (e) => userVal = parseInt(e.target.value);

                    const loop = () => {
                        if (!document.getElementById('wave-canvas')) return; // ×× ×”××•×“××œ × ×¡×’×¨
                        
                        ctx.fillStyle = '#000';
                        ctx.fillRect(0, 0, rect.width, rect.height);
                        ctx.lineWidth = 3;
                        time += 0.2;

                        // ×’×œ ××˜×¨×”
                        ctx.strokeStyle = 'rgba(0, 255, 157, 0.3)';
                        ctx.beginPath();
                        for (let x = 0; x < rect.width; x++) {
                            const y = 90 + Math.sin((x + time * 5) * (targetVal / 500)) * 40;
                            if (x === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
                        }
                        ctx.stroke();

                        // ×’×œ ××©×ª××©
                        const diff = Math.abs(userVal - targetVal);
                        const isSynced = diff < 5;
                        ctx.strokeStyle = isSynced ? '#ffb700' : '#00f2ff';
                        ctx.beginPath();
                        for (let x = 0; x < rect.width; x++) {
                            const freq = (userVal / 500);
                            const y = 90 + Math.sin((x + time * 5) * freq) * 40;
                            if (x === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
                        }
                        ctx.stroke();

                        if (isSynced) {
                            status.innerText = "× ×¢×•×œ! ×—×•×“×¨...";
                            status.style.color = "var(--status-success)";
                            successCount++;
                            if (successCount > 100) {
                                ModalManager.close('modal-wave');
                                engine.transitionToPhase2();
                                return;
                            }
                        } else {
                            status.innerText = "×œ× ××¡×•× ×›×¨×Ÿ";
                            status.style.color = "var(--status-danger)";
                            successCount = 0;
                        }
                        requestAnimationFrame(loop);
                    };
                    loop();
                }, 300);
            },

            startSonar() {
                ModalManager.open('modal-sonar');
                
                const dot = document.getElementById('sonar-target');
                
                // ×ª× ×•×¢×” ×¨× ×“×•××œ×™×ª
                setInterval(() => {
                    const r = 80;
                    const x = 140 + r * Math.cos(Date.now() / 800);
                    const y = 140 + r * Math.sin(Date.now() / 800);
                    dot.style.left = (x - 10) + 'px';
                    dot.style.top = (y - 10) + 'px';
                    
                    // ×”×‘×”×•×‘
                    dot.style.opacity = (Math.sin(Date.now() / 200) > 0.7) ? 1 : 0;
                }, 50);

                dot.onclick = () => {
                    ModalManager.close('modal-sonar');
                    ModalManager.showMsg("× ×™×¦×—×•×Ÿ", StoryDB.win);
                    setTimeout(() => location.reload(), 5000);
                };
            }
        };

        /**
         * ==========================================================================
         * 6. UTILITIES
         * ==========================================================================
         */
        const ModalManager = {
            open(id) { document.getElementById(id).classList.add('open'); },
            close(id) { document.getElementById(id).classList.remove('open'); },
            showMsg(title, text) {
                document.getElementById('msg-title').innerText = title;
                document.getElementById('msg-text').innerText = text;
                this.open('modal-msg');
            }
        };

        const ParticleEngine = {
            init() {
                const cvs = document.getElementById('particles-canvas');
                const ctx = cvs.getContext('2d');
                
                const resize = () => {
                    cvs.width = window.innerWidth;
                    cvs.height = window.innerHeight;
                };
                window.addEventListener('resize', resize);
                resize();

                const particles = Array.from({length: 40}, () => ({
                    x: Math.random() * cvs.width,
                    y: Math.random() * cvs.height,
                    s: Math.random() * 2,
                    vx: (Math.random() - 0.5) * 0.5,
                    vy: (Math.random() - 0.5) * 0.5
                }));

                function animate() {
                    ctx.clearRect(0, 0, cvs.width, cvs.height);
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
                    particles.forEach(p => {
                        p.x += p.vx; p.y += p.vy;
                        if(p.x < 0) p.x = cvs.width; if(p.x > cvs.width) p.x = 0;
                        if(p.y < 0) p.y = cvs.height; if(p.y > cvs.height) p.y = 0;
                        ctx.beginPath(); ctx.arc(p.x, p.y, p.s, 0, Math.PI*2); ctx.fill();
                    });
                    requestAnimationFrame(animate);
                }
                animate();
            }
        };

        // --- ××ª×—×•×œ ×¨××©×™ ---
        const engine = new GameEngine();

        // Boot Sequence Simulation
        window.onload = () => {
            const term = document.getElementById('terminal-out');
            const lines = [
                "Booting Core System...",
                "Loading Graphic Drivers...",
                "Connecting to Train OS...",
                "Biometric Scan: Verified.",
                "Welcome, Engineer."
            ];
            
            let i = 0;
            const int = setInterval(() => {
                if(i >= lines.length) {
                    clearInterval(int);
                    document.getElementById('boot-bar').style.width = "100%";
                    setTimeout(() => {
                        document.getElementById('boot-sequence').style.display = 'none';
                        document.getElementById('main-interface').style.opacity = 1;
                        engine.init();
                    }, 500);
                } else {
                    const p = document.createElement('div');
                    p.className = 'terminal-line success';
                    p.innerText = "> " + lines[i];
                    term.appendChild(p);
                    i++;
                }
            }, 600);
        };

    </script>
</body>
</html>
