<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>×¤×¨×•×˜×•×§×•×œ ×”×¢×•×§×¥ | ×—×“×¨ ×‘×¨×™×—×” ×‘×™×•××™××˜×™</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700;900&family=Rubik:wght@400;500;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">

    <style>
        /* * ==========================================================================
         * 1. ×”×’×“×¨×•×ª ×¢×™×¦×•×‘ (DESIGN SYSTEM)
         * ========================================================================== */
        :root {
            --bg-deep: #050505;
            --bg-panel: #0f1012;
            --border-dim: #2a2a2a;
            --text-main: #d0d0d0;
            --text-highlight: #ffb700; /* ×–×”×‘ ×”× ×“×¡×™ */
            --status-ok: #00ff9d;
            --status-crit: #ff2a2a;
            --status-tech: #00f2ff;
            --sidebar-width: 350px;
            --header-height: 70px;
        }

        * { box-sizing: border-box; user-select: none; outline: none; -webkit-tap-highlight-color: transparent; }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background-color: var(--bg-deep); color: var(--text-main);
            font-family: 'Heebo', sans-serif; overflow: hidden;
        }

        /* * ==========================================================================
         * 2. ××¡×›×™× ××™×•×—×“×™× (BOOT, INTRO, CREDITS)
         * ========================================================================== */
        .overlay-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 10000;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            text-align: center; padding: 20px;
        }

        /* ××¡×š ×˜×¢×™× ×” */
        #boot-screen { font-family: 'Share Tech Mono', monospace; direction: ltr; }
        .boot-log { width: 100%; max-width: 600px; height: 200px; border: 1px solid #333; padding: 20px; overflow: hidden; text-align: left; color: var(--status-tech); font-size: 14px; margin-bottom: 20px; }
        .loading-bar { width: 100%; max-width: 600px; height: 4px; background: #222; position: relative; }
        .bar-fill { height: 100%; width: 0%; background: var(--text-highlight); transition: width 0.1s; }

        /* ××¡×š ×”×¡×‘×¨ / ×§×¨×“×™×˜×™× */
        .info-box {
            background: #0b0c10; border: 2px solid var(--text-highlight);
            box-shadow: 0 0 40px rgba(255, 183, 0, 0.2);
            padding: 40px; max-width: 700px; width: 90%;
            border-radius: 10px; position: relative;
        }
        .info-title { font-family: 'Rubik'; font-size: 32px; color: var(--text-highlight); margin-bottom: 20px; text-transform: uppercase; }
        .info-text { font-size: 18px; line-height: 1.6; color: #ccc; margin-bottom: 30px; }
        .info-text strong { color: #fff; }
        
        .credits-list { list-style: none; padding: 0; margin-bottom: 30px; font-size: 18px; }
        .credits-list li { margin-bottom: 10px; border-bottom: 1px dashed #333; padding-bottom: 10px; }
        .credits-role { color: var(--status-tech); font-size: 14px; display: block; margin-bottom: 5px; }
        .credits-name { font-weight: bold; color: #fff; font-size: 20px; }

        .btn-large {
            padding: 15px 40px; background: var(--text-highlight); color: #000;
            border: none; font-weight: bold; font-size: 20px; cursor: pointer;
            border-radius: 5px; transition: 0.3s; font-family: 'Rubik';
        }
        .btn-large:hover { background: #fff; transform: scale(1.05); }

        /* * ==========================================================================
         * 3. ×××©×§ ×”××©×—×§ (GAME UI)
         * ========================================================================== */
        #app-wrapper {
            display: grid;
            grid-template-columns: 1fr var(--sidebar-width);
            grid-template-rows: var(--header-height) 1fr;
            width: 100%; height: 100%;
            opacity: 0; transition: opacity 1s;
        }

        /* ×›×•×ª×¨×ª */
        #header-bar {
            grid-column: 1 / -1; background: var(--bg-panel); border-bottom: 2px solid var(--border-dim);
            display: flex; justify-content: space-between; align-items: center; padding: 0 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5); z-index: 100;
        }
        .logo-text { font-family: 'Rubik'; font-size: 24px; font-weight: 700; color: var(--text-highlight); letter-spacing: 2px; }
        .indicators { display: flex; gap: 20px; font-size: 14px; font-family: 'Heebo'; }
        .ind-item { display: flex; align-items: center; gap: 8px; color: #666; transition: 0.3s; }
        .ind-item.active { color: var(--status-tech); text-shadow: 0 0 5px var(--status-tech); }
        .ind-item.danger { color: var(--status-crit); animation: blink 1s infinite; }
        .led { width: 8px; height: 8px; background: #444; border-radius: 50%; }
        .active .led { background: var(--status-tech); box-shadow: 0 0 8px var(--status-tech); }
        .danger .led { background: var(--status-crit); box-shadow: 0 0 8px var(--status-crit); }

        /* ××¡×š ×ª×¦×•×’×” */
        #viewport {
            position: relative; background: #000; overflow: hidden;
            border-left: 2px solid var(--border-dim); cursor: crosshair;
        }
        .layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center;
            transition: opacity 1.5s; z-index: 1; opacity: 0;
        }
        /* ×ª××•× ×•×ª */
        #bg-train { background-image: url('https://i.ibb.co/7tQt5S0h/Gemini-Generated-Image-prcu4rprcu4rprcu.png'); opacity: 1; }
        #bg-hallway { background-image: url('https://i.ibb.co/svJJmvYr/Gemini-Generated-Image-l4kaehl4kaehl4ka.png'); filter: brightness(0.4) sepia(1) hue-rotate(180deg); }
        #bg-engine { background-image: url('https://i.ibb.co/d04yrgRx/Gemini-Generated-Image-j02tg6j02tg6j02t.png'); filter: brightness(0.2) contrast(1.2); }

        /* ××¤×§×˜×™× */
        #fx-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 5; pointer-events: none; mix-blend-mode: screen; }
        #overlay-gas { position: absolute; top:0; left:0; width:100%; height:100%; background: radial-gradient(circle, rgba(0,255,100,0.15), transparent 70%); z-index: 6; pointer-events: none; opacity: 0; transition: 1s; }
        #overlay-thermal { position: absolute; top:0; left:0; width:100%; height:100%; background: linear-gradient(180deg, rgba(0,50,0,0.1), transparent), repeating-linear-gradient(0deg, transparent, transparent 2px, #00ff00 3px); background-size: 100% 4px; filter: contrast(2) invert(1); mix-blend-mode: hard-light; z-index: 7; opacity: 0; pointer-events: none; transition: 0.5s; }
        #overlay-dark { position: absolute; top:0; left:0; width:100%; height:100%; background: radial-gradient(circle at 50% 50%, transparent 100px, #000 400px); z-index: 8; opacity: 0; pointer-events: none; transition: 2s; }

        /* ×”×•×˜×¡×¤×•×˜×™× */
        #hotspots-layer { position: absolute; top:0; left:0; width:100%; height:100%; z-index: 20; }
        .hotspot {
            position: absolute; width: 70px; height: 70px;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; opacity: 0; transition: 0.3s; border-radius: 50%;
        }
        .reticle {
            position: absolute; width: 100%; height: 100%;
            border: 1px dashed rgba(255, 183, 0, 0.4); border-radius: 50%;
            animation: spin-slow 10s linear infinite;
        }
        .corners {
            position: absolute; width: 60%; height: 60%;
            border: 2px solid var(--text-highlight); transform: rotate(45deg); transition: 0.3s;
            box-shadow: 0 0 10px rgba(255,183,0,0.3);
        }
        
        .scanner-on .hotspot { opacity: 0.6; }
        .hotspot:hover, .hotspot:active { opacity: 1 !important; transform: scale(1.1); }
        .hotspot:hover .corners { background: rgba(255,183,0,0.2); box-shadow: 0 0 20px var(--text-highlight); }

        .hs-label {
            position: absolute; bottom: -30px; font-family: 'Share Tech Mono'; font-size: 12px;
            color: var(--text-highlight); background: rgba(0,0,0,0.9); padding: 4px 8px;
            border: 1px solid var(--text-highlight); opacity: 0; pointer-events: none; z-index: 100;
        }
        .hotspot:hover .hs-label { opacity: 1; }

        /* ××™×§×•××™× */
        #hs-case { top: 68%; left: 75%; }
        #hs-seat { top: 62%; left: 22%; }
        #hs-vent { top: 8%; left: 50%; width: 140px; height: 80px; }
        #hs-debris { top: 75%; left: 35%; }
        #hs-panel { top: 45%; left: 12%; }
        #hs-door { top: 35%; left: 50%; width: 90px; height: 150px; }
        #hs-closet { top: 55%; left: 15%; }
        #hs-arcadius { top: 40%; left: 65%; width: 100px; height: 220px; opacity: 0; pointer-events: none; }

        /* ×¡×¨×’×œ ×¦×“ */
        #sidebar {
            background: var(--bg-panel); border-left: 2px solid var(--border-dim);
            display: flex; flex-direction: column; padding: 20px;
            box-shadow: -10px 0 40px rgba(0,0,0,0.8); z-index: 50; gap: 15px; overflow-y: auto;
        }

        .panel { background: rgba(255,255,255,0.03); border: 1px solid var(--border-dim); border-radius: 4px; padding: 15px; }
        .p-title { font-family: 'Rubik'; font-size: 13px; color: var(--text-highlight); text-transform: uppercase; border-bottom: 1px solid #333; padding-bottom: 5px; margin-bottom: 10px; }

        #story-log { height: 120px; overflow-y: auto; font-size: 14px; line-height: 1.5; color: #ccc; }
        .log-entry { margin-bottom: 10px; border-bottom: 1px dashed #333; padding-bottom: 5px; animation: fadeIn 0.3s; }
        .highlight { color: var(--text-highlight); font-weight: bold; }

        /* ×©×•×œ×—×Ÿ ×¢×‘×•×“×” */
        #crafting-area { display: flex; flex-direction: column; gap: 10px; }
        .craft-slots { display: flex; gap: 5px; }
        .c-slot {
            flex: 1; aspect-ratio: 1; background: #000; border: 1px dashed #444;
            display: flex; justify-content: center; align-items: center; font-size: 24px; color: #333; transition: 0.3s;
        }
        .c-slot.filled { border-color: var(--text-highlight); color: #fff; box-shadow: inset 0 0 10px rgba(255,183,0,0.2); }

        #btn-craft {
            width: 100%; padding: 12px; background: #222; border: 1px solid #333; color: #555;
            font-weight: bold; font-family: 'Rubik'; cursor: not-allowed; transition: 0.3s;
        }
        #btn-craft.ready { background: var(--text-highlight); color: #000; cursor: pointer; box-shadow: 0 0 15px rgba(255,183,0,0.4); border: none; }

        /* ×ª×™×§ ×¦×™×•×“ */
        #inventory-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .inv-cell {
            aspect-ratio: 1; background: #080808; border: 1px solid #333; border-radius: 4px;
            display: flex; justify-content: center; align-items: center; font-size: 20px;
            cursor: pointer; transition: 0.2s; position: relative;
        }
        .inv-cell.selected { border-color: var(--status-ok); box-shadow: 0 0 10px rgba(0,255,157,0.2); }

        /* ×›×¤×ª×•×¨ ×¡×•×¨×§ */
        #btn-scanner {
            width: 100%; padding: 15px; background: transparent; border: 1px solid var(--status-tech); color: var(--status-tech);
            font-family: 'Rubik'; font-weight: 700; font-size: 16px; cursor: pointer; transition: 0.3s;
            display: flex; justify-content: center; gap: 10px; text-transform: uppercase;
        }
        #btn-scanner.active { background: rgba(0, 242, 255, 0.15); box-shadow: 0 0 20px rgba(0, 242, 255, 0.2); color: #fff; border-color: #fff; }

        /* * ==========================================================================
         * 4. ××•×“××œ×™× (MODALS)
         * ========================================================================== */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 5000; display: none;
            justify-content: center; align-items: center; backdrop-filter: blur(5px); padding: 20px;
        }
        .modal-overlay.active { display: flex; animation: fadeIn 0.3s; }

        .modal-box {
            background: #0b0c10; border: 2px solid var(--text-highlight);
            box-shadow: 0 0 40px rgba(255, 183, 0, 0.2); width: 100%; max-width: 600px;
            border-radius: 8px; overflow: hidden; display: flex; flex-direction: column;
        }
        .modal-head { background: rgba(255,183,0,0.1); border-bottom: 1px solid #333; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        .modal-title { font-family: 'Rubik'; font-size: 18px; color: var(--text-highlight); }
        .modal-close { font-size: 24px; cursor: pointer; color: #666; padding: 5px; }
        .modal-body { padding: 20px; text-align: center; overflow-y: auto; max-height: 70vh; }

        /* ××©×—×§×™× */
        #tuner-ui canvas { width: 100%; height: 180px; background: #000; border: 1px solid #333; margin-bottom: 15px; }
        input[type=range] { width: 100%; height: 40px; cursor: pointer; }
        .tuner-status { font-family: 'Share Tech Mono'; font-size: 20px; margin-top: 10px; color: var(--status-crit); }

        #sonar-ui { position: relative; width: 250px; height: 250px; border-radius: 50%; border: 2px solid var(--status-ok); background: radial-gradient(#002200, #000); margin: 0 auto; overflow: hidden; }
        #sonar-radar { position: absolute; width: 100%; height: 100%; background: conic-gradient(transparent 0deg, rgba(0,255,157,0.5) 30deg, transparent 30deg); border-radius: 50%; animation: spin-radar 3s linear infinite; }
        #sonar-target { position: absolute; width: 20px; height: 20px; background: #fff; border-radius: 50%; box-shadow: 0 0 15px #fff; opacity: 0; cursor: pointer; transition: 0.1s; z-index: 10; }

        /* * ==========================================================================
         * 5. ×”×ª×××” ×œ××•×‘×™×™×œ (RESPONSIVE)
         * ========================================================================== */
        @media (max-width: 900px) {
            #app-wrapper {
                grid-template-columns: 1fr;
                grid-template-rows: 60px 1fr auto;
            }
            #header-bar { padding: 0 15px; height: 60px; }
            .logo-text { font-size: 18px; }
            .indicators { gap: 10px; font-size: 11px; }
            
            #viewport { border-left: none; border-bottom: 1px solid var(--border-dim); }
            
            #sidebar {
                border-left: none; border-top: 1px solid var(--border-dim);
                width: 100%; height: auto; max-height: 45vh; padding: 10px; gap: 10px;
            }
            .panel { padding: 10px; margin-bottom: 0; }
            #story-log { height: 80px; font-size: 13px; }
            #btn-scanner { padding: 10px; font-size: 14px; }
            
            #inventory-grid { grid-template-columns: repeat(6, 1fr); overflow-x: auto; padding-bottom: 5px; }
            .inv-cell { font-size: 20px; min-width: 50px; }
            
            .hotspot { width: 70px; height: 70px; }
            .hs-label { font-size: 11px; bottom: -25px; }
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes blink { 50% { opacity: 0.3; } }
        @keyframes spin-slow { 100% { transform: rotate(360deg); } }
        @keyframes spin-radar { 100% { transform: rotate(360deg); } }

    </style>
</head>
<body>

    <div id="boot-screen" class="overlay-screen">
        <div class="boot-log" id="boot-log"></div>
        <div class="loading-bar"><div class="bar-fill" id="bar-fill"></div></div>
    </div>

    <div id="modal-intro" class="overlay-screen" style="display:none;">
        <div class="info-box">
            <h1 class="info-title">×¤×¨×•×˜×•×§×•×œ ×”×¢×•×§×¥</h1>
            <div class="info-text">
                ×‘×¨×•×›×™× ×”×‘××™× ×œ×¡×™××•×œ×¦×™×” ×”×‘×™×•××™××˜×™×ª.<br><br>
                ××ª× × ××¦××™× ×‘×¨×›×‘×ª ×ª×—×ª ××ª×§×¤×” ×‘×™×•×œ×•×’×™×ª. ×¢×œ×™×›× ×œ×”×©×ª××© ×‘×”×™×’×™×•×Ÿ ×”× ×“×¡×™ ×•×‘×¢×§×¨×•× ×•×ª ××¢×•×œ× ×”×˜×‘×¢ (×”×™×ª×•×©) ×›×“×™ ×œ×©×¨×•×“.<br><br>
                <strong>×”×•×¨××•×ª:</strong><br>
                1. ×—×¤×©×• ×¨×›×™×‘×™× ××•×—×‘××™× (×”×©×ª××©×• ×‘×¡×•×¨×§ ×”×ª×¨××™).<br>
                2. ×”×¨×›×™×‘×• ×›×œ×™× ×‘×©×•×œ×—×Ÿ ×”×¢×‘×•×“×”.<br>
                3. ×¤×ª×¨×• ××ª ×”×—×™×“×•×ª ×›×“×™ ×œ×”×ª×§×“× ×‘×™×Ÿ ×”×§×¨×•× ×•×ª.
            </div>
            <button class="btn-large" onclick="Game.start()">×”×ª×—×œ ××©×™××”</button>
        </div>
    </div>

    <div id="modal-credits" class="overlay-screen" style="display:none;">
        <div class="info-box">
            <h1 class="info-title">×¦×•×•×ª ×”×¤×™×ª×•×—</h1>
            <ul class="credits-list">
                <li>
                    <span class="credits-role">× ×‘× ×” ×¢×œ ×™×“×™</span>
                    <span class="credits-name">×¢×™×“×Ÿ ××‘×¨×‘×•×š ×‘×¢×–×¨×ª Gemini</span>
                </li>
                <li>
                    <span class="credits-role">×—×•××¨ ×•×‘× ×™×™×ª ×¡×™×¤×•×¨</span>
                    <span class="credits-name">×™×•××‘ ×¤×œ×“××Ÿ</span>
                </li>
                <li>
                    <span class="credits-role">×§×‘×•×¦×” ×‘××“×¢×™×</span>
                    <span class="credits-name">×¢×™×“×Ÿ ××‘×¨×‘×•×š, ×™×•××‘ ×¤×œ×“××Ÿ, ×¡×”×¨ ×—×“×“</span>
                </li>
            </ul>
            <button class="btn-large" onclick="location.reload()">×—×–×¨×” ×œ×”×ª×—×œ×”</button>
        </div>
    </div>

    <div id="app-wrapper">
        <header id="header-bar">
            <div class="logo-text">×¤×¨×•×˜×•×§×•×œ ×”×¢×•×§×¥</div>
            <div class="indicators">
                <div class="ind-item danger active" id="ind-gas"><div class="led"></div> ×’×– ×¨×¢×™×œ</div>
                <div class="ind-item" id="ind-vis"><div class="led"></div> ×ª×¨××™</div>
                <div class="ind-item" id="ind-aud"><div class="led"></div> ×©××¢</div>
            </div>
        </header>

        <main id="viewport">
            <canvas id="fx-canvas"></canvas>
            
            <div id="overlay-gas" style="opacity:1;"></div>
            <div id="overlay-thermal"></div>
            <div id="overlay-dark"></div>

            <div class="layer" id="bg-engine"></div>
            <div class="layer" id="bg-hallway"></div>
            <div class="layer" id="bg-train"></div>

            <div id="hotspots-layer">
                <div class="hotspot" id="hs-case" data-id="case" style="top:68%; left:75%;"><div class="reticle"></div><div class="corners"></div><div class="hs-label">××–×•×•×“×”</div></div>
                <div class="hotspot" id="hs-seat" data-id="seat" style="top:62%; left:22%;"><div class="reticle"></div><div class="corners"></div><div class="hs-label">××•×©×‘</div></div>
                <div class="hotspot" id="hs-vent" data-id="vent" style="top:8%; left:50%; width:140px; height:80px;"><div class="reticle"></div><div class="corners"></div><div class="hs-label">×“×™×–×” ××©×•×¨×™×™× ×ª</div></div>

                <div class="hotspot" id="hs-debris" data-id="debris" style="top:75%; left:35%; display:none;"><div class="reticle"></div><div class="corners"></div><div class="hs-label">×’×¨×•×˜××•×ª</div></div>
                <div class="hotspot" id="hs-panel" data-id="panel" style="top:45%; left:12%; display:none;"><div class="reticle"></div><div class="corners"></div><div class="hs-label">×¤×× ×œ</div></div>
                <div class="hotspot" id="hs-door" data-id="door" style="top:35%; left:50%; width:100px; height:200px; display:none;"><div class="reticle"></div><div class="corners"></div><div class="hs-label">×“×œ×ª ×× ×•×¢</div></div>

                <div class="hotspot" id="hs-closet" data-id="closet" style="top:60%; left:15%; display:none;"><div class="reticle"></div><div class="corners"></div><div class="hs-label">××¨×•×Ÿ ×¦×™×•×“</div></div>
                <div class="hotspot" id="hs-arcadius" data-id="arcadius" style="top:40%; left:65%; width:100px; height:200px; display:none; opacity:0; pointer-events:none;"></div>
            </div>
        </main>

        <aside id="sidebar">
            <div class="panel" style="flex:1;">
                <div class="p-title">×™×•××Ÿ ××™×¨×•×¢×™×</div>
                <div id="story-log"></div>
            </div>

            <button id="btn-scanner" onclick="GameLogic.toggleScanner()">ğŸ‘ï¸ ×¡×•×¨×§ ×ª×¨××™: ×›×‘×•×™</button>

            <div class="panel">
                <div class="p-title">×©×•×œ×—×Ÿ ×¢×‘×•×“×” (×‘×—×¨ 3)</div>
                <div id="crafting-area">
                    <div class="craft-slots">
                        <div class="c-slot" id="slot-0"></div>
                        <div class="c-slot" id="slot-1"></div>
                        <div class="c-slot" id="slot-2"></div>
                    </div>
                    <button id="btn-craft" onclick="Crafting.craft()">×‘×¦×¢ ××™× ×˜×’×¨×¦×™×”</button>
                </div>
            </div>

            <div class="panel">
                <div class="p-title">×¦×™×•×“</div>
                <div id="inventory-grid"></div>
            </div>
        </aside>
    </div>

    <div id="modal-msg" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-head"><div class="modal-title">×”×•×“×¢×”</div><div class="modal-close" onclick="Modal.close('modal-msg')">Ã—</div></div>
            <div class="modal-body">
                <p id="msg-text" style="font-size:18px; margin-bottom:20px; color:#ccc;"></p>
                <button class="btn-large" style="width:100%; font-size:16px; padding:10px;" onclick="Modal.close('modal-msg')">××™×©×•×¨</button>
            </div>
        </div>
    </div>

    <div id="modal-victory" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-head"><div class="modal-title">××©×™××” ×”×•×©×œ××”</div></div>
            <div class="modal-body">
                <h1 style="color:var(--status-ok);">× ×™×¦×—×•×Ÿ!</h1>
                <p>×ª×¤×¡×ª ××ª ×”××“×¢×Ÿ ×•×œ×§×—×ª ××ª ×”× ×•×’×“×Ÿ. ×‘×–×›×•×ª ×”×™×“×¢ ×©×œ×š ×‘×× ×’× ×•× ×™ ×”×˜×‘×¢, ×›×•×œ× × ×™×¦×œ×•.</p>
                <button class="btn-large" onclick="GameLogic.showCredits()">×¡×™×•×</button>
            </div>
        </div>
    </div>

    <div id="modal-wave" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-head"><div class="modal-title">×›×™×•×œ ×ª×“×¨ ×¨×˜×˜</div></div>
            <div class="modal-body" id="tuner-ui">
                <p>×”×ª×× ××ª ×”×’×œ ×”×›×—×•×œ ×œ×’×œ ×”×™×¨×•×§.</p>
                <canvas id="wave-canvas"></canvas>
                <input type="range" id="wave-slider" min="1" max="100" value="50" style="width:100%;">
                <div class="tuner-status" id="wave-status" style="margin-top:10px; font-weight:bold; color:red;">×œ× ××¡×•× ×›×¨×Ÿ</div>
            </div>
        </div>
    </div>

    <div id="modal-sonar" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-head"><div class="modal-title">××™×ª×•×¨ ×©××¢ ×›×™×•×•× ×™</div></div>
            <div class="modal-body">
                <p>×”×§×©×‘ ×œ×¤×¢×™××•×ª ×”×œ×‘. ×œ×—×¥ ×¢×œ ×”× ×§×•×“×” ×”×œ×‘× ×” ×›×©×”×™× ××•×¤×™×¢×”.</p>
                <div id="sonar-ui">
                    <div id="sonar-radar"></div>
                    <div id="sonar-target"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        /** --- CONFIG & DATA --- */
        const DB = {
            Items: {
                MOTOR: { id: 'MOTOR', icon: 'âš™ï¸', name: '×× ×•×¢ ×¨×˜×˜' },
                NEEDLE: { id: 'NEEDLE', icon: 'ğŸ“', name: '××—×˜' },
                BATTERY: { id: 'BATTERY', icon: 'ğŸ”‹', name: '×¡×•×œ×œ×”' },
                DRILL: { id: 'DRILL', icon: 'ğŸ¦Ÿ', name: '××§×“×— ×¨×˜×˜', tool: true },
                LENS: { id: 'LENS', icon: 'ğŸ‘“', name: '×¢×“×©×•×ª' },
                SENSOR: { id: 'SENSOR', icon: 'ğŸŒ¡ï¸', name: '×—×™×™×©×Ÿ' },
                PARTS: { id: 'PARTS', icon: 'ğŸš', name: '×—×œ×§×™ ×¨×—×¤×Ÿ' },
                GOGGLES: { id: 'GOGGLES', icon: 'ğŸ•¶ï¸', name: '××©×§×¤×™×™× ×ª×¨××™×™×', tool: true },
                MIC: { id: 'MIC', icon: 'ğŸ™ï¸', name: '××™×§×¨×•×¤×•×Ÿ' },
                HEADSET: { id: 'HEADSET', icon: 'ğŸ§', name: '××•×–× ×™×™×”' },
                WIRE: { id: 'WIRE', icon: 'ğŸ”Œ', name: '×—×•×˜' },
                SONAR: { id: 'SONAR', icon: 'ğŸ“¡', name: '×¡×•×¨×§ ×§×•×œ×™', tool: true }
            },
            Story: {
                start: "×”×“×××” ×‘×§×¨×•×Ÿ 5 ×”×•×¤×¨×”. ×’×– ×¨×¢×™×œ ×××œ× ××ª ×”×—×œ×œ. ×“×™×–×” ××©×•×¨×™×™× ×ª ××•× ×¢×ª ×™×¦×™××”. ×¢×œ×™×š ×œ×‘× ×•×ª ×›×œ×™ ×—×“×™×¨×” ×¢×“×™×Ÿ (×›××• ×™×ª×•×©) ×›×“×™ ×œ× ×˜×¨×œ ××•×ª×”.",
                p1_done: "×”×“×™×–×” × ×•×˜×¨×œ×”! ×”×’×– ×¤×¡×§. ×”×“×œ×ª ×œ×§×¨×•×Ÿ ×”×‘× × ×¤×ª×—×” ×œ×ª×•×š ×—×•×©×š ××•×—×œ×˜ ×•××œ×›×•×“×•×ª ×œ×™×™×–×¨.",
                p2_done: "×”××©×§×¤×™×™× ×—×•×©×¤×™× ××ª ×”×œ×™×™×–×¨×™×. ×¢×‘×¨×ª ×‘×‘×˜×—×” ×œ×§×¨×•×Ÿ ×”×× ×•×¢. ×”××“×¢×Ÿ ××¡×ª×ª×¨ ×‘×—×•×©×š. ×”×©×ª××© ×‘×©××™×¢×” ×›×“×™ ×œ××¦×•× ××•×ª×•."
            }
        };

        const State = { phase: 1, inventory: [], craftSlots: [], solved: [], scanner: false };

        /** --- LOGIC --- */
        const GameLogic = {
            init() {
                Inventory.init();
                Story.log(DB.Story.start);
                Fx.start();
                
                document.querySelectorAll('.hotspot').forEach(el => {
                    el.addEventListener('click', (e) => this.handleHotspot(el.dataset.id));
                });
            },

            start() {
                document.getElementById('modal-intro').style.display = 'none';
                document.getElementById('app-wrapper').style.opacity = 1;
                this.init();
            },

            showCredits() {
                document.getElementById('modal-victory').classList.remove('active');
                document.getElementById('modal-credits').style.display = 'flex';
            },

            handleHotspot(id) {
                if (!State.scanner && id !== 'vent' && id !== 'door') {
                    Modal.msg("×©×’×™××”", "×œ× × ×™×ª×Ÿ ×œ×–×”×•×ª ××•×‘×™×™×§×˜. × ×“×¨×©×ª ×¡×¨×™×§×” ×ª×¨××™×ª.");
                    return;
                }
                if (State.solved.includes(id)) return;

                // PHASE 1
                if (id === 'case') this.collect(['MOTOR', 'BATTERY'], id, "×× ×•×¢ ×•×¡×•×œ×œ×”");
                if (id === 'seat') this.collect(['NEEDLE'], id, "××—×˜ ××™×§×¨×•× ×™×ª");
                if (id === 'vent') {
                    if (Inventory.has('DRILL')) Minigames.wave();
                    else Modal.msg("×¡×›× ×”", "× ×’×™×¢×” ×ª×¤×¢×™×œ ××œ×›×•×“. × ×“×¨×© ××§×“×— ×¨×˜×˜.");
                }

                // PHASE 2
                if (id === 'debris') this.collect(['LENS', 'PARTS'], id, "×¢×“×©×•×ª ×•×—×œ×§×™×");
                if (id === 'panel') this.collect(['SENSOR'], id, "×—×™×™×©×Ÿ ×ª×¨××™");
                if (id === 'door') {
                    if (Inventory.has('GOGGLES')) this.phase3();
                    else Modal.msg("×¡×›× ×”", "×—×•×©×š ××•×—×œ×˜ ×•××œ×›×•×“×•×ª. ××™ ××¤×©×¨ ×œ×¢×‘×•×¨ ×‘×œ×™ ×œ×¨××•×ª.");
                }

                // PHASE 3
                if (id === 'closet') this.collect(['MIC', 'HEADSET', 'WIRE'], id, "×¦×™×•×“ ×©××¢");
            },

            collect(keys, id, name) {
                keys.forEach(k => Inventory.add(DB.Items[k]));
                State.solved.push(id);
                document.querySelector(`[data-id="${id}"]`).style.display = 'none';
                Story.log(`××¦××ª: ${name}`);
            },

            toggleScanner() {
                State.scanner = !State.scanner;
                const btn = document.getElementById('btn-scanner');
                if (State.scanner) {
                    btn.style.color = '#fff'; btn.style.background = 'rgba(0, 242, 255, 0.2)'; btn.style.borderColor = '#fff';
                    document.body.classList.add('scanner-on');
                    Story.log("×¡×•×¨×§ ×ª×¨××™ ×¤×¢×™×œ.");
                } else {
                    btn.style.color = 'var(--status-tech)'; btn.style.background = 'transparent'; btn.style.borderColor = 'var(--status-tech)';
                    document.body.classList.remove('scanner-on');
                }
            },

            phase2() {
                State.phase = 2;
                Story.log(DB.Story.p1_done);
                document.getElementById('overlay-gas').style.opacity = 0;
                document.getElementById('ind-gas').classList.remove('active', 'danger');
                document.getElementById('ind-vis').classList.add('active', 'danger');
                document.getElementById('bg-train').style.opacity = 0;
                document.getElementById('bg-hallway').style.opacity = 1;
                
                ['vent', 'case', 'seat'].forEach(id => document.querySelector(`[data-id="${id}"]`).style.display = 'none');
                ['debris', 'panel', 'door'].forEach(id => document.querySelector(`[data-id="${id}"]`).style.display = 'flex');
            },

            phase3() {
                State.phase = 3;
                Story.log(DB.Story.p2_done);
                document.getElementById('overlay-thermal').style.opacity = 1;
                setTimeout(() => document.getElementById('overlay-thermal').style.opacity = 0, 2000);
                
                document.getElementById('bg-hallway').style.opacity = 0;
                document.getElementById('bg-engine').style.opacity = 1;
                document.getElementById('overlay-dark').style.opacity = 1;
                document.getElementById('ind-vis').classList.remove('active');
                document.getElementById('ind-aud').classList.add('active', 'danger');

                ['debris', 'panel', 'door'].forEach(id => document.querySelector(`[data-id="${id}"]`).style.display = 'none');
                document.querySelector(`[data-id="closet"]`).style.display = 'flex';

                if (Inventory.has('SONAR')) Minigames.sonar();
                else Story.log("×¢×œ×™×š ×œ×‘× ×•×ª ×¡×•×¨×§ ×©××¢.");
            },

            win() {
                document.getElementById('modal-victory').classList.add('active');
            }
        };

        const Inventory = {
            init() {
                const grid = document.getElementById('inventory-grid');
                for (let i=0; i<8; i++) {
                    let div = document.createElement('div');
                    div.className = 'inv-cell'; div.id = `inv-${i}`;
                    div.onclick = () => this.toggle(i);
                    grid.appendChild(div);
                }
            },
            add(item) { if(this.has(item.id)) return; State.inventory.push(item); this.render(); },
            has(id) { return State.inventory.some(i => i.id === id); },
            render() {
                for(let i=0; i<8; i++) {
                    const el = document.getElementById(`inv-${i}`);
                    el.innerHTML = ''; el.className = 'inv-cell';
                    if (State.inventory[i]) {
                        el.innerHTML = State.inventory[i].icon;
                        if (State.craftSlots.includes(i)) el.classList.add('selected');
                    }
                }
            },
            toggle(i) {
                if (!State.inventory[i]) return;
                if (State.craftSlots.includes(i)) State.craftSlots = State.craftSlots.filter(x => x !== i);
                else if (State.craftSlots.length < 3) State.craftSlots.push(i);
                this.render(); Crafting.update();
            },
            consume() {
                State.craftSlots.sort((a,b)=>b-a).forEach(i => State.inventory.splice(i, 1));
                State.craftSlots = []; this.render(); Crafting.update();
            }
        };

        const Crafting = {
            update() {
                [0,1,2].forEach(i => document.getElementById(`slot-${i}`).innerHTML = '');
                State.craftSlots.forEach((invIdx, i) => document.getElementById(`slot-${i}`).innerHTML = State.inventory[invIdx].icon);
                document.getElementById('btn-craft').className = (State.craftSlots.length === 3) ? 'ready' : '';
            },
            craft() {
                if (State.craftSlots.length !== 3) return;
                const ids = State.craftSlots.map(i => State.inventory[i].id);
                
                if (this.check(ids, ['MOTOR','NEEDLE','BATTERY'])) {
                    Inventory.consume(); Inventory.add(DB.Items.DRILL); Story.log("×‘× ×™×ª ××§×“×— ×¨×˜×˜.");
                } else if (this.check(ids, ['LENS','SENSOR','PARTS'])) {
                    Inventory.consume(); Inventory.add(DB.Items.GOGGLES); Story.log("×‘× ×™×ª ××©×§×¤×™ ×ª×¨××™.");
                } else if (this.check(ids, ['MIC','HEADSET','WIRE'])) {
                    Inventory.consume(); Inventory.add(DB.Items.SONAR); Story.log("×‘× ×™×ª ×¡×•×¨×§ ×©××¢.");
                    if(State.phase === 3) Minigames.sonar();
                } else {
                    Modal.msg("×©×’×™××”", "×©×™×œ×•×‘ ×œ× ×ª×§×™×Ÿ.");
                }
            },
            check(sel, req) { return req.every(r => sel.includes(r)); }
        };

        const Story = {
            log(txt) {
                const d = document.createElement('div'); d.className = 'log-entry'; d.innerHTML = `<strong>></strong> ${txt}`;
                document.getElementById('story-log').prepend(d);
            }
        };

        const Modal = {
            msg(t, txt) { document.getElementById('msg-text').innerText = txt; document.getElementById('modal-msg').classList.add('active'); },
            close(id) { document.getElementById(id).classList.remove('active'); }
        };

        const Minigames = {
            wave() {
                document.getElementById('modal-wave').classList.add('active');
                setTimeout(() => {
                    const cvs = document.getElementById('wave-canvas');
                    const ctx = cvs.getContext('2d');
                    cvs.width = cvs.offsetWidth; cvs.height = cvs.offsetHeight;
                    const slider = document.getElementById('wave-slider');
                    const status = document.getElementById('wave-status');
                    let val = 50, t = 0, win = 0;
                    slider.oninput = (e) => val = parseInt(e.target.value);

                    function loop() {
                        if(!document.getElementById('modal-wave').classList.contains('active')) return;
                        ctx.fillStyle = '#000'; ctx.fillRect(0,0,cvs.width,cvs.height);
                        ctx.lineWidth = 3; t += 0.2;
                        
                        ctx.strokeStyle = 'rgba(0,255,100,0.5)'; ctx.beginPath();
                        for(let x=0; x<cvs.width; x++) ctx.lineTo(x, 75 + Math.sin((x+t*5)*0.1)*40);
                        ctx.stroke();

                        const diff = Math.abs(val - 72);
                        ctx.strokeStyle = diff < 5 ? '#ffb700' : '#00f2ff'; 
                        ctx.beginPath();
                        const freq = val / 500;
                        for(let x=0; x<cvs.width; x++) ctx.lineTo(x, 75 + Math.sin((x+t*5)*freq)*40);
                        ctx.stroke();

                        if (diff < 5) {
                            status.innerText = "× ×¢×•×œ!"; status.style.color = "#00ff9d";
                            win++;
                            if(win > 100) { Modal.close('modal-wave'); GameLogic.phase2(); return; }
                        } else {
                            status.innerText = "×œ× ××¡×•× ×›×¨×Ÿ"; status.style.color = "#ff2a2a"; win = 0;
                        }
                        requestAnimationFrame(loop);
                    }
                    loop();
                }, 100);
            },
            sonar() {
                document.getElementById('modal-sonar').classList.add('active');
                const blip = document.getElementById('sonar-target');
                setInterval(() => {
                    const r = 80; const x = 125 + r * Math.cos(Date.now()/1000); const y = 125 + r * Math.sin(Date.now()/1000);
                    blip.style.left = (x-10)+'px'; blip.style.top = (y-10)+'px';
                    blip.style.opacity = (Math.sin(Date.now()/100) > 0.8) ? 1 : 0;
                }, 50);
                blip.onclick = () => { Modal.close('modal-sonar'); GameLogic.win(); };
            }
        };

        const Fx = {
            start() {
                const cvs = document.getElementById('fx-canvas'); const ctx = cvs.getContext('2d');
                cvs.width = window.innerWidth; cvs.height = window.innerHeight;
                const p = Array(50).fill().map(()=>({x:Math.random()*cvs.width, y:Math.random()*cvs.height, vx:(Math.random()-0.5), vy:(Math.random()-0.5), s:Math.random()*2}));
                function loop() {
                    ctx.clearRect(0,0,cvs.width,cvs.height); ctx.fillStyle = 'rgba(255,255,255,0.1)';
                    p.forEach(d=>{ d.x+=d.vx; d.y+=d.vy; if(d.x<0)d.x=cvs.width; if(d.x>cvs.width)d.x=0; if(d.y<0)d.y=cvs.height; if(d.y>cvs.height)d.y=0; ctx.beginPath(); ctx.arc(d.x,d.y,d.s,0,Math.PI*2); ctx.fill(); });
                    requestAnimationFrame(loop);
                }
                loop();
            }
        };

        // BOOT
        window.onload = () => {
            const log = document.querySelector('.boot-log');
            const lines = ["Initializing...", "Loading Bio-Drivers...", "Connecting...", "Ready."];
            let i = 0;
            const int = setInterval(() => {
                if(i < lines.length) { log.innerHTML += `> ${lines[i]}<br>`; i++; }
                else {
                    clearInterval(int); document.querySelector('.bar-fill').style.width = "100%";
                    setTimeout(() => {
                        document.getElementById('boot-screen').style.display = 'none';
                        document.getElementById('modal-intro').style.display = 'flex';
                    }, 500);
                }
            }, 500);
        };
    </script>
</body>
</html>
